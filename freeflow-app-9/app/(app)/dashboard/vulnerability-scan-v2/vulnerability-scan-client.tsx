'use client'

import { useState, useMemo, useEffect, useCallback } from 'react'
import { toast } from 'sonner'
import {
  Shield, Bug, AlertTriangle, AlertCircle, CheckCircle, XCircle,
  Search, Plus, Download, RefreshCw, Settings, Play, Pause, BarChart3, Server,
  Database, Cloud, Package, Globe, Lock, FileText,
  Activity, Target, Zap, Bell, Info, ExternalLink,
  ChevronRight, HardDrive, Network, Mail, Key, Link2,
  Webhook, Timer, Users, Palette, GitBranch, Copy
} from 'lucide-react'

// Enhanced & Competitive Upgrade Components
import {
  AIInsightsPanel,
  CollaborationIndicator,
  PredictiveAnalytics,
} from '@/components/ui/competitive-upgrades'

import {
  ActivityFeed,
  QuickActionsToolbar,
} from '@/components/ui/competitive-upgrades-extended'




import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Progress } from '@/components/ui/progress'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '@/components/ui/dialog'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Switch } from '@/components/ui/switch'
import { Label } from '@/components/ui/label'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'

// Types
type SeverityLevel = 'critical' | 'high' | 'medium' | 'low' | 'info'
type ScanStatus = 'running' | 'completed' | 'scheduled' | 'failed' | 'paused' | 'cancelled'
type ScanType = 'network' | 'web_app' | 'container' | 'cloud' | 'compliance' | 'malware' | 'configuration'
type AssetType = 'server' | 'workstation' | 'network_device' | 'container' | 'cloud_resource' | 'database' | 'application'
type VulnStatus = 'open' | 'fixed' | 'accepted' | 'in_progress' | 'false_positive'

interface Vulnerability {
  id: string
  cveId: string
  title: string
  description: string
  severity: SeverityLevel
  cvssScore: number
  cvssVector: string
  status: VulnStatus
  asset: string
  assetType: AssetType
  port?: number
  protocol?: string
  discoveredAt: string
  lastSeen: string
  fixedAt?: string
  remediation: string
  references: string[]
  exploitAvailable: boolean
  patchAvailable: boolean
  plugin: string
  pluginFamily: string
}

interface Scan {
  id: string
  name: string
  description: string
  type: ScanType
  status: ScanStatus
  targets: string[]
  policy: string
  schedule?: string
  lastRun: string
  nextRun?: string
  duration: number
  progress: number
  vulnCritical: number
  vulnHigh: number
  vulnMedium: number
  vulnLow: number
  vulnInfo: number
  hostsScanned: number
  hostsUp: number
  createdBy: string
  createdAt: string
}

interface Asset {
  id: string
  hostname: string
  ipAddress: string
  type: AssetType
  os: string
  osVersion: string
  lastScanned: string
  vulnCount: number
  criticalCount: number
  highCount: number
  agent: boolean
  agentVersion?: string
  tags: string[]
  owner: string
  location: string
}

interface ScanPolicy {
  id: string
  name: string
  description: string
  type: ScanType
  plugins: number
  audits: number
  compliance: boolean
  credentialed: boolean
  aggressive: boolean
  createdAt: string
  lastUsed: string
  scansCount: number
}

// Mock Data
const mockVulnerabilities: Vulnerability[] = [
  {
    id: '1',
    cveId: 'CVE-2024-1234',
    title: 'Remote Code Execution in Apache Log4j',
    description: 'A remote code execution vulnerability exists in Apache Log4j 2.x that allows attackers to execute arbitrary code via crafted log messages.',
    severity: 'critical',
    cvssScore: 10.0,
    cvssVector: 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H',
    status: 'open',
    asset: 'web-server-01.company.com',
    assetType: 'server',
    port: 443,
    protocol: 'TCP',
    discoveredAt: '2024-12-20T10:00:00Z',
    lastSeen: '2024-12-25T08:00:00Z',
    remediation: 'Upgrade Log4j to version 2.17.1 or later. Apply vendor patches immediately.',
    references: ['https://nvd.nist.gov/vuln/detail/CVE-2024-1234', 'https://logging.apache.org/log4j/2.x/security.html'],
    exploitAvailable: true,
    patchAvailable: true,
    plugin: 'Apache Log4j RCE Detection',
    pluginFamily: 'Web Servers'
  },
  {
    id: '2',
    cveId: 'CVE-2024-5678',
    title: 'SQL Injection in Custom Web Application',
    description: 'A SQL injection vulnerability was detected in the login form allowing unauthorized database access.',
    severity: 'high',
    cvssScore: 8.6,
    cvssVector: 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:L',
    status: 'in_progress',
    asset: 'app.company.com',
    assetType: 'application',
    port: 443,
    protocol: 'TCP',
    discoveredAt: '2024-12-18T14:30:00Z',
    lastSeen: '2024-12-24T16:00:00Z',
    remediation: 'Use parameterized queries and input validation. Review authentication logic.',
    references: ['https://owasp.org/www-community/attacks/SQL_Injection'],
    exploitAvailable: true,
    patchAvailable: false,
    plugin: 'SQL Injection Detection',
    pluginFamily: 'Web Applications'
  },
  {
    id: '3',
    cveId: 'CVE-2024-9012',
    title: 'OpenSSL Buffer Overflow',
    description: 'A buffer overflow vulnerability in OpenSSL could allow remote attackers to cause denial of service.',
    severity: 'high',
    cvssScore: 7.5,
    cvssVector: 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H',
    status: 'fixed',
    asset: 'db-server-01.company.com',
    assetType: 'database',
    port: 443,
    protocol: 'TCP',
    discoveredAt: '2024-12-10T09:00:00Z',
    lastSeen: '2024-12-15T11:00:00Z',
    fixedAt: '2024-12-16T14:00:00Z',
    remediation: 'Upgrade OpenSSL to the latest patched version.',
    references: ['https://www.openssl.org/news/secadv/'],
    exploitAvailable: false,
    patchAvailable: true,
    plugin: 'OpenSSL Version Detection',
    pluginFamily: 'General'
  },
  {
    id: '4',
    cveId: 'CVE-2024-3456',
    title: 'Cross-Site Scripting (XSS) in Admin Panel',
    description: 'A stored XSS vulnerability was found in the admin panel comment section.',
    severity: 'medium',
    cvssScore: 6.1,
    cvssVector: 'CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N',
    status: 'open',
    asset: 'admin.company.com',
    assetType: 'application',
    port: 443,
    protocol: 'TCP',
    discoveredAt: '2024-12-22T13:00:00Z',
    lastSeen: '2024-12-25T10:00:00Z',
    remediation: 'Implement output encoding and Content Security Policy headers.',
    references: ['https://owasp.org/www-community/attacks/xss/'],
    exploitAvailable: true,
    patchAvailable: false,
    plugin: 'XSS Detection',
    pluginFamily: 'Web Applications'
  },
  {
    id: '5',
    cveId: 'CVE-2024-7890',
    title: 'Weak SSH Configuration',
    description: 'SSH server configured with weak ciphers and outdated protocol versions.',
    severity: 'medium',
    cvssScore: 5.3,
    cvssVector: 'CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N',
    status: 'accepted',
    asset: 'jump-server.company.com',
    assetType: 'server',
    port: 22,
    protocol: 'TCP',
    discoveredAt: '2024-12-01T08:00:00Z',
    lastSeen: '2024-12-25T08:00:00Z',
    remediation: 'Update SSH configuration to use strong ciphers and disable SSHv1.',
    references: ['https://www.ssh.com/academy/ssh/security'],
    exploitAvailable: false,
    patchAvailable: true,
    plugin: 'SSH Server Detection',
    pluginFamily: 'Service Detection'
  }
]

const mockScans: Scan[] = [
  {
    id: '1',
    name: 'Weekly Production Network Scan',
    description: 'Comprehensive vulnerability scan of all production network assets',
    type: 'network',
    status: 'completed',
    targets: ['10.0.0.0/24', '10.0.1.0/24', '10.0.2.0/24'],
    policy: 'Advanced Network Scan',
    schedule: 'Weekly on Sunday 02:00',
    lastRun: '2024-12-22T02:00:00Z',
    nextRun: '2024-12-29T02:00:00Z',
    duration: 14400,
    progress: 100,
    vulnCritical: 3,
    vulnHigh: 12,
    vulnMedium: 45,
    vulnLow: 89,
    vulnInfo: 234,
    hostsScanned: 256,
    hostsUp: 187,
    createdBy: 'security@company.com',
    createdAt: '2024-01-15T10:00:00Z'
  },
  {
    id: '2',
    name: 'Web Application Security Scan',
    description: 'OWASP Top 10 vulnerability assessment for web applications',
    type: 'web_app',
    status: 'running',
    targets: ['https://app.company.com', 'https://api.company.com'],
    policy: 'Web Application Tests',
    lastRun: '2024-12-25T08:00:00Z',
    duration: 3600,
    progress: 67,
    vulnCritical: 1,
    vulnHigh: 4,
    vulnMedium: 8,
    vulnLow: 15,
    vulnInfo: 42,
    hostsScanned: 2,
    hostsUp: 2,
    createdBy: 'appsec@company.com',
    createdAt: '2024-03-20T14:00:00Z'
  },
  {
    id: '3',
    name: 'Container Image Scan',
    description: 'Vulnerability scan of Docker images in container registry',
    type: 'container',
    status: 'scheduled',
    targets: ['registry.company.com/app:latest', 'registry.company.com/api:latest'],
    policy: 'Container Security',
    schedule: 'Daily at 06:00',
    lastRun: '2024-12-24T06:00:00Z',
    nextRun: '2024-12-25T06:00:00Z',
    duration: 1800,
    progress: 0,
    vulnCritical: 0,
    vulnHigh: 2,
    vulnMedium: 5,
    vulnLow: 12,
    vulnInfo: 28,
    hostsScanned: 8,
    hostsUp: 8,
    createdBy: 'devops@company.com',
    createdAt: '2024-06-10T09:00:00Z'
  },
  {
    id: '4',
    name: 'AWS Cloud Infrastructure Scan',
    description: 'Cloud security posture assessment for AWS resources',
    type: 'cloud',
    status: 'completed',
    targets: ['aws:us-east-1', 'aws:us-west-2'],
    policy: 'Cloud Security Posture',
    schedule: 'Daily at 00:00',
    lastRun: '2024-12-25T00:00:00Z',
    nextRun: '2024-12-26T00:00:00Z',
    duration: 7200,
    progress: 100,
    vulnCritical: 0,
    vulnHigh: 3,
    vulnMedium: 15,
    vulnLow: 45,
    vulnInfo: 120,
    hostsScanned: 89,
    hostsUp: 89,
    createdBy: 'cloud@company.com',
    createdAt: '2024-04-01T12:00:00Z'
  }
]

const mockAssets: Asset[] = [
  { id: '1', hostname: 'web-server-01', ipAddress: '10.0.1.10', type: 'server', os: 'Ubuntu', osVersion: '22.04 LTS', lastScanned: '2024-12-25T08:00:00Z', vulnCount: 15, criticalCount: 1, highCount: 3, agent: true, agentVersion: '10.6.2', tags: ['production', 'web', 'critical'], owner: 'webops@company.com', location: 'US-East-1' },
  { id: '2', hostname: 'db-server-01', ipAddress: '10.0.2.10', type: 'database', os: 'CentOS', osVersion: '8', lastScanned: '2024-12-25T08:00:00Z', vulnCount: 8, criticalCount: 0, highCount: 2, agent: true, agentVersion: '10.6.2', tags: ['production', 'database', 'critical'], owner: 'dba@company.com', location: 'US-East-1' },
  { id: '3', hostname: 'app-container-01', ipAddress: '10.0.3.10', type: 'container', os: 'Alpine', osVersion: '3.18', lastScanned: '2024-12-24T06:00:00Z', vulnCount: 5, criticalCount: 0, highCount: 1, agent: false, tags: ['production', 'container'], owner: 'devops@company.com', location: 'US-West-2' },
  { id: '4', hostname: 'workstation-001', ipAddress: '10.0.10.50', type: 'workstation', os: 'Windows', osVersion: '11 Pro', lastScanned: '2024-12-23T12:00:00Z', vulnCount: 12, criticalCount: 0, highCount: 1, agent: true, agentVersion: '10.6.2', tags: ['corporate', 'endpoint'], owner: 'it@company.com', location: 'HQ' },
  { id: '5', hostname: 'fw-main', ipAddress: '10.0.0.1', type: 'network_device', os: 'PAN-OS', osVersion: '10.2', lastScanned: '2024-12-22T02:00:00Z', vulnCount: 3, criticalCount: 0, highCount: 0, agent: false, tags: ['network', 'security', 'critical'], owner: 'netops@company.com', location: 'DC-1' }
]

const mockPolicies: ScanPolicy[] = [
  { id: '1', name: 'Advanced Network Scan', description: 'Comprehensive network vulnerability assessment', type: 'network', plugins: 45000, audits: 0, compliance: false, credentialed: true, aggressive: false, createdAt: '2024-01-01T00:00:00Z', lastUsed: '2024-12-22T02:00:00Z', scansCount: 52 },
  { id: '2', name: 'Web Application Tests', description: 'OWASP Top 10 and web vulnerability testing', type: 'web_app', plugins: 5000, audits: 0, compliance: false, credentialed: false, aggressive: true, createdAt: '2024-02-15T00:00:00Z', lastUsed: '2024-12-25T08:00:00Z', scansCount: 120 },
  { id: '3', name: 'Container Security', description: 'Container image and runtime security scan', type: 'container', plugins: 2000, audits: 50, compliance: true, credentialed: true, aggressive: false, createdAt: '2024-03-01T00:00:00Z', lastUsed: '2024-12-24T06:00:00Z', scansCount: 365 },
  { id: '4', name: 'PCI-DSS Compliance', description: 'PCI-DSS compliance audit and assessment', type: 'compliance', plugins: 15000, audits: 250, compliance: true, credentialed: true, aggressive: false, createdAt: '2024-01-01T00:00:00Z', lastUsed: '2024-12-20T00:00:00Z', scansCount: 12 }
]

// Helper functions
const getSeverityColor = (severity: SeverityLevel): string => {
  const colors: Record<SeverityLevel, string> = {
    critical: 'bg-red-100 text-red-700 border-red-200',
    high: 'bg-orange-100 text-orange-700 border-orange-200',
    medium: 'bg-yellow-100 text-yellow-700 border-yellow-200',
    low: 'bg-blue-100 text-blue-700 border-blue-200',
    info: 'bg-gray-100 text-gray-700 border-gray-200'
  }
  return colors[severity]
}

const getSeverityIcon = (severity: SeverityLevel) => {
  const icons: Record<SeverityLevel, JSX.Element> = {
    critical: <XCircle className="w-4 h-4" />,
    high: <AlertTriangle className="w-4 h-4" />,
    medium: <AlertCircle className="w-4 h-4" />,
    low: <Info className="w-4 h-4" />,
    info: <Info className="w-4 h-4" />
  }
  return icons[severity]
}

const getStatusColor = (status: ScanStatus): string => {
  const colors: Record<ScanStatus, string> = {
    running: 'bg-blue-100 text-blue-700',
    completed: 'bg-green-100 text-green-700',
    scheduled: 'bg-purple-100 text-purple-700',
    failed: 'bg-red-100 text-red-700',
    paused: 'bg-yellow-100 text-yellow-700',
    cancelled: 'bg-gray-100 text-gray-700'
  }
  return colors[status]
}

const getVulnStatusColor = (status: VulnStatus): string => {
  const colors: Record<VulnStatus, string> = {
    open: 'bg-red-100 text-red-700',
    fixed: 'bg-green-100 text-green-700',
    accepted: 'bg-yellow-100 text-yellow-700',
    in_progress: 'bg-blue-100 text-blue-700',
    false_positive: 'bg-gray-100 text-gray-700'
  }
  return colors[status]
}

const getScanTypeColor = (type: ScanType): string => {
  const colors: Record<ScanType, string> = {
    network: 'bg-blue-100 text-blue-700',
    web_app: 'bg-green-100 text-green-700',
    container: 'bg-cyan-100 text-cyan-700',
    cloud: 'bg-purple-100 text-purple-700',
    compliance: 'bg-orange-100 text-orange-700',
    malware: 'bg-red-100 text-red-700',
    configuration: 'bg-indigo-100 text-indigo-700'
  }
  return colors[type]
}

const getAssetTypeIcon = (type: AssetType) => {
  const icons: Record<AssetType, JSX.Element> = {
    server: <Server className="w-4 h-4" />,
    workstation: <HardDrive className="w-4 h-4" />,
    network_device: <Network className="w-4 h-4" />,
    container: <Package className="w-4 h-4" />,
    cloud_resource: <Cloud className="w-4 h-4" />,
    database: <Database className="w-4 h-4" />,
    application: <Globe className="w-4 h-4" />
  }
  return icons[type]
}

const formatDuration = (seconds: number) => {
  const hours = Math.floor(seconds / 3600)
  const minutes = Math.floor((seconds % 3600) / 60)
  if (hours > 0) return `${hours}h ${minutes}m`
  return `${minutes}m`
}

const formatDate = (date: string) => {
  return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
}

const formatDateTime = (date: string) => {
  return new Date(date).toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })
}

// Mock data for AI-powered competitive upgrade components
const mockVulnScanAIInsights = [
  { id: '1', type: 'success' as const, title: 'Patch Applied', description: '15 critical vulnerabilities patched in last 24 hours. Security improved!', priority: 'low' as const, timestamp: new Date().toISOString(), category: 'Remediation' },
  { id: '2', type: 'warning' as const, title: 'Critical CVE Found', description: 'CVE-2024-1234 detected in production. Immediate patching required.', priority: 'high' as const, timestamp: new Date().toISOString(), category: 'Critical' },
  { id: '3', type: 'info' as const, title: 'Scan Complete', description: 'Weekly security scan finished. 3 new medium-severity issues found.', priority: 'medium' as const, timestamp: new Date().toISOString(), category: 'Scanning' },
]

const mockVulnScanCollaborators = [
  { id: '1', name: 'Security Lead', avatar: '/avatars/security.jpg', status: 'online' as const, role: 'Security' },
  { id: '2', name: 'DevOps', avatar: '/avatars/devops.jpg', status: 'online' as const, role: 'DevOps' },
  { id: '3', name: 'Compliance', avatar: '/avatars/compliance.jpg', status: 'away' as const, role: 'Compliance' },
]

const mockVulnScanPredictions = [
  { id: '1', title: 'Risk Trend', prediction: 'Security posture improving - 40% fewer critical issues than last month', confidence: 91, trend: 'down' as const, impact: 'high' as const },
  { id: '2', title: 'Compliance', prediction: 'On track for SOC2 certification with current remediation pace', confidence: 85, trend: 'up' as const, impact: 'high' as const },
]

const mockVulnScanActivities = [
  { id: '1', user: 'Security Lead', action: 'Resolved', target: 'SQL injection vulnerability', timestamp: new Date().toISOString(), type: 'success' as const },
  { id: '2', user: 'DevOps', action: 'Started', target: 'infrastructure security scan', timestamp: new Date(Date.now() - 3600000).toISOString(), type: 'info' as const },
  { id: '3', user: 'System', action: 'Detected', target: '2 new CVEs in dependencies', timestamp: new Date(Date.now() - 7200000).toISOString(), type: 'warning' as const },
]

const mockVulnScanQuickActionsBase = [
  { id: '1', label: 'Run Scan', icon: 'play', variant: 'default' as const },
  { id: '2', label: 'View CVEs', icon: 'shield', variant: 'default' as const },
  { id: '3', label: 'Export Report', icon: 'download', variant: 'outline' as const },
]

// Database types matching Supabase schema
interface DBScan {
  id: string
  user_id: string
  scan_code: string
  name: string
  description: string | null
  scan_type: string
  status: string
  scanner: string | null
  target: string | null
  started_at: string | null
  completed_at: string | null
  duration_seconds: number
  scanned_items: number
  vuln_critical: number
  vuln_high: number
  vuln_medium: number
  vuln_low: number
  vuln_info: number
  schedule_cron: string | null
  next_scheduled_at: string | null
  config: Record<string, unknown>
  tags: string[]
  created_at: string
  updated_at: string
}

interface DBVulnerability {
  id: string
  scan_id: string
  vuln_code: string | null
  title: string
  description: string | null
  severity: string
  category: string | null
  package_name: string | null
  cve_id: string | null
  cvss_score: number | null
  cvss_vector: string | null
  exploit_available: boolean
  patch_available: boolean
  status: string
  remediation_notes: string | null
  reference_urls: string[]
  created_at: string
  updated_at: string
}

export default function VulnerabilityScanClient() {

  const [activeTab, setActiveTab] = useState('dashboard')
  const [searchQuery, setSearchQuery] = useState('')
  const [selectedVuln, setSelectedVuln] = useState<Vulnerability | null>(null)
  const [severityFilter, setSeverityFilter] = useState<SeverityLevel | 'all'>('all')
  const [settingsTab, setSettingsTab] = useState('scanning')

  // Supabase state
  const [dbScans, setDbScans] = useState<DBScan[]>([])
  const [dbVulnerabilities, setDbVulnerabilities] = useState<DBVulnerability[]>([])
  const [isLoading, setIsLoading] = useState(true)
  const [isSaving, setIsSaving] = useState(false)

  // Form state for new scan
  const [newScanForm, setNewScanForm] = useState({
    name: '',
    description: '',
    scan_type: 'network',
    target: '',
    scanner: 'nessus'
  })
  const [showNewScanDialog, setShowNewScanDialog] = useState(false)

  // Dialog state for quick actions
  const [showRunScanDialog, setShowRunScanDialog] = useState(false)
  const [showViewCVEsDialog, setShowViewCVEsDialog] = useState(false)
  const [showExportReportDialog, setShowExportReportDialog] = useState(false)
  const [showAlertsDialog, setShowAlertsDialog] = useState(false)
  const [showCompareScansDialog, setShowCompareScansDialog] = useState(false)

  // Integration and settings dialog state
  const [showIntegrationDialog, setShowIntegrationDialog] = useState(false)
  const [selectedIntegration, setSelectedIntegration] = useState<{ name: string; desc: string; status: string; icon: string } | null>(null)
  const [showWebhookDialog, setShowWebhookDialog] = useState(false)
  const [webhookUrl, setWebhookUrl] = useState('')
  const [webhookEvents, setWebhookEvents] = useState({ critical: true, high: true, medium: false, low: false })
  const [apiKey, setApiKey] = useState('vsc_' + Array(32).fill(0).map(() => 'abcdefghijklmnopqrstuvwxyz0123456789'[Math.floor(Math.random() * 36)]).join(''))
  const [isRegeneratingKey, setIsRegeneratingKey] = useState(false)

  // Fetch scans from Supabase
  const fetchScans = useCallback(async () => {
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data, error } = await supabase
        .from('vulnerability_scans')
        .select('*')
        .is('deleted_at', null)
        .order('created_at', { ascending: false })

      if (error) throw error
      setDbScans(data || [])
    } catch (err) {
      console.error('Error fetching scans:', err)
    }
  }, [])

  // Fetch vulnerabilities from Supabase
  const fetchVulnerabilities = useCallback(async () => {
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data, error } = await supabase
        .from('vulnerabilities')
        .select('*')
        .order('created_at', { ascending: false })

      if (error) throw error
      setDbVulnerabilities(data || [])
    } catch (err) {
      console.error('Error fetching vulnerabilities:', err)
    }
  }, [])

  // Initial data load
  useEffect(() => {
    const loadData = async () => {
      setIsLoading(true)
      await Promise.all([fetchScans(), fetchVulnerabilities()])
      setIsLoading(false)
    }
    loadData()
  }, [fetchScans, fetchVulnerabilities])

  // Computed stats
  const stats = useMemo(() => {
    const totalVulns = mockVulnerabilities.length
    const critical = mockVulnerabilities.filter(v => v.severity === 'critical').length
    const high = mockVulnerabilities.filter(v => v.severity === 'high').length
    const open = mockVulnerabilities.filter(v => v.status === 'open').length
    const fixed = mockVulnerabilities.filter(v => v.status === 'fixed').length
    const exploitable = mockVulnerabilities.filter(v => v.exploitAvailable).length
    const totalScans = mockScans.length
    const runningScans = mockScans.filter(s => s.status === 'running').length
    const totalAssets = mockAssets.length

    return {
      totalVulns,
      critical,
      high,
      open,
      fixed,
      exploitable,
      totalScans,
      runningScans,
      totalAssets,
      fixRate: totalVulns > 0 ? Math.round((fixed / totalVulns) * 100) : 0
    }
  }, [])

  // Filtered vulnerabilities
  const filteredVulns = useMemo(() => {
    return mockVulnerabilities.filter(vuln => {
      const matchesSearch = searchQuery === '' ||
        vuln.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
        vuln.cveId.toLowerCase().includes(searchQuery.toLowerCase()) ||
        vuln.asset.toLowerCase().includes(searchQuery.toLowerCase())
      const matchesSeverity = severityFilter === 'all' || vuln.severity === severityFilter
      return matchesSearch && matchesSeverity
    })
  }, [searchQuery, severityFilter])

  // Real Supabase handlers
  const handleCreateScan = useCallback(async () => {
    if (!newScanForm.name.trim()) {
      toast.error('Validation error', { description: 'Scan name is required' })
      return
    }
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) throw new Error('Not authenticated')

      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase.from('vulnerability_scans').insert({
        user_id: user.id,
        name: newScanForm.name,
        description: newScanForm.description || null,
        scan_type: newScanForm.scan_type,
        target: newScanForm.target || null,
        scanner: newScanForm.scanner,
        status: 'scheduled'
      })

      if (error) throw error
      toast.success('Scan created', { description: 'New vulnerability scan has been scheduled' })
      setShowNewScanDialog(false)
      setNewScanForm({ name: '', description: '', scan_type: 'network', target: '', scanner: 'nessus' })
      await fetchScans()
    } catch (err) {
      toast.error('Failed to create scan', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ newScanForm, fetchScans])

  const handleStartScan = useCallback(async (scanId?: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data: { user } } = await supabase.auth.getUser()
      if (!user) throw new Error('Not authenticated')

      if (scanId) {
        const { createClient } = await import('@/lib/supabase/client')
        const supabase = createClient()
        const { error } = await supabase
          .from('vulnerability_scans')
          .update({ status: 'in-progress', started_at: new Date().toISOString() })
          .eq('id', scanId)
        if (error) throw error
      } else {
        // Create and start a new quick scan
        const { createClient } = await import('@/lib/supabase/client')
        const supabase = createClient()
        const { error } = await supabase.from('vulnerability_scans').insert({
          user_id: user.id,
          name: `Quick Scan ${new Date().toLocaleDateString()}`,
          scan_type: 'network',
          status: 'in-progress',
          started_at: new Date().toISOString()
        })
        if (error) throw error
      }

      toast.info('Scan started', { description: 'Vulnerability scan is in progress...' })
      await fetchScans()
    } catch (err) {
      toast.error('Failed to start scan', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchScans])

  const handleStopScan = useCallback(async (scanId: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase
        .from('vulnerability_scans')
        .update({ status: 'cancelled', completed_at: new Date().toISOString() })
        .eq('id', scanId)

      if (error) throw error
      toast.info('Scan stopped', { description: 'Vulnerability scan has been cancelled' })
      await fetchScans()
    } catch (err) {
      toast.error('Failed to stop scan', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchScans])

  const handlePatchVulnerability = useCallback(async (vulnId: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data: { user } } = await supabase.auth.getUser()
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase
        .from('vulnerabilities')
        .update({
          status: 'in-progress',
          remediation_notes: 'Patching initiated',
          updated_at: new Date().toISOString()
        })
        .eq('id', vulnId)

      if (error) throw error
      toast.success('Patching initiated', { description: 'Vulnerability remediation in progress' })
      await fetchVulnerabilities()
    } catch (err) {
      toast.error('Failed to patch', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchVulnerabilities])

  const handleResolveVulnerability = useCallback(async (vulnId: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data: { user } } = await supabase.auth.getUser()
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase
        .from('vulnerabilities')
        .update({
          status: 'fixed',
          fixed_at: new Date().toISOString(),
          fixed_by: user?.id,
          updated_at: new Date().toISOString()
        })
        .eq('id', vulnId)

      if (error) throw error
      toast.success('Vulnerability resolved', { description: 'Marked as fixed' })
      await fetchVulnerabilities()
    } catch (err) {
      toast.error('Failed to resolve', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchVulnerabilities])

  const handleDismissVulnerability = useCallback(async (vulnId: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase
        .from('vulnerabilities')
        .update({
          status: 'false-positive',
          updated_at: new Date().toISOString()
        })
        .eq('id', vulnId)

      if (error) throw error
      toast.info('Vulnerability dismissed', { description: 'Marked as false positive' })
      await fetchVulnerabilities()
    } catch (err) {
      toast.error('Failed to dismiss', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchVulnerabilities])

  const handleDeleteScan = useCallback(async (scanId: string) => {
    setIsSaving(true)
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { error } = await supabase
        .from('vulnerability_scans')
        .update({ deleted_at: new Date().toISOString() })
        .eq('id', scanId)

      if (error) throw error
      toast.success('Scan deleted', { description: 'Vulnerability scan has been removed' })
      await fetchScans()
    } catch (err) {
      toast.error('Failed to delete scan', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [ fetchScans])

  const handleExportReport = useCallback(async () => {
    toast.info('Exporting report', { description: 'Security report is being generated...' })
    try {
      const { createClient } = await import('@/lib/supabase/client')
      const supabase = createClient()
      const { data: { user } } = await supabase.auth.getUser()
      // Log export activity
      if (user) {
        const { createClient } = await import('@/lib/supabase/client')
        const supabase = createClient()
        await supabase.from('vulnerability_scans').insert({
          user_id: user.id,
          name: `Export Report ${new Date().toISOString()}`,
          description: 'Automated export report generation',
          scan_type: 'code',
          status: 'completed',
          completed_at: new Date().toISOString()
        })
      }
      toast.success('Report exported', { description: 'Security report will be downloaded' })
    } catch (err) {
      toast.error('Export failed', { description: err instanceof Error ? err.message : 'Unknown error' })
    }
  }, [])

  // Integration configuration handler
  const handleConfigureIntegration = useCallback((integration: { name: string; desc: string; status: string; icon: string }) => {
    setSelectedIntegration(integration)
    setShowIntegrationDialog(true)
  }, [])

  const handleSaveIntegration = useCallback(async () => {
    if (!selectedIntegration) return
    setIsSaving(true)
    try {
      // Simulate API call for integration configuration
      await new Promise(resolve => setTimeout(resolve, 1000))
      toast.success(
        selectedIntegration.status === 'connected' ? 'Integration updated' : 'Integration connected',
        { description: `${selectedIntegration.name} has been ${selectedIntegration.status === 'connected' ? 'configured' : 'connected'} successfully` }
      )
      setShowIntegrationDialog(false)
      setSelectedIntegration(null)
    } catch (err) {
      toast.error('Configuration failed', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [selectedIntegration])

  const handleDisconnectIntegration = useCallback(async () => {
    if (!selectedIntegration) return
    setIsSaving(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))
      toast.info('Integration disconnected', { description: `${selectedIntegration.name} has been disconnected` })
      setShowIntegrationDialog(false)
      setSelectedIntegration(null)
    } catch (err) {
      toast.error('Disconnect failed', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [selectedIntegration])

  // Webhook creation handler
  const handleCreateWebhook = useCallback(async () => {
    if (!webhookUrl.trim()) {
      toast.error('Validation error', { description: 'Webhook URL is required' })
      return
    }
    if (!webhookUrl.startsWith('https://')) {
      toast.error('Validation error', { description: 'Webhook URL must use HTTPS' })
      return
    }
    setIsSaving(true)
    try {
      // Simulate API call for webhook creation
      await new Promise(resolve => setTimeout(resolve, 1000))
      toast.success('Webhook created', {
        description: `Events will be sent to ${webhookUrl.substring(0, 40)}...`
      })
      setShowWebhookDialog(false)
      setWebhookUrl('')
      setWebhookEvents({ critical: true, high: true, medium: false, low: false })
    } catch (err) {
      toast.error('Webhook creation failed', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsSaving(false)
    }
  }, [webhookUrl, webhookEvents])

  // API key regeneration handler
  const handleRegenerateApiKey = useCallback(async () => {
    setIsRegeneratingKey(true)
    try {
      // Simulate API call for key regeneration
      await new Promise(resolve => setTimeout(resolve, 1500))
      const newKey = 'vsc_' + Array(32).fill(0).map(() => 'abcdefghijklmnopqrstuvwxyz0123456789'[Math.floor(Math.random() * 36)]).join('')
      setApiKey(newKey)
      navigator.clipboard.writeText(newKey)
      toast.success('API key regenerated', {
        description: 'New key has been copied to clipboard. The old key is now invalid.'
      })
    } catch (err) {
      toast.error('Regeneration failed', { description: err instanceof Error ? err.message : 'Unknown error' })
    } finally {
      setIsRegeneratingKey(false)
    }
  }, [])

  // Quick actions with dialog openers
  const mockVulnScanQuickActions = useMemo(() => [
    { id: '1', label: 'Run Scan', icon: 'play', action: () => setShowRunScanDialog(true), variant: 'default' as const },
    { id: '2', label: 'View CVEs', icon: 'shield', action: () => setShowViewCVEsDialog(true), variant: 'default' as const },
    { id: '3', label: 'Export Report', icon: 'download', action: () => setShowExportReportDialog(true), variant: 'outline' as const },
  ], [])

  return (
    <div className="min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 dark:bg-none dark:bg-gray-900">
      <div className="p-8">
        <div className="max-w-7xl mx-auto space-y-8">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="p-3 bg-gradient-to-br from-red-500 to-orange-600 rounded-2xl shadow-lg">
                <Shield className="w-8 h-8 text-white" />
              </div>
              <div>
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
                  Vulnerability Management
                </h1>
                <p className="text-gray-600 dark:text-gray-400">
                  Nessus-level vulnerability scanning and assessment
                </p>
              </div>
            </div>
            <div className="flex gap-3">
              <Button variant="outline" className="flex items-center gap-2" onClick={handleExportReport} disabled={isSaving}>
                <Download className="w-4 h-4" />
                Export
              </Button>
              <Dialog open={showNewScanDialog} onOpenChange={setShowNewScanDialog}>
                <DialogTrigger asChild>
                  <Button className="bg-gradient-to-r from-red-600 to-orange-600 text-white flex items-center gap-2">
                    <Plus className="w-4 h-4" />
                    New Scan
                  </Button>
                </DialogTrigger>
                <DialogContent>
                  <DialogHeader>
                    <DialogTitle>Create New Scan</DialogTitle>
                    <DialogDescription>Configure a new vulnerability scan</DialogDescription>
                  </DialogHeader>
                  <div className="space-y-4 py-4">
                    <div className="space-y-2">
                      <Label>Scan Name *</Label>
                      <Input
                        placeholder="Production Network Scan"
                        value={newScanForm.name}
                        onChange={(e) => setNewScanForm(prev => ({ ...prev, name: e.target.value }))}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Description</Label>
                      <Input
                        placeholder="Weekly scan of production infrastructure"
                        value={newScanForm.description}
                        onChange={(e) => setNewScanForm(prev => ({ ...prev, description: e.target.value }))}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Scan Type</Label>
                      <Select value={newScanForm.scan_type} onValueChange={(v) => setNewScanForm(prev => ({ ...prev, scan_type: v }))}>
                        <SelectTrigger>
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="network">Network</SelectItem>
                          <SelectItem value="web-application">Web Application</SelectItem>
                          <SelectItem value="container">Container</SelectItem>
                          <SelectItem value="infrastructure">Infrastructure</SelectItem>
                          <SelectItem value="api">API</SelectItem>
                          <SelectItem value="code">Code</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Target</Label>
                      <Input
                        placeholder="10.0.0.0/24 or https://example.com"
                        value={newScanForm.target}
                        onChange={(e) => setNewScanForm(prev => ({ ...prev, target: e.target.value }))}
                      />
                    </div>
                  </div>
                  <DialogFooter>
                    <Button variant="outline" onClick={() => setShowNewScanDialog(false)}>Cancel</Button>
                    <Button onClick={handleCreateScan} disabled={isSaving} className="bg-gradient-to-r from-red-600 to-orange-600 text-white">
                      {isSaving ? 'Creating...' : 'Create Scan'}
                    </Button>
                  </DialogFooter>
                </DialogContent>
              </Dialog>
            </div>
          </div>

          {/* Stats Grid */}
          <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
            {[
              { label: 'Total Vulns', value: stats.totalVulns.toString(), icon: Bug, gradient: 'from-red-500 to-pink-600' },
              { label: 'Critical', value: stats.critical.toString(), icon: XCircle, gradient: 'from-red-600 to-red-700' },
              { label: 'High', value: stats.high.toString(), icon: AlertTriangle, gradient: 'from-orange-500 to-amber-600' },
              { label: 'Open', value: stats.open.toString(), icon: AlertCircle, gradient: 'from-yellow-500 to-orange-600' },
              { label: 'Fixed', value: stats.fixed.toString(), icon: CheckCircle, gradient: 'from-green-500 to-emerald-600' },
              { label: 'Exploitable', value: stats.exploitable.toString(), icon: Zap, gradient: 'from-purple-500 to-indigo-600' },
              { label: 'Active Scans', value: stats.runningScans.toString(), icon: Activity, gradient: 'from-blue-500 to-cyan-600' },
              { label: 'Assets', value: stats.totalAssets.toString(), icon: Server, gradient: 'from-cyan-500 to-blue-600' }
            ].map((stat, index) => (
              <Card key={index} className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                <CardContent className="p-4">
                  <div className={`inline-flex p-2 rounded-lg bg-gradient-to-br ${stat.gradient} mb-3`}>
                    <stat.icon className="w-4 h-4 text-white" />
                  </div>
                  <div className="text-2xl font-bold text-gray-900 dark:text-white">{stat.value}</div>
                  <div className="text-xs text-gray-500 dark:text-gray-400">{stat.label}</div>
                </CardContent>
              </Card>
            ))}
          </div>

          {/* Tabs */}
          <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
            <TabsList className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm p-1 rounded-xl shadow-sm">
              <TabsTrigger value="dashboard" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <BarChart3 className="w-4 h-4 mr-2" />
                Dashboard
              </TabsTrigger>
              <TabsTrigger value="vulnerabilities" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <Bug className="w-4 h-4 mr-2" />
                Vulnerabilities
              </TabsTrigger>
              <TabsTrigger value="scans" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <Search className="w-4 h-4 mr-2" />
                Scans
              </TabsTrigger>
              <TabsTrigger value="assets" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <Server className="w-4 h-4 mr-2" />
                Assets
              </TabsTrigger>
              <TabsTrigger value="policies" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <FileText className="w-4 h-4 mr-2" />
                Policies
              </TabsTrigger>
              <TabsTrigger value="settings" className="rounded-lg data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-orange-600 data-[state=active]:text-white">
                <Settings className="w-4 h-4 mr-2" />
                Settings
              </TabsTrigger>
            </TabsList>

            {/* Dashboard Tab */}
            <TabsContent value="dashboard" className="space-y-6">
              {/* Dashboard Banner */}
              <div className="bg-gradient-to-r from-red-600 via-orange-600 to-amber-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Security Dashboard</h2>
                    <p className="text-red-100">Nessus-level vulnerability management and assessment</p>
                    <p className="text-red-200 text-xs mt-1">CVE tracking • CVSS scoring • Risk prioritization</p>
                  </div>
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.critical + stats.high}</p>
                      <p className="text-red-200 text-sm">Critical/High</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.fixRate}%</p>
                      <p className="text-red-200 text-sm">Fix Rate</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Dashboard Quick Actions */}
              <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => handleStartScan()} disabled={isSaving}>
                  <span className="text-red-600"><Play className="w-4 h-4" /></span>
                  <span className="text-xs">Run Scan</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={handleExportReport} disabled={isSaving}>
                  <span className="text-blue-600"><Download className="w-4 h-4" /></span>
                  <span className="text-xs">Export</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={handleExportReport}>
                  <span className="text-green-600"><FileText className="w-4 h-4" /></span>
                  <span className="text-xs">Report</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => setShowAlertsDialog(true)}>
                  <span className="text-orange-600"><Bell className="w-4 h-4" /></span>
                  <span className="text-xs">Alerts</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => setActiveTab('vulnerabilities')}>
                  <span className="text-purple-600"><Target className="w-4 h-4" /></span>
                  <span className="text-xs">Prioritize</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => toast.promise(Promise.all([fetchScans(), fetchVulnerabilities()]), { loading: 'Rescanning for vulnerabilities...', success: 'Scan data refreshed successfully', error: 'Failed to refresh scan data' })}>
                  <span className="text-amber-600"><RefreshCw className="w-4 h-4" /></span>
                  <span className="text-xs">Rescan</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => setShowCompareScansDialog(true)}>
                  <span className="text-pink-600"><GitBranch className="w-4 h-4" /></span>
                  <span className="text-xs">Compare</span>
                </Button>
                <Button variant="outline" className="flex flex-col items-center gap-2 h-auto py-4 hover:scale-105 transition-all duration-200" onClick={() => setActiveTab('settings')}>
                  <span className="text-cyan-600"><Settings className="w-4 h-4" /></span>
                  <span className="text-xs">Settings</span>
                </Button>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                {/* Severity Distribution */}
                <Card className="lg:col-span-2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <AlertTriangle className="w-5 h-5 text-orange-600" />
                      Vulnerability Severity Distribution
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-4">
                      {[
                        { severity: 'critical' as SeverityLevel, count: stats.critical, color: 'from-red-500 to-red-600', percentage: 20 },
                        { severity: 'high' as SeverityLevel, count: stats.high, color: 'from-orange-500 to-amber-600', percentage: 40 },
                        { severity: 'medium' as SeverityLevel, count: 2, color: 'from-yellow-500 to-orange-500', percentage: 25 },
                        { severity: 'low' as SeverityLevel, count: 0, color: 'from-blue-500 to-cyan-600', percentage: 10 },
                        { severity: 'info' as SeverityLevel, count: 0, color: 'from-gray-400 to-gray-500', percentage: 5 }
                      ].map((item) => (
                        <div key={item.severity} className="flex items-center gap-4">
                          <div className="w-20 text-sm font-medium capitalize text-gray-700 dark:text-gray-300">{item.severity}</div>
                          <div className="flex-1">
                            <div className="h-4 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden">
                              <div className={`h-full bg-gradient-to-r ${item.color} rounded-full`} style={{ width: `${item.percentage}%` }} />
                            </div>
                          </div>
                          <div className="w-12 text-right text-sm font-bold text-gray-900 dark:text-white">{item.count}</div>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>

                {/* Top Vulnerabilities */}
                <Card className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Target className="w-5 h-5 text-red-600" />
                      Critical Findings
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3">
                      {mockVulnerabilities.filter(v => v.severity === 'critical' || v.severity === 'high').slice(0, 4).map((vuln) => (
                        <div key={vuln.id} className="p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                          <div className="flex items-center justify-between mb-1">
                            <Badge className={getSeverityColor(vuln.severity)}>{vuln.severity}</Badge>
                            <span className="text-xs text-gray-500">{vuln.cvssScore}</span>
                          </div>
                          <p className="text-sm font-medium text-gray-900 dark:text-white truncate">{vuln.title}</p>
                          <p className="text-xs text-gray-500 mt-1">{vuln.cveId}</p>
                        </div>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              </div>

              {/* Recent Scans */}
              <Card className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Activity className="w-5 h-5 text-blue-600" />
                    Recent Scans
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-4">
                    {mockScans.slice(0, 3).map((scan) => (
                      <div key={scan.id} className="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                        <div className="flex items-center gap-4">
                          <div className="p-2 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg">
                            <Search className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <p className="font-semibold text-gray-900 dark:text-white">{scan.name}</p>
                            <p className="text-sm text-gray-500">{scan.targets.length} targets • {formatDuration(scan.duration)}</p>
                          </div>
                        </div>
                        <div className="text-right">
                          <Badge className={getStatusColor(scan.status)}>{scan.status}</Badge>
                          {scan.status === 'running' && (
                            <div className="mt-2 w-24">
                              <Progress value={scan.progress} className="h-2" />
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Vulnerabilities Tab */}
            <TabsContent value="vulnerabilities" className="space-y-6">
              {/* Vulnerabilities Banner */}
              <div className="bg-gradient-to-r from-purple-600 via-violet-600 to-indigo-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Vulnerability Database</h2>
                    <p className="text-purple-100">Qualys-level vulnerability tracking and remediation</p>
                    <p className="text-purple-200 text-xs mt-1">CVSS analysis • Exploit detection • Patch management</p>
                  </div>
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{filteredVulns.length}</p>
                      <p className="text-purple-200 text-sm">Findings</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.exploitable}</p>
                      <p className="text-purple-200 text-sm">Exploitable</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Search and Filter */}
              <div className="flex flex-col sm:flex-row gap-4">
                <div className="relative flex-1">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
                  <Input
                    placeholder="Search by CVE, title, or asset..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="pl-10 bg-white dark:bg-gray-800"
                  />
                </div>
                <div className="flex gap-2 flex-wrap">
                  {(['all', 'critical', 'high', 'medium', 'low', 'info'] as const).map((sev) => (
                    <Button
                      key={sev}
                      variant={severityFilter === sev ? 'default' : 'outline'}
                      size="sm"
                      onClick={() => setSeverityFilter(sev)}
                      className={severityFilter === sev ? 'bg-gradient-to-r from-red-600 to-orange-600' : ''}
                    >
                      {sev === 'all' ? 'All' : sev}
                    </Button>
                  ))}
                </div>
              </div>

              {/* Vulnerabilities List */}
              <Card className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                <CardContent className="p-0">
                  <ScrollArea className="h-[600px]">
                    <div className="divide-y divide-gray-100 dark:divide-gray-700">
                      {filteredVulns.map((vuln) => (
                        <Dialog key={vuln.id}>
                          <DialogTrigger asChild>
                            <div className="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors">
                              <div className="flex items-start justify-between">
                                <div className="flex items-start gap-4">
                                  <div className={`p-2 rounded-lg ${vuln.severity === 'critical' ? 'bg-red-100' : vuln.severity === 'high' ? 'bg-orange-100' : 'bg-yellow-100'}`}>
                                    {getSeverityIcon(vuln.severity)}
                                  </div>
                                  <div>
                                    <div className="flex items-center gap-2 mb-1">
                                      <span className="font-semibold text-gray-900 dark:text-white">{vuln.title}</span>
                                    </div>
                                    <div className="flex flex-wrap gap-2 mb-2">
                                      <Badge className={getSeverityColor(vuln.severity)}>{vuln.severity} ({vuln.cvssScore})</Badge>
                                      <Badge className={getVulnStatusColor(vuln.status)}>{vuln.status.replace('_', ' ')}</Badge>
                                      {vuln.exploitAvailable && <Badge className="bg-purple-100 text-purple-700">Exploit Available</Badge>}
                                      {vuln.patchAvailable && <Badge className="bg-green-100 text-green-700">Patch Available</Badge>}
                                    </div>
                                    <p className="text-sm text-gray-500">
                                      {vuln.cveId} • {vuln.asset} • Port {vuln.port}/{vuln.protocol}
                                    </p>
                                  </div>
                                </div>
                                <ChevronRight className="w-5 h-5 text-gray-400" />
                              </div>
                            </div>
                          </DialogTrigger>
                          <DialogContent className="max-w-2xl">
                            <DialogHeader>
                              <DialogTitle>{vuln.title}</DialogTitle>
                              <DialogDescription>{vuln.cveId}</DialogDescription>
                            </DialogHeader>
                            <ScrollArea className="max-h-[60vh]">
                              <div className="space-y-4 p-4">
                                <div className="flex flex-wrap gap-2">
                                  <Badge className={getSeverityColor(vuln.severity)}>CVSS {vuln.cvssScore}</Badge>
                                  <Badge className={getVulnStatusColor(vuln.status)}>{vuln.status}</Badge>
                                </div>
                                <div>
                                  <h4 className="font-semibold mb-2">Description</h4>
                                  <p className="text-sm text-gray-600 dark:text-gray-400">{vuln.description}</p>
                                </div>
                                <div>
                                  <h4 className="font-semibold mb-2">Remediation</h4>
                                  <p className="text-sm text-gray-600 dark:text-gray-400">{vuln.remediation}</p>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                                  <div>
                                    <h4 className="font-semibold mb-2">Asset</h4>
                                    <p className="text-sm text-gray-600">{vuln.asset}</p>
                                  </div>
                                  <div>
                                    <h4 className="font-semibold mb-2">CVSS Vector</h4>
                                    <p className="text-sm text-gray-600 font-mono">{vuln.cvssVector}</p>
                                  </div>
                                </div>
                                <div>
                                  <h4 className="font-semibold mb-2">References</h4>
                                  {vuln.references.map((ref, idx) => (
                                    <a key={idx} href={ref} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:underline flex items-center gap-1">
                                      <ExternalLink className="w-3 h-3" />
                                      {ref}
                                    </a>
                                  ))}
                                </div>
                              </div>
                            </ScrollArea>
                          </DialogContent>
                        </Dialog>
                      ))}
                    </div>
                  </ScrollArea>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Scans Tab */}
            <TabsContent value="scans" className="space-y-6">
              {/* Scans Banner */}
              <div className="bg-gradient-to-r from-blue-600 via-cyan-600 to-teal-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Scan Management</h2>
                    <p className="text-blue-100">Tenable-level scanning orchestration and scheduling</p>
                    <p className="text-blue-200 text-xs mt-1">Network scans • Web app testing • Container security</p>
                  </div>
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.totalScans}</p>
                      <p className="text-blue-200 text-sm">Total Scans</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.runningScans}</p>
                      <p className="text-blue-200 text-sm">Running</p>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {mockScans.map((scan) => (
                  <Card key={scan.id} className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div className="flex items-start gap-3">
                          <div className="p-2 bg-gradient-to-br from-red-500 to-orange-600 rounded-lg">
                            <Search className="w-5 h-5 text-white" />
                          </div>
                          <div>
                            <CardTitle className="text-lg">{scan.name}</CardTitle>
                            <CardDescription className="mt-1">{scan.description}</CardDescription>
                          </div>
                        </div>
                        <Badge className={getStatusColor(scan.status)}>{scan.status}</Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4">
                        {scan.status === 'running' && (
                          <div>
                            <div className="flex justify-between text-sm mb-1">
                              <span className="text-gray-500">Progress</span>
                              <span className="font-medium">{scan.progress}%</span>
                            </div>
                            <Progress value={scan.progress} className="h-2" />
                          </div>
                        )}
                        <div className="flex flex-wrap gap-2">
                          <Badge className={getScanTypeColor(scan.type)}>{scan.type.replace('_', ' ')}</Badge>
                          <Badge variant="outline">{scan.policy}</Badge>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-2 md:gap-6 text-center">
                          <div className="p-2 bg-red-50 rounded-lg">
                            <p className="text-lg font-bold text-red-700">{scan.vulnCritical}</p>
                            <p className="text-xs text-red-600">Critical</p>
                          </div>
                          <div className="p-2 bg-orange-50 rounded-lg">
                            <p className="text-lg font-bold text-orange-700">{scan.vulnHigh}</p>
                            <p className="text-xs text-orange-600">High</p>
                          </div>
                          <div className="p-2 bg-yellow-50 rounded-lg">
                            <p className="text-lg font-bold text-yellow-700">{scan.vulnMedium}</p>
                            <p className="text-xs text-yellow-600">Medium</p>
                          </div>
                          <div className="p-2 bg-blue-50 rounded-lg">
                            <p className="text-lg font-bold text-blue-700">{scan.vulnLow}</p>
                            <p className="text-xs text-blue-600">Low</p>
                          </div>
                          <div className="p-2 bg-gray-50 rounded-lg">
                            <p className="text-lg font-bold text-gray-700">{scan.vulnInfo}</p>
                            <p className="text-xs text-gray-600">Info</p>
                          </div>
                        </div>
                        <div className="flex justify-between text-sm text-gray-500">
                          <span>{scan.hostsUp}/{scan.hostsScanned} hosts up</span>
                          <span>Duration: {formatDuration(scan.duration)}</span>
                        </div>
                        <div className="flex gap-2 pt-4 border-t border-gray-100 dark:border-gray-700">
                          {scan.status === 'completed' && (
                            <>
                              <Button size="sm" className="flex-1 bg-gradient-to-r from-red-600 to-orange-600 text-white" onClick={() => setActiveTab('vulnerabilities')}>View Results</Button>
                              <Button size="sm" variant="outline" onClick={() => handleStartScan(scan.id)} disabled={isSaving}><RefreshCw className="w-4 h-4" /></Button>
                            </>
                          )}
                          {scan.status === 'running' && (
                            <Button size="sm" variant="outline" className="flex-1" onClick={() => handleStopScan(scan.id)} disabled={isSaving}><Pause className="w-4 h-4 mr-1" /> Pause</Button>
                          )}
                          {scan.status === 'scheduled' && (
                            <Button size="sm" className="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white" onClick={() => handleStartScan(scan.id)} disabled={isSaving}><Play className="w-4 h-4 mr-1" /> Start Now</Button>
                          )}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Assets Tab */}
            <TabsContent value="assets" className="space-y-6">
              {/* Assets Banner */}
              <div className="bg-gradient-to-r from-emerald-600 via-green-600 to-teal-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Asset Inventory</h2>
                    <p className="text-emerald-100">CrowdStrike-level asset discovery and classification</p>
                    <p className="text-emerald-200 text-xs mt-1">Auto-discovery • Agent status • Risk scoring</p>
                  </div>
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{stats.totalAssets}</p>
                      <p className="text-emerald-200 text-sm">Total Assets</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{mockAssets.filter(a => a.agent).length}</p>
                      <p className="text-emerald-200 text-sm">With Agent</p>
                    </div>
                  </div>
                </div>
              </div>

              <Card className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Server className="w-5 h-5 text-blue-600" />
                    Scanned Assets
                  </CardTitle>
                  <CardDescription>All assets discovered and scanned by vulnerability scanners</CardDescription>
                </CardHeader>
                <CardContent>
                  <ScrollArea className="h-[500px]">
                    <div className="space-y-4">
                      {mockAssets.map((asset) => (
                        <div key={asset.id} className="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl">
                          <div className="flex items-center gap-4">
                            <div className="p-2 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg">
                              {getAssetTypeIcon(asset.type)}
                            </div>
                            <div>
                              <p className="font-semibold text-gray-900 dark:text-white">{asset.hostname}</p>
                              <p className="text-sm text-gray-500">{asset.ipAddress} • {asset.os} {asset.osVersion}</p>
                              <div className="flex gap-2 mt-1">
                                {asset.tags.map((tag, idx) => (
                                  <Badge key={idx} variant="outline" className="text-xs">{tag}</Badge>
                                ))}
                              </div>
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="flex gap-2 justify-end mb-2">
                              {asset.criticalCount > 0 && <Badge className="bg-red-100 text-red-700">{asset.criticalCount} critical</Badge>}
                              {asset.highCount > 0 && <Badge className="bg-orange-100 text-orange-700">{asset.highCount} high</Badge>}
                              {asset.agent && <Badge className="bg-green-100 text-green-700">Agent</Badge>}
                            </div>
                            <p className="text-xs text-gray-500">Last scan: {formatDateTime(asset.lastScanned)}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </ScrollArea>
                </CardContent>
              </Card>
            </TabsContent>

            {/* Policies Tab */}
            <TabsContent value="policies" className="space-y-6">
              {/* Policies Banner */}
              <div className="bg-gradient-to-r from-amber-600 via-orange-600 to-rose-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Scan Policies</h2>
                    <p className="text-amber-100">Rapid7-level policy configuration and customization</p>
                    <p className="text-amber-200 text-xs mt-1">Plugin management • Compliance checks • Credential configs</p>
                  </div>
                  <div className="flex items-center gap-6">
                    <div className="text-center">
                      <p className="text-3xl font-bold">{mockPolicies.length}</p>
                      <p className="text-amber-200 text-sm">Policies</p>
                    </div>
                    <div className="text-center">
                      <p className="text-3xl font-bold">{mockPolicies.reduce((sum, p) => sum + p.scansCount, 0)}</p>
                      <p className="text-amber-200 text-sm">Scans Run</p>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {mockPolicies.map((policy) => (
                  <Card key={policy.id} className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <CardHeader>
                      <div className="flex items-start justify-between">
                        <div>
                          <CardTitle>{policy.name}</CardTitle>
                          <CardDescription className="mt-1">{policy.description}</CardDescription>
                        </div>
                        <Badge className={getScanTypeColor(policy.type)}>{policy.type.replace('_', ' ')}</Badge>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-4">
                        <div className="text-center p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                          <p className="text-lg font-bold text-gray-900 dark:text-white">{policy.plugins.toLocaleString()}</p>
                          <p className="text-xs text-gray-500">Plugins</p>
                        </div>
                        <div className="text-center p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                          <p className="text-lg font-bold text-gray-900 dark:text-white">{policy.audits}</p>
                          <p className="text-xs text-gray-500">Audits</p>
                        </div>
                        <div className="text-center p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                          <p className="text-lg font-bold text-gray-900 dark:text-white">{policy.scansCount}</p>
                          <p className="text-xs text-gray-500">Scans Run</p>
                        </div>
                      </div>
                      <div className="flex flex-wrap gap-2 mb-4">
                        {policy.credentialed && <Badge className="bg-blue-100 text-blue-700">Credentialed</Badge>}
                        {policy.compliance && <Badge className="bg-purple-100 text-purple-700">Compliance</Badge>}
                        {policy.aggressive && <Badge className="bg-red-100 text-red-700">Aggressive</Badge>}
                      </div>
                      <div className="text-xs text-gray-500">
                        Last used: {formatDate(policy.lastUsed)}
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </TabsContent>

            {/* Settings Tab - Snyk Level */}
            <TabsContent value="settings" className="space-y-6">
              {/* Settings Banner */}
              <div className="bg-gradient-to-r from-slate-600 via-gray-600 to-zinc-600 rounded-2xl p-6 text-white">
                <div className="flex items-center justify-between">
                  <div>
                    <h2 className="text-2xl font-bold mb-2">Scanner Settings</h2>
                    <p className="text-slate-100">Snyk-level security scanner configuration</p>
                    <p className="text-slate-200 text-xs mt-1">Customizable scanning • Alert rules • Data retention</p>
                    <p className="text-slate-200 text-xs mt-1">Scan configs • Policies • Integrations • Reporting</p>
                  </div>
                </div>
              </div>

              <Tabs value={settingsTab} onValueChange={setSettingsTab}>
                <TabsList className="grid w-full grid-cols-6 mb-6">
                  <TabsTrigger value="scanning" className="gap-2">
                    <Search className="w-4 h-4" />
                    Scanning
                  </TabsTrigger>
                  <TabsTrigger value="policies" className="gap-2">
                    <Shield className="w-4 h-4" />
                    Policies
                  </TabsTrigger>
                  <TabsTrigger value="notifications" className="gap-2">
                    <Bell className="w-4 h-4" />
                    Notifications
                  </TabsTrigger>
                  <TabsTrigger value="integrations" className="gap-2">
                    <Link2 className="w-4 h-4" />
                    Integrations
                  </TabsTrigger>
                  <TabsTrigger value="reporting" className="gap-2">
                    <FileText className="w-4 h-4" />
                    Reporting
                  </TabsTrigger>
                  <TabsTrigger value="advanced" className="gap-2">
                    <Settings className="w-4 h-4" />
                    Advanced
                  </TabsTrigger>
                </TabsList>

                {/* Scanning Settings */}
                <TabsContent value="scanning" className="space-y-6">
                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-red-100 dark:bg-red-900/30 rounded-lg">
                          <Search className="w-5 h-5 text-red-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Scan Configuration</h3>
                          <p className="text-sm text-gray-500">Default scan settings</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Default Scan Mode</Label>
                          <Select defaultValue="standard">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="quick">Quick Scan</SelectItem>
                              <SelectItem value="standard">Standard Scan</SelectItem>
                              <SelectItem value="deep">Deep Scan</SelectItem>
                              <SelectItem value="compliance">Compliance Scan</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Aggressive Scanning</Label>
                            <p className="text-xs text-gray-500">May cause service disruption</p>
                          </div>
                          <Switch />
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Credentialed Scans</Label>
                            <p className="text-xs text-gray-500">Use authentication</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Safe Checks Only</Label>
                            <p className="text-xs text-gray-500">Skip potentially dangerous checks</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
                          <Timer className="w-5 h-5 text-orange-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Scheduling</h3>
                          <p className="text-sm text-gray-500">Automated scan schedules</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Default Schedule</Label>
                          <Select defaultValue="weekly">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="daily">Daily</SelectItem>
                              <SelectItem value="weekly">Weekly</SelectItem>
                              <SelectItem value="monthly">Monthly</SelectItem>
                              <SelectItem value="custom">Custom</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Scan Window</Label>
                          <Select defaultValue="night">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="any">Any Time</SelectItem>
                              <SelectItem value="business">Business Hours</SelectItem>
                              <SelectItem value="night">Night (00:00-06:00)</SelectItem>
                              <SelectItem value="weekend">Weekends Only</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Auto-Reschedule Failed</Label>
                            <p className="text-xs text-gray-500">Retry failed scans</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                      </div>
                    </Card>
                  </div>

                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                        <Target className="w-5 h-5 text-blue-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-gray-900 dark:text-white">Target Discovery</h3>
                        <p className="text-sm text-gray-500">Asset discovery settings</p>
                      </div>
                    </div>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div className="flex items-center justify-between p-4 border rounded-lg dark:border-gray-700">
                        <div>
                          <Label>Auto-Discovery</Label>
                          <p className="text-xs text-gray-500">Find new assets</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                      <div className="flex items-center justify-between p-4 border rounded-lg dark:border-gray-700">
                        <div>
                          <Label>Port Scanning</Label>
                          <p className="text-xs text-gray-500">Scan all ports</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                      <div className="flex items-center justify-between p-4 border rounded-lg dark:border-gray-700">
                        <div>
                          <Label>Service Detection</Label>
                          <p className="text-xs text-gray-500">Identify services</p>
                        </div>
                        <Switch defaultChecked />
                      </div>
                    </div>
                  </Card>
                </TabsContent>

                {/* Policies Settings */}
                <TabsContent value="policies" className="space-y-6">
                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                          <Shield className="w-5 h-5 text-purple-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Vulnerability Policy</h3>
                          <p className="text-sm text-gray-500">Severity and remediation rules</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Critical SLA</Label>
                          <Select defaultValue="24">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="4">4 hours</SelectItem>
                              <SelectItem value="24">24 hours</SelectItem>
                              <SelectItem value="72">72 hours</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>High SLA</Label>
                          <Select defaultValue="7">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="3">3 days</SelectItem>
                              <SelectItem value="7">7 days</SelectItem>
                              <SelectItem value="14">14 days</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Medium SLA</Label>
                          <Select defaultValue="30">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="14">14 days</SelectItem>
                              <SelectItem value="30">30 days</SelectItem>
                              <SelectItem value="60">60 days</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                          <Lock className="w-5 h-5 text-green-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Compliance Standards</h3>
                          <p className="text-sm text-gray-500">Enable compliance checks</p>
                        </div>
                      </div>
                      <div className="space-y-3">
                        {[
                          { label: 'PCI-DSS', desc: 'Payment Card Industry', enabled: true },
                          { label: 'HIPAA', desc: 'Healthcare compliance', enabled: false },
                          { label: 'SOC 2', desc: 'Service organization controls', enabled: true },
                          { label: 'ISO 27001', desc: 'Information security', enabled: true },
                          { label: 'GDPR', desc: 'Data protection', enabled: true },
                        ].map((item, idx) => (
                          <div key={idx} className="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div>
                              <Label className="font-medium">{item.label}</Label>
                              <p className="text-xs text-gray-500">{item.desc}</p>
                            </div>
                            <Switch defaultChecked={item.enabled} />
                          </div>
                        ))}
                      </div>
                    </Card>
                  </div>

                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
                        <AlertTriangle className="w-5 h-5 text-orange-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-gray-900 dark:text-white">Risk Thresholds</h3>
                        <p className="text-sm text-gray-500">Define acceptable risk levels</p>
                      </div>
                    </div>
                    <div className="grid md:grid-cols-4 gap-4">
                      {[
                        { level: 'Critical', max: '0', color: 'red' },
                        { level: 'High', max: '5', color: 'orange' },
                        { level: 'Medium', max: '25', color: 'yellow' },
                        { level: 'Low', max: '100', color: 'blue' },
                      ].map((item, idx) => (
                        <div key={idx} className="p-4 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
                          <Badge className={`bg-${item.color}-100 text-${item.color}-700 mb-2`}>{item.level}</Badge>
                          <div className="space-y-2">
                            <Label>Max Allowed</Label>
                            <Input defaultValue={item.max} className="h-8" />
                          </div>
                        </div>
                      ))}
                    </div>
                  </Card>
                </TabsContent>

                {/* Notifications Settings */}
                <TabsContent value="notifications" className="space-y-6">
                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                          <Mail className="w-5 h-5 text-blue-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Email Alerts</h3>
                          <p className="text-sm text-gray-500">Vulnerability notifications</p>
                        </div>
                      </div>
                      <div className="space-y-3">
                        {[
                          { label: 'Critical Vulnerabilities', desc: 'Immediate alert for critical', enabled: true },
                          { label: 'High Vulnerabilities', desc: 'Alert for high severity', enabled: true },
                          { label: 'Scan Completed', desc: 'When scans finish', enabled: true },
                          { label: 'Scan Failed', desc: 'When scans fail', enabled: true },
                          { label: 'New Asset Discovered', desc: 'When new assets found', enabled: false },
                          { label: 'SLA Breach', desc: 'Remediation overdue', enabled: true },
                        ].map((item, idx) => (
                          <div key={idx} className="flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div>
                              <Label className="font-medium">{item.label}</Label>
                              <p className="text-xs text-gray-500">{item.desc}</p>
                            </div>
                            <Switch defaultChecked={item.enabled} />
                          </div>
                        ))}
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                          <Users className="w-5 h-5 text-purple-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Team Notifications</h3>
                          <p className="text-sm text-gray-500">Who receives alerts</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Security Team Email</Label>
                          <Input defaultValue="security@company.com" />
                        </div>
                        <div className="space-y-2">
                          <Label>DevOps Team Email</Label>
                          <Input defaultValue="devops@company.com" />
                        </div>
                        <div className="space-y-2">
                          <Label>Escalation Contact</Label>
                          <Input defaultValue="ciso@company.com" />
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Auto-Escalate Critical</Label>
                            <p className="text-xs text-gray-500">Escalate after 4 hours</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                      </div>
                    </Card>
                  </div>

                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                        <FileText className="w-5 h-5 text-green-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-gray-900 dark:text-white">Report Schedule</h3>
                        <p className="text-sm text-gray-500">Automated vulnerability reports</p>
                      </div>
                    </div>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label>Executive Summary</Label>
                        <Select defaultValue="weekly">
                          <SelectTrigger>
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="daily">Daily</SelectItem>
                            <SelectItem value="weekly">Weekly</SelectItem>
                            <SelectItem value="monthly">Monthly</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Technical Report</Label>
                        <Select defaultValue="weekly">
                          <SelectTrigger>
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="daily">Daily</SelectItem>
                            <SelectItem value="weekly">Weekly</SelectItem>
                            <SelectItem value="monthly">Monthly</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Compliance Report</Label>
                        <Select defaultValue="monthly">
                          <SelectTrigger>
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="weekly">Weekly</SelectItem>
                            <SelectItem value="monthly">Monthly</SelectItem>
                            <SelectItem value="quarterly">Quarterly</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </Card>
                </TabsContent>

                {/* Integrations Settings */}
                <TabsContent value="integrations" className="space-y-6">
                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <div className="flex items-center gap-3 mb-6">
                      <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                        <Link2 className="w-5 h-5 text-purple-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-gray-900 dark:text-white">Connected Services</h3>
                        <p className="text-sm text-gray-500">Third-party integrations</p>
                      </div>
                    </div>
                    <div className="grid md:grid-cols-2 gap-4">
                      {[
                        { name: 'Jira', desc: 'Create tickets for findings', status: 'connected', icon: '🎫' },
                        { name: 'Slack', desc: 'Real-time alerts', status: 'connected', icon: '💬' },
                        { name: 'PagerDuty', desc: 'Critical incident alerts', status: 'connected', icon: '🚨' },
                        { name: 'ServiceNow', desc: 'ITSM integration', status: 'available', icon: '🔧' },
                        { name: 'Splunk', desc: 'SIEM integration', status: 'available', icon: '📊' },
                        { name: 'AWS Security Hub', desc: 'Cloud findings', status: 'connected', icon: '☁️' },
                      ].map((integration, idx) => (
                        <div key={idx} className="flex items-center justify-between p-4 border rounded-lg dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 transition-colors">
                          <div className="flex items-center gap-3">
                            <span className="text-2xl">{integration.icon}</span>
                            <div>
                              <div className="font-medium text-gray-900 dark:text-white">{integration.name}</div>
                              <p className="text-sm text-gray-500">{integration.desc}</p>
                            </div>
                          </div>
                          <div className="flex items-center gap-2">
                            <Badge className={
                              integration.status === 'connected'
                                ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400'
                                : 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400'
                            }>
                              {integration.status === 'connected' ? 'Connected' : 'Available'}
                            </Badge>
                            <Button size="sm" variant="outline" onClick={() => handleConfigureIntegration(integration)}>
                              {integration.status === 'connected' ? 'Configure' : 'Connect'}
                            </Button>
                          </div>
                        </div>
                      ))}
                    </div>
                  </Card>

                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg">
                          <Webhook className="w-5 h-5 text-orange-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Webhooks</h3>
                          <p className="text-sm text-gray-500">Real-time event notifications</p>
                        </div>
                      </div>
                      <div className="space-y-3">
                        <div className="space-y-2">
                          <Label>Webhook URL</Label>
                          <Input placeholder="https://api.yourapp.com/webhooks/vulns" disabled />
                        </div>
                        <Button variant="outline" className="w-full gap-2" onClick={() => setShowWebhookDialog(true)}>
                          <Plus className="w-4 h-4" />
                          Add Webhook
                        </Button>
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                          <Key className="w-5 h-5 text-blue-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">API Access</h3>
                          <p className="text-sm text-gray-500">Developer API keys</p>
                        </div>
                      </div>
                      <div className="space-y-3">
                        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg font-mono text-sm truncate">
                          {apiKey.substring(0, 8)}••••••••••••••••••••
                        </div>
                        <div className="flex gap-2">
                          <Button variant="outline" className="flex-1 gap-2" onClick={() => { navigator.clipboard.writeText(apiKey); toast.success('API key copied to clipboard'); }}>
                            <Copy className="w-4 h-4" />
                            Copy Key
                          </Button>
                          <Button variant="outline" className="gap-2" onClick={() => { if (confirm('Are you sure you want to regenerate the API key? This will invalidate the current key.')) { handleRegenerateApiKey() } }} disabled={isRegeneratingKey}>
                            <RefreshCw className={`w-4 h-4 ${isRegeneratingKey ? 'animate-spin' : ''}`} />
                            {isRegeneratingKey ? 'Regenerating...' : 'Regenerate'}
                          </Button>
                        </div>
                      </div>
                    </Card>
                  </div>
                </TabsContent>

                {/* Reporting Settings */}
                <TabsContent value="reporting" className="space-y-6">
                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                          <FileText className="w-5 h-5 text-blue-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Report Templates</h3>
                          <p className="text-sm text-gray-500">Customize report formats</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Default Format</Label>
                          <Select defaultValue="pdf">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="pdf">PDF Report</SelectItem>
                              <SelectItem value="html">HTML Report</SelectItem>
                              <SelectItem value="csv">CSV Export</SelectItem>
                              <SelectItem value="json">JSON Export</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Include Executive Summary</Label>
                            <p className="text-xs text-gray-500">High-level overview</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Include Remediation Steps</Label>
                            <p className="text-xs text-gray-500">Fix instructions</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Include CVSS Details</Label>
                            <p className="text-xs text-gray-500">Full CVSS vectors</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                          <Palette className="w-5 h-5 text-purple-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Branding</h3>
                          <p className="text-sm text-gray-500">Customize report appearance</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Company Logo URL</Label>
                          <Input placeholder="https://cdn.company.com/logo.png" />
                        </div>
                        <div className="space-y-2">
                          <Label>Company Name</Label>
                          <Input defaultValue="FreeFlow Inc." />
                        </div>
                        <div className="space-y-2">
                          <Label>Report Footer</Label>
                          <Input defaultValue="Confidential - Internal Use Only" />
                        </div>
                      </div>
                    </Card>
                  </div>

                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg">
                        <BarChart3 className="w-5 h-5 text-green-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-gray-900 dark:text-white">Metrics & KPIs</h3>
                        <p className="text-sm text-gray-500">Track vulnerability metrics</p>
                      </div>
                    </div>
                    <div className="grid md:grid-cols-4 gap-4">
                      {[
                        { label: 'Mean Time to Remediate', value: '4.2 days', trend: '-12%' },
                        { label: 'Open Critical Vulns', value: '3', trend: '-2' },
                        { label: 'Fix Rate', value: '94%', trend: '+5%' },
                        { label: 'Compliance Score', value: '87%', trend: '+3%' },
                      ].map((item, idx) => (
                        <div key={idx} className="p-4 border rounded-lg dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
                          <div className="text-sm text-gray-500 mb-1">{item.label}</div>
                          <div className="text-2xl font-bold text-gray-900 dark:text-white">{item.value}</div>
                          <div className="text-sm text-green-600">{item.trend}</div>
                        </div>
                      ))}
                    </div>
                  </Card>
                </TabsContent>

                {/* Advanced Settings */}
                <TabsContent value="advanced" className="space-y-6">
                  <div className="grid md:grid-cols-2 gap-6">
                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                          <Server className="w-5 h-5 text-blue-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Scanner Configuration</h3>
                          <p className="text-sm text-gray-500">Advanced scanner settings</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Max Concurrent Hosts</Label>
                          <Select defaultValue="50">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="10">10 hosts</SelectItem>
                              <SelectItem value="25">25 hosts</SelectItem>
                              <SelectItem value="50">50 hosts</SelectItem>
                              <SelectItem value="100">100 hosts</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Network Timeout</Label>
                          <Select defaultValue="5">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="3">3 seconds</SelectItem>
                              <SelectItem value="5">5 seconds</SelectItem>
                              <SelectItem value="10">10 seconds</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>CGI Scanning</Label>
                            <p className="text-xs text-gray-500">Enable CGI checks</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                      </div>
                    </Card>

                    <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg">
                      <div className="flex items-center gap-3 mb-4">
                        <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                          <Database className="w-5 h-5 text-purple-600" />
                        </div>
                        <div>
                          <h3 className="font-semibold text-gray-900 dark:text-white">Data Management</h3>
                          <p className="text-sm text-gray-500">Data retention settings</p>
                        </div>
                      </div>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <Label>Scan History Retention</Label>
                          <Select defaultValue="365">
                            <SelectTrigger>
                              <SelectValue />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="90">90 days</SelectItem>
                              <SelectItem value="180">180 days</SelectItem>
                              <SelectItem value="365">1 year</SelectItem>
                              <SelectItem value="730">2 years</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center justify-between">
                          <div>
                            <Label>Archive Old Scans</Label>
                            <p className="text-xs text-gray-500">Move to cold storage</p>
                          </div>
                          <Switch defaultChecked />
                        </div>
                        <Button variant="outline" className="w-full gap-2" onClick={() => {
                          toast.loading('Exporting scan data...', { id: 'data-export' })
                          setTimeout(() => {
                            toast.success('All scan data exported successfully!', { id: 'data-export' })
                          }, 1500)
                        }}>
                          <Download className="w-4 h-4" />
                          Export All Data
                        </Button>
                      </div>
                    </Card>
                  </div>

                  <Card className="p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg border-red-200 dark:border-red-800">
                    <div className="flex items-center gap-3 mb-4">
                      <div className="p-2 bg-red-100 dark:bg-red-900/30 rounded-lg">
                        <AlertTriangle className="w-5 h-5 text-red-600" />
                      </div>
                      <div>
                        <h3 className="font-semibold text-red-700 dark:text-red-400">Danger Zone</h3>
                        <p className="text-sm text-red-600 dark:text-red-400">Irreversible actions</p>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <div className="flex items-center justify-between p-4 border border-red-200 dark:border-red-700 rounded-lg bg-white dark:bg-gray-800">
                        <div>
                          <div className="font-medium text-gray-900 dark:text-white">Reset All Scan Policies</div>
                          <p className="text-sm text-gray-500">Restore default policies</p>
                        </div>
                        <Button variant="outline" className="text-red-600 border-red-300 hover:bg-red-50" onClick={() => {
                          if (confirm('Are you sure you want to reset all scan policies to their defaults? This action cannot be undone.')) {
                            toast.loading('Resetting scan policies...', { id: 'policy-reset' })
                            setTimeout(() => {
                              toast.success('All scan policies reset to defaults', { id: 'policy-reset' })
                            }, 1000)
                          }
                        }}>
                          Reset
                        </Button>
                      </div>
                      <div className="flex items-center justify-between p-4 border border-red-200 dark:border-red-700 rounded-lg bg-white dark:bg-gray-800">
                        <div>
                          <div className="font-medium text-gray-900 dark:text-white">Clear Vulnerability History</div>
                          <p className="text-sm text-gray-500">Delete all historical data</p>
                        </div>
                        <Button variant="outline" className="text-red-600 border-red-300 hover:bg-red-50" onClick={() => {
                          if (confirm('Are you sure you want to clear all vulnerability history? This action cannot be undone.')) {
                            toast.loading('Clearing vulnerability history...', { id: 'history-clear' })
                            setTimeout(() => {
                              toast.success('Vulnerability history cleared', { id: 'history-clear' })
                            }, 1000)
                          }
                        }}>
                          Clear
                        </Button>
                      </div>
                    </div>
                  </Card>
                </TabsContent>
              </Tabs>
            </TabsContent>
          </Tabs>

          {/* Enhanced Competitive Upgrade Components */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
            <div className="lg:col-span-2">
              <AIInsightsPanel
                insights={mockVulnScanAIInsights}
                title="Security Intelligence"
                onInsightAction={(insight) => toast.info(insight.title || 'AI Insight', { description: insight.description || 'View insight details' })}
              />
            </div>
            <div className="space-y-6">
              <CollaborationIndicator
                collaborators={mockVulnScanCollaborators}
                maxVisible={4}
              />
              <PredictiveAnalytics
                predictions={mockVulnScanPredictions}
                title="Security Forecasts"
              />
            </div>
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <ActivityFeed
              activities={mockVulnScanActivities}
              title="Security Activity"
              maxItems={5}
            />
            <QuickActionsToolbar
              actions={mockVulnScanQuickActions}
              variant="grid"
            />
          </div>
        </div>
      </div>

      {/* Run Scan Dialog */}
      <Dialog open={showRunScanDialog} onOpenChange={setShowRunScanDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Play className="w-5 h-5 text-red-600" />
              Run Vulnerability Scan
            </DialogTitle>
            <DialogDescription>
              Start a new vulnerability scan on your infrastructure
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label>Scan Type</Label>
              <Select defaultValue="network">
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="network">Network Scan</SelectItem>
                  <SelectItem value="web">Web Application</SelectItem>
                  <SelectItem value="container">Container Scan</SelectItem>
                  <SelectItem value="cloud">Cloud Infrastructure</SelectItem>
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label>Target Range</Label>
              <Input placeholder="10.0.0.0/24 or hostname" />
            </div>
            <div className="flex items-center justify-between">
              <div>
                <Label>Deep Scan</Label>
                <p className="text-xs text-gray-500">More thorough but slower</p>
              </div>
              <Switch />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowRunScanDialog(false)}>Cancel</Button>
            <Button
              onClick={() => {
                setShowRunScanDialog(false)
                handleStartScan()
              }}
              className="bg-gradient-to-r from-red-600 to-orange-600 text-white"
            >
              Start Scan
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* View CVEs Dialog */}
      <Dialog open={showViewCVEsDialog} onOpenChange={setShowViewCVEsDialog}>
        <DialogContent className="max-w-2xl">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Shield className="w-5 h-5 text-blue-600" />
              CVE Database
            </DialogTitle>
            <DialogDescription>
              Known vulnerabilities tracked in your environment
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
              <div>
                <p className="font-medium text-red-700">Critical CVEs</p>
                <p className="text-sm text-red-600">Affecting your dependencies</p>
              </div>
              <Badge className="bg-red-100 text-red-700">{stats.critical}</Badge>
            </div>
            <div className="flex items-center justify-between p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
              <div>
                <p className="font-medium text-orange-700">High CVEs</p>
                <p className="text-sm text-orange-600">Requiring attention</p>
              </div>
              <Badge className="bg-orange-100 text-orange-700">{stats.high}</Badge>
            </div>
            <ScrollArea className="h-[200px]">
              <div className="space-y-2">
                {mockVulnerabilities.map((vuln) => (
                  <div key={vuln.id} className="flex items-center justify-between p-2 border rounded-lg">
                    <div>
                      <p className="font-medium text-sm">{vuln.cveId}</p>
                      <p className="text-xs text-gray-500 truncate max-w-[300px]">{vuln.title}</p>
                    </div>
                    <Badge className={getSeverityColor(vuln.severity)}>{vuln.severity}</Badge>
                  </div>
                ))}
              </div>
            </ScrollArea>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowViewCVEsDialog(false)}>Close</Button>
            <Button
              onClick={() => {
                setShowViewCVEsDialog(false)
                setActiveTab('vulnerabilities')
              }}
              className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white"
            >
              View All Vulnerabilities
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Export Report Dialog */}
      <Dialog open={showExportReportDialog} onOpenChange={setShowExportReportDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Download className="w-5 h-5 text-green-600" />
              Export Security Report
            </DialogTitle>
            <DialogDescription>
              Generate and download a vulnerability report
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label>Report Format</Label>
              <Select defaultValue="pdf">
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="pdf">PDF Report</SelectItem>
                  <SelectItem value="csv">CSV Export</SelectItem>
                  <SelectItem value="json">JSON Data</SelectItem>
                  <SelectItem value="html">HTML Report</SelectItem>
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label>Include Sections</Label>
              <div className="space-y-2">
                <div className="flex items-center gap-2">
                  <Switch defaultChecked id="exec-summary" />
                  <Label htmlFor="exec-summary" className="text-sm">Executive Summary</Label>
                </div>
                <div className="flex items-center gap-2">
                  <Switch defaultChecked id="vuln-details" />
                  <Label htmlFor="vuln-details" className="text-sm">Vulnerability Details</Label>
                </div>
                <div className="flex items-center gap-2">
                  <Switch defaultChecked id="remediation" />
                  <Label htmlFor="remediation" className="text-sm">Remediation Steps</Label>
                </div>
              </div>
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowExportReportDialog(false)}>Cancel</Button>
            <Button
              onClick={() => {
                setShowExportReportDialog(false)
                handleExportReport()
              }}
              className="bg-gradient-to-r from-green-600 to-emerald-600 text-white"
            >
              Export Report
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Alerts Dialog */}
      <Dialog open={showAlertsDialog} onOpenChange={setShowAlertsDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Bell className="w-5 h-5 text-orange-600" />
              Security Alerts
            </DialogTitle>
            <DialogDescription>
              Current vulnerability alerts and notifications
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            {stats.critical > 0 ? (
              <div className="p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200">
                <div className="flex items-center gap-2 mb-2">
                  <XCircle className="w-5 h-5 text-red-600" />
                  <span className="font-semibold text-red-700">Critical Alert</span>
                </div>
                <p className="text-sm text-red-600">
                  {stats.critical} critical vulnerability requires immediate attention
                </p>
              </div>
            ) : (
              <div className="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200">
                <div className="flex items-center gap-2 mb-2">
                  <CheckCircle className="w-5 h-5 text-green-600" />
                  <span className="font-semibold text-green-700">All Clear</span>
                </div>
                <p className="text-sm text-green-600">
                  No critical alerts at this time
                </p>
              </div>
            )}
            {stats.high > 0 && (
              <div className="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200">
                <div className="flex items-center gap-2 mb-2">
                  <AlertTriangle className="w-5 h-5 text-orange-600" />
                  <span className="font-semibold text-orange-700">High Priority</span>
                </div>
                <p className="text-sm text-orange-600">
                  {stats.high} high severity vulnerabilities detected
                </p>
              </div>
            )}
            <div className="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200">
              <div className="flex items-center gap-2 mb-2">
                <Info className="w-5 h-5 text-blue-600" />
                <span className="font-semibold text-blue-700">Summary</span>
              </div>
              <p className="text-sm text-blue-600">
                {stats.totalVulns} total vulnerabilities | {stats.open} open | {stats.fixed} fixed
              </p>
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowAlertsDialog(false)}>Close</Button>
            <Button
              onClick={() => {
                setShowAlertsDialog(false)
                setActiveTab('vulnerabilities')
                setSeverityFilter('critical')
              }}
              className="bg-gradient-to-r from-orange-600 to-red-600 text-white"
            >
              View Critical Issues
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Compare Scans Dialog */}
      <Dialog open={showCompareScansDialog} onOpenChange={setShowCompareScansDialog}>
        <DialogContent className="max-w-lg">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <GitBranch className="w-5 h-5 text-pink-600" />
              Compare Scans
            </DialogTitle>
            <DialogDescription>
              Select two scans to compare vulnerability findings
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label>First Scan (Baseline)</Label>
              <Select>
                <SelectTrigger>
                  <SelectValue placeholder="Select baseline scan" />
                </SelectTrigger>
                <SelectContent>
                  {mockScans.filter(s => s.status === 'completed').map((scan) => (
                    <SelectItem key={scan.id} value={scan.id}>
                      {scan.name} - {formatDate(scan.lastRun)}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div className="space-y-2">
              <Label>Second Scan (Compare)</Label>
              <Select>
                <SelectTrigger>
                  <SelectValue placeholder="Select scan to compare" />
                </SelectTrigger>
                <SelectContent>
                  {mockScans.filter(s => s.status === 'completed').map((scan) => (
                    <SelectItem key={scan.id} value={scan.id}>
                      {scan.name} - {formatDate(scan.lastRun)}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
            <div className="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
              <p className="text-sm text-gray-600 dark:text-gray-400">
                Compare scans to identify new vulnerabilities, fixed issues, and security trends over time.
              </p>
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowCompareScansDialog(false)}>Cancel</Button>
            <Button
              onClick={() => {
                setShowCompareScansDialog(false)
                toast.info('Scan comparison', { description: 'Comparison analysis will be generated for selected scans' })
              }}
              className="bg-gradient-to-r from-pink-600 to-purple-600 text-white"
            >
              Compare Scans
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Integration Configuration Dialog */}
      <Dialog open={showIntegrationDialog} onOpenChange={setShowIntegrationDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              {selectedIntegration && (
                <>
                  <span className="text-2xl">{selectedIntegration.icon}</span>
                  {selectedIntegration.status === 'connected' ? 'Configure' : 'Connect'} {selectedIntegration.name}
                </>
              )}
            </DialogTitle>
            <DialogDescription>
              {selectedIntegration?.status === 'connected'
                ? `Manage your ${selectedIntegration?.name} integration settings`
                : `Connect ${selectedIntegration?.name} to enable ${selectedIntegration?.desc.toLowerCase()}`
              }
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            {selectedIntegration?.status === 'connected' ? (
              <>
                <div className="space-y-2">
                  <Label>Connection Status</Label>
                  <div className="flex items-center gap-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                    <CheckCircle className="w-4 h-4 text-green-600" />
                    <span className="text-sm text-green-700 dark:text-green-400">Connected and active</span>
                  </div>
                </div>
                <div className="space-y-2">
                  <Label>Sync Frequency</Label>
                  <Select defaultValue="realtime">
                    <SelectTrigger>
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="realtime">Real-time</SelectItem>
                      <SelectItem value="5min">Every 5 minutes</SelectItem>
                      <SelectItem value="15min">Every 15 minutes</SelectItem>
                      <SelectItem value="hourly">Hourly</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="flex items-center justify-between">
                  <div>
                    <Label>Auto-create tickets</Label>
                    <p className="text-xs text-gray-500">For critical vulnerabilities</p>
                  </div>
                  <Switch defaultChecked />
                </div>
              </>
            ) : (
              <>
                <div className="space-y-2">
                  <Label>API Key / Token</Label>
                  <Input type="password" placeholder="Enter your API key" />
                </div>
                <div className="space-y-2">
                  <Label>Instance URL (optional)</Label>
                  <Input placeholder="https://your-instance.example.com" />
                </div>
                <div className="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                  <p className="text-sm text-blue-700 dark:text-blue-400">
                    Your credentials are encrypted and stored securely.
                  </p>
                </div>
              </>
            )}
          </div>
          <DialogFooter className="flex-col sm:flex-row gap-2">
            {selectedIntegration?.status === 'connected' && (
              <Button
                variant="outline"
                className="text-red-600 border-red-300 hover:bg-red-50"
                onClick={handleDisconnectIntegration}
                disabled={isSaving}
              >
                Disconnect
              </Button>
            )}
            <div className="flex gap-2 ml-auto">
              <Button variant="outline" onClick={() => setShowIntegrationDialog(false)}>Cancel</Button>
              <Button
                onClick={handleSaveIntegration}
                disabled={isSaving}
                className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white"
              >
                {isSaving ? 'Saving...' : selectedIntegration?.status === 'connected' ? 'Save Changes' : 'Connect'}
              </Button>
            </div>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Webhook Creation Dialog */}
      <Dialog open={showWebhookDialog} onOpenChange={setShowWebhookDialog}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Webhook className="w-5 h-5 text-orange-600" />
              Create Webhook
            </DialogTitle>
            <DialogDescription>
              Configure a webhook endpoint to receive real-time vulnerability notifications
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label>Webhook URL *</Label>
              <Input
                placeholder="https://api.yourapp.com/webhooks/vulns"
                value={webhookUrl}
                onChange={(e) => setWebhookUrl(e.target.value)}
              />
              <p className="text-xs text-gray-500">Must be a valid HTTPS URL</p>
            </div>
            <div className="space-y-3">
              <Label>Event Types</Label>
              <div className="space-y-2">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-red-500" />
                    <span className="text-sm">Critical vulnerabilities</span>
                  </div>
                  <Switch
                    checked={webhookEvents.critical}
                    onCheckedChange={(checked) => setWebhookEvents(prev => ({ ...prev, critical: checked }))}
                  />
                </div>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-orange-500" />
                    <span className="text-sm">High severity</span>
                  </div>
                  <Switch
                    checked={webhookEvents.high}
                    onCheckedChange={(checked) => setWebhookEvents(prev => ({ ...prev, high: checked }))}
                  />
                </div>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-yellow-500" />
                    <span className="text-sm">Medium severity</span>
                  </div>
                  <Switch
                    checked={webhookEvents.medium}
                    onCheckedChange={(checked) => setWebhookEvents(prev => ({ ...prev, medium: checked }))}
                  />
                </div>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-blue-500" />
                    <span className="text-sm">Low severity</span>
                  </div>
                  <Switch
                    checked={webhookEvents.low}
                    onCheckedChange={(checked) => setWebhookEvents(prev => ({ ...prev, low: checked }))}
                  />
                </div>
              </div>
            </div>
            <div className="p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
              <p className="text-sm text-orange-700 dark:text-orange-400">
                A test event will be sent to verify your endpoint after creation.
              </p>
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowWebhookDialog(false)}>Cancel</Button>
            <Button
              onClick={handleCreateWebhook}
              disabled={isSaving || !webhookUrl.trim()}
              className="bg-gradient-to-r from-orange-600 to-red-600 text-white"
            >
              {isSaving ? 'Creating...' : 'Create Webhook'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  )
}
