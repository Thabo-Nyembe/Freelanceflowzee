'use client'

import * as React from 'react'
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Progress } from '@/components/ui/progress'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'
import { Label } from '@/components/ui/label'
// import { toast } from 'sonner' // Removed - using alert() for user feedback
import { useRouter } from 'next/navigation'
import {
  Video,
  Users,
  Camera,
  FileText,
  Play,
  Edit3,
  Layers,
  BarChart3,
  Upload,
  Download,
  Settings,
  Clock,
  FileDown,
  Pause,
  RotateCcw,
  Save,
  Share2,
  Zap,
  Brain,
  Target,
  Award,
  TrendingUp,
  ChevronRight,
  ChevronDown,
  Plus,
  Search,
  Filter,
  Grid,
  List,
  LayoutGrid,
  LayoutList,
  Monitor,
  Headphones,
  Mic,
  Volume2,
  Scissors,
  Copy,
  PaintBucket,
  Sparkles,
  Film,
  Image,
  Music,
  Type,
  Palette,
  Wand2,
  RefreshCw,
  CheckCircle,
  AlertCircle,
  Calendar,
  Folder,
  Star,
  Eye,
  ThumbsUp,
  MessageSquare,
  Shield,
  Globe,
  Archive,
  Tag,
  Hash,
  MoreVertical,
  Square,
  X
} from 'lucide-react'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger
} from '@/components/ui/dropdown-menu'
import { EnhancedBreadcrumb } from '@/components/ui/enhanced-breadcrumb'
import { EnhancedSearch } from '@/components/ui/enhanced-search'
import { ContextualTooltip, HelpTooltip } from '@/components/ui/enhanced-contextual-tooltips'
import { AnimatedElement, AnimatedCounter, StaggeredContainer } from '@/components/ui/enhanced-micro-animations'
import { cn } from '@/lib/utils'
import { motion } from 'framer-motion'
import { EnhancedNavigation } from '@/components/navigation/enhanced-navigation'
import { RenderingQueue } from '@/components/video-studio/rendering-queue'

// World-Class Video Studio Data & Configuration
const VIDEO_STUDIO_DATA = {
  projects: [
    {
      id: '1',
      title: 'Brand Campaign 2024',
      description: 'Full marketing campaign with multiple video assets',
      client: 'TechCorp Inc.',
      status: 'in-progress',
      progress: 75,
      duration: '2:45',
      resolution: '4K',
      frameRate: '60fps',
      timeline: {
        created: '2024-01-15',
        lastModified: '2024-02-01',
        deadline: '2024-02-15'
      },
      collaborators: 3,
      assets: {
        video: 12,
        audio: 8,
        images: 24,
        graphics: 16
      },
      renders: {
        completed: 5,
        pending: 2,
        failed: 0
      },
      tags: ['Marketing', 'Brand', '4K', 'Commercial'],
      thumbnail: '/thumbnails/brand-campaign.jpg'
    },
    {
      id: '2',
      title: 'Product Demo Series',
      description: 'Educational video series showcasing product features',
      client: 'StartupXYZ',
      status: 'review',
      progress: 90,
      duration: '5:32',
      resolution: '1080p',
      frameRate: '30fps',
      timeline: {
        created: '2024-01-10',
        lastModified: '2024-01-28',
        deadline: '2024-02-05'
      },
      collaborators: 2,
      assets: {
        video: 8,
        audio: 5,
        images: 18,
        graphics: 12
      },
      renders: {
        completed: 8,
        pending: 0,
        failed: 1
      },
      tags: ['Tutorial', 'Product', 'Education', 'Series'],
      thumbnail: '/thumbnails/product-demo.jpg'
    },
    {
      id: '3',
      title: 'Social Media Content',
      description: 'Short-form content for Instagram, TikTok, and YouTube Shorts',
      client: 'InfluencerCo',
      status: 'completed',
      progress: 100,
      duration: '0:30',
      resolution: '1080p',
      frameRate: '60fps',
      timeline: {
        created: '2024-01-20',
        lastModified: '2024-01-25',
        deadline: '2024-01-30'
      },
      collaborators: 1,
      assets: {
        video: 15,
        audio: 10,
        images: 32,
        graphics: 28
      },
      renders: {
        completed: 12,
        pending: 0,
        failed: 0
      },
      tags: ['Social', 'Short-form', 'Viral', 'Mobile'],
      thumbnail: '/thumbnails/social-content.jpg'
    }
  ],

  templates: [
    {
      id: 't1',
      name: 'Corporate Intro',
      category: 'Business',
      duration: '0:15',
      resolution: '4K',
      downloads: 1250,
      rating: 4.8,
      thumbnail: '/templates/corporate-intro.jpg',
      premium: false
    },
    {
      id: 't2',
      name: 'Product Showcase',
      category: 'Marketing',
      duration: '1:00',
      resolution: '4K',
      downloads: 892,
      rating: 4.9,
      thumbnail: '/templates/product-showcase.jpg',
      premium: true
    },
    {
      id: 't3',
      name: 'Social Media Pack',
      category: 'Social',
      duration: '0:30',
      resolution: '1080p',
      downloads: 2156,
      rating: 4.7,
      thumbnail: '/templates/social-pack.jpg',
      premium: false
    }
  ],

  assets: {
    video: {
      total: 145,
      categories: [
        { name: 'Stock Footage', count: 45, size: '12.5GB' },
        { name: 'Motion Graphics', count: 32, size: '8.2GB' },
        { name: 'Animations', count: 28, size: '6.1GB' },
        { name: 'Transitions', count: 40, size: '2.8GB' }
      ]
    },
    audio: {
      total: 89,
      categories: [
        { name: 'Background Music', count: 35, size: '1.2GB' },
        { name: 'Sound Effects', count: 42, size: '850MB' },
        { name: 'Voiceovers', count: 12, size: '650MB' }
      ]
    },
    graphics: {
      total: 234,
      categories: [
        { name: 'Logos & Branding', count: 56, size: '2.1GB' },
        { name: 'Lower Thirds', count: 78, size: '1.8GB' },
        { name: 'Overlays', count: 65, size: '1.5GB' },
        { name: 'Backgrounds', count: 35, size: '3.2GB' }
      ]
    }
  },

  renderQueue: [
    {
      id: 'r1',
      project: 'Brand Campaign 2024',
      filename: 'brand_campaign_final_v3.mp4',
      status: 'rendering',
      progress: 67,
      resolution: '4K',
      format: 'MP4',
      codec: 'H.264',
      quality: 'High',
      estimatedTime: '8 minutes',
      startTime: '2024-02-01T14:30:00Z'
    },
    {
      id: 'r2',
      project: 'Product Demo Series',
      filename: 'demo_episode_01.mp4',
      status: 'queued',
      progress: 0,
      resolution: '1080p',
      format: 'MP4',
      codec: 'H.265',
      quality: 'Medium',
      estimatedTime: '5 minutes',
      startTime: null
    },
    {
      id: 'r3',
      project: 'Social Media Content',
      filename: 'instagram_story_final.mp4',
      status: 'completed',
      progress: 100,
      resolution: '1080p',
      format: 'MP4',
      codec: 'H.264',
      quality: 'High',
      estimatedTime: '2 minutes',
      startTime: '2024-02-01T13:45:00Z',
      completedTime: '2024-02-01T13:47:00Z'
    }
  ],

  analytics: {
    overview: {
      totalProjects: 47,
      completedProjects: 32,
      activeProjects: 8,
      totalRenderTime: '342 hours',
      storageUsed: '1.2TB',
      storageAvailable: '800GB'
    },
    performance: {
      avgRenderTime: '12.5 minutes',
      successRate: 94.2,
      collaborationScore: 8.7,
      clientSatisfaction: 9.1
    },
    productivity: {
      projectsThisMonth: 15,
      hoursThisMonth: 87,
      efficiencyScore: 92,
      automationSavings: '23 hours'
    }
  },

  aiFeatures: {
    autoEditing: {
      enabled: true,
      accuracy: 94.5,
      timesSaved: 156
    },
    smartCropping: {
      enabled: true,
      accuracy: 97.2,
      videosProcessed: 342
    },
    colorCorrection: {
      enabled: true,
      accuracy: 91.8,
      enhancementsApplied: 218
    },
    audioSync: {
      enabled: true,
      accuracy: 98.1,
      clipsProcessed: 445
    }
  }
}

export default function VideoStudioPage() {
  const router = useRouter()
  const [activeTab, setActiveTab] = React.useState('projects')
  const [selectedProject, setSelectedProject] = React.useState(null)
  const [viewMode, setViewMode] = React.useState('grid')
  const [searchTerm, setSearchTerm] = React.useState('')
  const [filterStatus, setFilterStatus] = React.useState('all')
  const [isCreateModalOpen, setIsCreateModalOpen] = React.useState(false)
  const [newProjectName, setNewProjectName] = React.useState('')
  const [newProjectDescription, setNewProjectDescription] = React.useState('')
  const [newProjectResolution, setNewProjectResolution] = React.useState('1080p')
  const [newProjectFrameRate, setNewProjectFrameRate] = React.useState('30fps')
  const [isCreatingProject, setIsCreatingProject] = React.useState(false)

  // REAL PROJECT STATE - Store created projects
  const [projects, setProjects] = React.useState<any[]>(VIDEO_STUDIO_DATA.projects)
  const [showEditor, setShowEditor] = React.useState(false)
  const [editorProject, setEditorProject] = React.useState<any>(null)
  const [showAssetLibrary, setShowAssetLibrary] = React.useState(false)
  const [renderQueue, setRenderQueue] = React.useState<any[]>(VIDEO_STUDIO_DATA.renderQueue)
  const [uploadedAssets, setUploadedAssets] = React.useState<any[]>([
    {
      id: 1,
      name: 'intro_clip.mp4',
      type: 'video',
      size: '45 MB',
      duration: '0:15',
      resolution: '1920x1080',
      fps: 30,
      thumbnail: '/assets/video.png',
      uploadDate: '2024-02-01',
      tags: ['intro', 'branding'],
      favorite: true
    },
    {
      id: 2,
      name: 'background_music.mp3',
      type: 'audio',
      size: '3.2 MB',
      duration: '2:30',
      bitrate: '320kbps',
      thumbnail: '/assets/audio.png',
      uploadDate: '2024-02-01',
      tags: ['music', 'background'],
      favorite: false
    },
    {
      id: 3,
      name: 'logo.png',
      type: 'image',
      size: '256 KB',
      dimensions: '1920x1080',
      format: 'PNG',
      thumbnail: '/assets/image.png',
      uploadDate: '2024-02-01',
      tags: ['logo', 'branding'],
      favorite: true
    },
    {
      id: 4,
      name: 'main_footage_4k.mp4',
      type: 'video',
      size: '2.1 GB',
      duration: '5:43',
      resolution: '3840x2160',
      fps: 60,
      thumbnail: '/assets/video.png',
      uploadDate: '2024-02-02',
      tags: ['footage', '4k', 'main'],
      favorite: false
    },
    {
      id: 5,
      name: 'voiceover_final.wav',
      type: 'audio',
      size: '89 MB',
      duration: '1:45',
      bitrate: '1411kbps',
      thumbnail: '/assets/audio.png',
      uploadDate: '2024-02-02',
      tags: ['voiceover', 'narration'],
      favorite: false
    },
    {
      id: 6,
      name: 'overlay_graphics.svg',
      type: 'image',
      size: '42 KB',
      dimensions: '1920x1080',
      format: 'SVG',
      thumbnail: '/assets/image.png',
      uploadDate: '2024-02-02',
      tags: ['graphics', 'overlay'],
      favorite: false
    },
    {
      id: 7,
      name: 'transition_01.mp4',
      type: 'video',
      size: '12 MB',
      duration: '0:03',
      resolution: '1920x1080',
      fps: 30,
      thumbnail: '/assets/video.png',
      uploadDate: '2024-02-03',
      tags: ['transition', 'effect'],
      favorite: true
    },
    {
      id: 8,
      name: 'sound_effects.mp3',
      type: 'audio',
      size: '8.5 MB',
      duration: '0:45',
      bitrate: '192kbps',
      thumbnail: '/assets/audio.png',
      uploadDate: '2024-02-03',
      tags: ['sfx', 'effects'],
      favorite: false
    }
  ])

  // Asset Library State
  const [assetViewMode, setAssetViewMode] = React.useState<'grid' | 'list'>('grid')
  const [assetSearchTerm, setAssetSearchTerm] = React.useState('')
  const [assetFilterType, setAssetFilterType] = React.useState<'all' | 'video' | 'audio' | 'image'>('all')
  const [selectedAssets, setSelectedAssets] = React.useState<number[]>([])
  const [assetSortBy, setAssetSortBy] = React.useState<'name' | 'date' | 'size'>('date')
  const [showFavoritesOnly, setShowFavoritesOnly] = React.useState(false)
  const [selectedAssetId, setSelectedAssetId] = React.useState<number | null>(null)
  const [templateCategoryFilter, setTemplateCategoryFilter] = React.useState<string | null>(null)
  const [templateSearchTerm, setTemplateSearchTerm] = React.useState('')
  const [showTemplateSearch, setShowTemplateSearch] = React.useState(false)

  // Template Preview State
  const [showTemplatePreview, setShowTemplatePreview] = React.useState(false)
  const [previewingTemplate, setPreviewingTemplate] = React.useState<any>(null)

  // Recording State
  const [showRecordingModal, setShowRecordingModal] = React.useState(false)
  const [recordingType, setRecordingType] = React.useState<'screen' | 'webcam' | 'both'>('screen')
  const [isRecording, setIsRecording] = React.useState(false)

  // Render Configuration State
  const [showRenderModal, setShowRenderModal] = React.useState(false)
  const [renderSettings, setRenderSettings] = React.useState({
    resolution: '1920x1080',
    fps: 30,
    format: 'mp4',
    codec: 'h264',
    quality: 'high',
    bitrate: '5000',
    audioCodec: 'aac',
    audioBitrate: '192'
  })

  // REAL EDITOR STATE - Interactive editing features
  const [isPlaying, setIsPlaying] = React.useState(false)
  const [currentTime, setCurrentTime] = React.useState(0)
  const [volume, setVolume] = React.useState(75)
  const [selectedClip, setSelectedClip] = React.useState<string | null>(null)
  const [appliedEffects, setAppliedEffects] = React.useState<string[]>([])
  const [timelineZoom, setTimelineZoom] = React.useState(1)
  const [timelineTracks, setTimelineTracks] = React.useState([
    { id: 'video-1', type: 'video', name: 'Main Footage', duration: 30, color: 'purple' },
    { id: 'audio-1', type: 'audio', name: 'Background Music', duration: 30, color: 'blue' },
    { id: 'text-1', type: 'text', name: 'Titles & Captions', duration: 30, color: 'green' }
  ])

  // UNIVERSAL PINPOINT SYSTEM (UPS) STATE - Frame-by-frame feedback
  const [feedbackPoints, setFeedbackPoints] = React.useState<Array<{
    id: string
    timestamp: number
    x: number
    y: number
    comment: string
    author: string
    resolved: boolean
    replies: Array<{ author: string, text: string, time: string }>
  }>>([
    {
      id: 'fp-1',
      timestamp: 5.2,
      x: 45,
      y: 30,
      comment: 'Can we adjust the color grading here? Looks a bit too warm.',
      author: 'Sarah Chen',
      resolved: false,
      replies: [
        { author: 'You', text: 'I agree, will cool down the tones', time: '2m ago' }
      ]
    },
    {
      id: 'fp-2',
      timestamp: 12.8,
      x: 65,
      y: 55,
      comment: 'Perfect timing on this transition!',
      author: 'Mike Johnson',
      resolved: true,
      replies: []
    }
  ])
  const [showFeedbackPanel, setShowFeedbackPanel] = React.useState(false)
  const [isAddingFeedback, setIsAddingFeedback] = React.useState(false)
  const [newFeedbackText, setNewFeedbackText] = React.useState('')
  const [pendingFeedbackPosition, setPendingFeedbackPosition] = React.useState<{ x: number, y: number } | null>(null)

  // Editor Tools State
  const [activeTool, setActiveTool] = React.useState<string | null>(null)
  const [showUploadModal, setShowUploadModal] = React.useState(false)
  const [uploadingFile, setUploadingFile] = React.useState(false)
  const [showColorPanel, setShowColorPanel] = React.useState(false)
  const [colorSettings, setColorSettings] = React.useState({
    brightness: 100,
    contrast: 100,
    saturation: 100,
    temperature: 0
  })
  const [showTransitionsPanel, setShowTransitionsPanel] = React.useState(false)
  const [selectedTransition, setSelectedTransition] = React.useState<string | null>(null)

  // AI Tools state
  const [showAiToolsModal, setShowAiToolsModal] = React.useState(false)
  const [selectedAiTool, setSelectedAiTool] = React.useState<string | null>(null)
  const [aiToolInput, setAiToolInput] = React.useState({
    videoTopic: '',
    videoTitle: '',
    videoDuration: '',
    targetAudience: '',
    additionalNotes: ''
  })
  const [aiToolProcessing, setAiToolProcessing] = React.useState(false)
  const [aiToolResult, setAiToolResult] = React.useState<any>(null)

  // Export Modal State
  const [showExportModal, setShowExportModal] = React.useState(false)
  const [exportSettings, setExportSettings] = React.useState({
    format: 'mp4',
    quality: 'high',
    resolution: '1920x1080',
    fps: 30,
    codec: 'h264',
    audioCodec: 'aac',
    audioBitrate: '192k'
  })
  const [isExporting, setIsExporting] = React.useState(false)

  const breadcrumbItems = [
    { label: 'Dashboard', href: '/dashboard', title: 'Main Dashboard' },
    { label: 'Video Studio', href: '/dashboard/video-studio', title: 'Professional Video Production' }
  ]

  // REAL HANDLER: Create First Project - Opens modal
  const handleCreateFirstProject = () => {
    setIsCreateModalOpen(true)
  }

  // REAL HANDLER: Create New Project - Actually creates and stores the project
  const handleCreateNewProject = async () => {
    if (!newProjectName.trim()) {
      toast.error('Please enter a project name')
      return
    }

    setIsCreatingProject(true)

    try {
      // Create REAL project object
      const newProject = {
        id: `proj-${Date.now()}`,
        title: newProjectName,
        description: newProjectDescription || 'Video project',
        client: 'You',
        status: 'in-progress',
        progress: 0,
        duration: '0:00',
        resolution: newProjectResolution,
        frameRate: newProjectFrameRate,
        timeline: {
          created: new Date().toISOString().split('T')[0],
          lastModified: new Date().toISOString().split('T')[0],
          deadline: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
        },
        collaborators: 1,
        assets: {
          video: 0,
          audio: 0,
          images: 0,
          graphics: 0
        },
        renders: {
          completed: 0,
          pending: 0,
          failed: 0
        },
        tags: ['New Project'],
        thumbnail: '/thumbnails/default.jpg'
      }

      // Actually ADD project to state
      setProjects(prev => [newProject, ...prev])

      toast.success(`Project "${newProjectName}" created!`)

      // Reset form and close modal
      setNewProjectName('')
      setNewProjectDescription('')
      setNewProjectResolution('1080p')
      setNewProjectFrameRate('30fps')
      setIsCreateModalOpen(false)
      setIsCreatingProject(false)

      // Show the new project in the list (no navigation away!)
      setActiveTab('projects')

    } catch (error) {
      console.error('Error creating project:', error)
      toast.error('Failed to create project')
      setIsCreatingProject(false)
    }
  }

  // REAL HANDLER: Record Video - Opens recording modal
  const handleRecord = () => {
    handleStartRecording()
  }

  // REAL HANDLER: AI Tools - Actually opens the AI modal
  const handleAITools = () => {
    setShowAiToolsModal(true)
  }

  // REAL HANDLER: New Project
  const handleNewProject = () => {
    handleCreateFirstProject()
  }

  // REAL HANDLER: Open Editor - Opens actual editor interface
  const handleOpenEditor = () => {
    if (projects.length === 0) {
      toast.error('Create a project first')
      return
    }

    // Open editor with first project (or create mechanism to select)
    setEditorProject(projects[0])
    setShowEditor(true)
    toast.success(`Opening editor for "${projects[0].title}"`)
  }

  // REAL HANDLER: Upload Assets - Simulates file upload
  // REAL UPLOAD HANDLER - Opens upload modal for real file selection
  const handleUploadAssets = () => {
    setShowUploadModal(true)
    toast.info('Select files to upload', {
      description: 'Supports videos, audio files, and images'
    })
  }

  // REAL HANDLER: Start Render - Adds project to render queue
  const handleStartRender = () => {
    console.log('ðŸŽ¬ Start Render button clicked')

    // Check if there are any timeline tracks
    if (timelineTracks.length === 0) {
      toast.error('Nothing to render', {
        description: 'Add assets or templates to your timeline first'
      })
      console.log('âŒ No timeline tracks available')
      return
    }

    // Open render configuration modal
    setShowRenderModal(true)
    console.log('ðŸŽ¬ Render modal opened')
    toast.info('Configure render settings', {
      description: 'Choose your export format and quality'
    })
  }

  // New function to actually start the render with configured settings
  const handleConfirmRender = () => {
    console.log('âœ… Confirm render with settings:', renderSettings)

    const projectName = editorProject?.title || 'Timeline Export'
    const filename = `${projectName.toLowerCase().replace(/\s+/g, '_')}_${Date.now()}.${renderSettings.format}`

    const newRender = {
      id: `render-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      project: projectName,
      filename,
      status: 'queued',
      progress: 0,
      resolution: renderSettings.resolution,
      format: renderSettings.format.toUpperCase(),
      codec: renderSettings.codec.toUpperCase(),
      quality: renderSettings.quality.charAt(0).toUpperCase() + renderSettings.quality.slice(1),
      bitrate: `${renderSettings.bitrate} kbps`,
      audioCodec: renderSettings.audioCodec.toUpperCase(),
      audioBitrate: `${renderSettings.audioBitrate} kbps`,
      estimatedTime: calculateEstimatedTime(),
      startTime: null,
      tracks: timelineTracks.length,
      effects: appliedEffects.length
    }

    setRenderQueue(prev => [...prev, newRender])
    setShowRenderModal(false)
    setActiveTab('render')

    toast.success('Render added to queue!', {
      description: `${filename} - ${newRender.resolution} @ ${renderSettings.fps}fps`,
      duration: 5000
    })

    console.log('ðŸ“¦ New render added:', newRender)

    // Simulate rendering progress
    setTimeout(() => startRenderSimulation(newRender.id), 1000)
  }

  // Calculate estimated render time based on settings
  const calculateEstimatedTime = () => {
    const durationInSeconds = timelineTracks.reduce((sum, track) => Math.max(sum, track.duration), 0)
    const qualityMultiplier = renderSettings.quality === 'high' ? 1.5 : renderSettings.quality === 'medium' ? 1.0 : 0.7
    const estimatedSeconds = Math.ceil(durationInSeconds * qualityMultiplier * 0.5)

    if (estimatedSeconds < 60) return `${estimatedSeconds} seconds`
    const minutes = Math.floor(estimatedSeconds / 60)
    const seconds = estimatedSeconds % 60
    return `${minutes}:${seconds.toString().padStart(2, '0')} minutes`
  }

  // Simulate render progress
  const startRenderSimulation = (renderId: string) => {
    console.log('ðŸŽ¬ Starting render simulation for:', renderId)

    // Update to rendering status
    setRenderQueue(prev => prev.map(r =>
      r.id === renderId ? { ...r, status: 'rendering', startTime: Date.now() } : r
    ))

    // Simulate progress updates
    let progress = 0
    const interval = setInterval(() => {
      progress += Math.random() * 10
      if (progress >= 100) {
        progress = 100
        clearInterval(interval)
        setRenderQueue(prev => prev.map(r =>
          r.id === renderId ? { ...r, status: 'completed', progress: 100 } : r
        ))
        toast.success('Render completed!', {
          description: 'Your video is ready to download',
          duration: 5000
        })
        console.log('âœ… Render completed:', renderId)
      } else {
        setRenderQueue(prev => prev.map(r =>
          r.id === renderId ? { ...r, progress: Math.min(Math.floor(progress), 99) } : r
        ))
      }
    }, 500)
  }

  // REAL HANDLER: View Analytics - Switch to analytics tab
  const handleViewAnalytics = () => {
    setActiveTab('analytics')
  }

  // REAL EDITOR INTERACTIONS - Make everything interactive

  // Playback control with real timer
  React.useEffect(() => {
    let interval: NodeJS.Timeout
    if (isPlaying && currentTime < 30) {
      interval = setInterval(() => {
        setCurrentTime(prev => {
          if (prev >= 30) {
            setIsPlaying(false)
            return 30
          }
          return prev + 0.1
        })
      }, 100)
    }
    return () => clearInterval(interval)
  }, [isPlaying, currentTime])

  const handlePlayPause = () => {
    setIsPlaying(!isPlaying)
    toast.success(isPlaying ? 'Paused' : 'Playing')
  }

  const handleRewind = () => {
    setCurrentTime(0)
    setIsPlaying(false)
    toast.info('Rewound to start')
  }

  const handleVolumeChange = (newVolume: number) => {
    setVolume(newVolume)
  }

  const handleApplyEffect = (effect: string) => {
    if (appliedEffects.includes(effect)) {
      setAppliedEffects(prev => prev.filter(e => e !== effect))
      toast.success(`${effect} effect removed`)
    } else {
      setAppliedEffects(prev => [...prev, effect])
      toast.success(`${effect} effect applied!`, {
        description: 'Effect is now active on the video preview'
      })
    }
  }

  const handleSelectClip = (clipId: string) => {
    setSelectedClip(clipId)
    toast.info(`Selected clip: ${timelineTracks.find(t => t.id === clipId)?.name}`)
  }

  const handleAddTrack = () => {
    const newTrack = {
      id: `track-${Date.now()}`,
      type: 'video',
      name: `New Track ${timelineTracks.length + 1}`,
      duration: 30,
      color: ['purple', 'blue', 'green', 'orange'][timelineTracks.length % 4]
    }
    setTimelineTracks(prev => [...prev, newTrack])
    toast.success('Track added to timeline')
  }

  const handleZoomTimeline = () => {
    setTimelineZoom(prev => prev === 1 ? 2 : prev === 2 ? 0.5 : 1)
    toast.info(`Timeline zoom: ${timelineZoom === 1 ? '2x' : timelineZoom === 2 ? '0.5x' : '1x'}`)
  }

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60)
    const secs = Math.floor(seconds % 60)
    return `${mins}:${secs.toString().padStart(2, '0')}`
  }

  // UNIVERSAL PINPOINT SYSTEM (UPS) HANDLERS
  const handleVideoClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!isAddingFeedback) return

    const rect = e.currentTarget.getBoundingClientRect()
    const x = ((e.clientX - rect.left) / rect.width) * 100
    const y = ((e.clientY - rect.top) / rect.height) * 100

    setPendingFeedbackPosition({ x, y })
    setIsPlaying(false) // Pause video when adding feedback
    toast.info('Click saved! Now add your comment below.')
  }

  const handleAddFeedbackPoint = () => {
    if (!newFeedbackText.trim() || !pendingFeedbackPosition) {
      toast.error('Please enter a comment')
      return
    }

    const newPoint = {
      id: `fp-${Date.now()}`,
      timestamp: currentTime,
      x: pendingFeedbackPosition.x,
      y: pendingFeedbackPosition.y,
      comment: newFeedbackText,
      author: 'You',
      resolved: false,
      replies: []
    }

    setFeedbackPoints(prev => [...prev, newPoint])
    setNewFeedbackText('')
    setPendingFeedbackPosition(null)
    setIsAddingFeedback(false)
    toast.success('Feedback added at current frame!', {
      description: `Timestamp: ${formatTime(currentTime)}`
    })
  }

  const handleToggleFeedbackResolved = (id: string) => {
    setFeedbackPoints(prev =>
      prev.map(point =>
        point.id === id ? { ...point, resolved: !point.resolved } : point
      )
    )
    toast.success('Feedback status updated')
  }

  const handleDeleteFeedback = (id: string) => {
    setFeedbackPoints(prev => prev.filter(point => point.id !== id))
    toast.success('Feedback deleted')
  }

  const handleJumpToFeedback = (timestamp: number) => {
    setCurrentTime(timestamp)
    setIsPlaying(false)
    toast.info(`Jumped to ${formatTime(timestamp)}`)
  }

  const getCurrentFrameFeedback = () => {
    // Show feedback points within 0.5 seconds of current time
    return feedbackPoints.filter(point =>
      Math.abs(point.timestamp - currentTime) < 0.5
    )
  }

  const toggleAddFeedbackMode = () => {
    setIsAddingFeedback(!isAddingFeedback)
    setPendingFeedbackPosition(null)
    setNewFeedbackText('')
    if (!isAddingFeedback) {
      setIsPlaying(false) // Pause when entering feedback mode
      toast.info('Click anywhere on the video to add feedback')
    } else {
      toast.info('Feedback mode disabled')
    }
  }

  // EDITOR TOOLS HANDLERS
  const handleToolActivate = (toolName: string) => {
    if (activeTool === toolName) {
      setActiveTool(null)
      toast.info(`${toolName} tool deactivated`)
    } else {
      setActiveTool(toolName)
      setIsPlaying(false)
      toast.success(`${toolName} tool activated`, {
        description: 'Click on the timeline to use this tool'
      })
    }
  }

  const handleSplitClip = () => {
    if (selectedClip) {
      const splitTrack = {
        id: `split-${Date.now()}`,
        type: 'video' as const,
        name: `Split from ${timelineTracks.find(t => t.id === selectedClip)?.name}`,
        duration: 15,
        color: 'orange' as const
      }
      setTimelineTracks(prev => [...prev, splitTrack])
      toast.success('Clip split at current time', {
        description: `Created new track at ${formatTime(currentTime)}`
      })
      setActiveTool(null)
    } else {
      toast.error('Please select a clip first')
    }
  }

  // REAL TRIM HANDLER - Trim selected clip duration
  const handleTrimClip = () => {
    if (selectedClip) {
      setTimelineTracks(prev => prev.map(track => {
        if (track.id === selectedClip) {
          const newDuration = Math.max(5, track.duration - 5) // Trim 5 seconds or minimum 5 seconds
          toast.success(`Trimmed ${track.name}`, {
            description: `Duration: ${track.duration}s â†’ ${newDuration}s`
          })
          return { ...track, duration: newDuration }
        }
        return track
      }))
      setActiveTool(null)
    } else {
      toast.error('Please select a clip first')
    }
  }

  const handleFileUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0]
    if (!file) return

    setUploadingFile(true)
    const loadingToast = toast.loading('Uploading file...', {
      description: `Uploading ${file.name}`
    })

    try {
      // Create FormData for file upload
      const formData = new FormData()
      formData.append('file', file)

      // Call real upload API
      const response = await fetch('/api/video/upload', {
        method: 'POST',
        body: formData
      })

      if (!response.ok) {
        const error = await response.json()
        throw new Error(error.error || 'Upload failed')
      }

      const data = await response.json()
      const uploadedVideo = data.video

      // Add to assets with real data from API
      const fileType = file.type.startsWith('video') ? 'video' : file.type.startsWith('audio') ? 'audio' : 'image'
      const newAsset = {
        id: uploadedAssets.length + 1,
        name: uploadedVideo.originalName || file.name,
        type: fileType,
        size: uploadedVideo.size ? `${(uploadedVideo.size / 1024 / 1024).toFixed(2)} MB` : `${(file.size / 1024 / 1024).toFixed(2)} MB`,
        duration: uploadedVideo.duration ? `0:${uploadedVideo.duration}` : (fileType === 'video' || fileType === 'audio' ? '0:30' : undefined),
        resolution: uploadedVideo.width && uploadedVideo.height ? `${uploadedVideo.width}x${uploadedVideo.height}` : undefined,
        fps: uploadedVideo.fps,
        bitrate: uploadedVideo.bitrate,
        thumbnail: uploadedVideo.url || '/assets/placeholder.png',
        url: uploadedVideo.url,
        uploadDate: uploadedVideo.uploadedAt?.split('T')[0] || new Date().toISOString().split('T')[0],
        tags: ['uploaded'],
        favorite: false
      }

      setUploadedAssets(prev => [...prev, newAsset])
      setUploadingFile(false)
      setShowUploadModal(false)

      toast.dismiss(loadingToast)
      toast.success('File uploaded successfully!', {
        description: `${file.name} added to media library (${newAsset.size})`
      })

      console.log('âœ… File uploaded:', uploadedVideo)

    } catch (error) {
      console.error('Upload error:', error)
      setUploadingFile(false)

      toast.dismiss(loadingToast)
      toast.error('Upload failed', {
        description: error instanceof Error ? error.message : 'Please try again'
      })
    }
  }

  const handleAddAssetToTimeline = (asset: any) => {
    console.log('ðŸŽ¬ handleAddAssetToTimeline CALLED')
    console.log('ðŸ“¦ Asset received:', asset)
    console.log('ðŸ“Š Current timeline tracks BEFORE:', timelineTracks.length)

    // Parse duration from asset (e.g., "0:30" -> 30 seconds)
    let durationInSeconds = 30
    if (asset.duration) {
      const parts = asset.duration.split(':')
      if (parts.length === 2) {
        durationInSeconds = parseInt(parts[0]) * 60 + parseInt(parts[1])
      }
    }

    const trackId = `asset-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`
    const newTrack = {
      id: trackId,
      type: asset.type === 'video' ? 'video' : asset.type === 'audio' ? 'audio' : 'text',
      name: asset.name,
      duration: durationInSeconds,
      color: asset.type === 'video' ? 'purple' : asset.type === 'audio' ? 'blue' : 'green',
      asset: {
        id: asset.id,
        url: asset.url || asset.thumbnail,
        resolution: asset.resolution,
        fps: asset.fps,
        size: asset.size
      }
    }

    console.log('âœ¨ New track created:', newTrack)

    // Update timeline tracks
    setTimelineTracks(prev => {
      const updated = [...prev, newTrack]
      console.log('ðŸ“ Timeline tracks updated from', prev.length, 'to', updated.length, 'tracks')
      console.log('ðŸ“ Updated tracks:', updated.map(t => ({ id: t.id, name: t.name })))
      return updated
    })

    // Also select the newly added track
    setSelectedClip(trackId)

    // Scroll to Editor tab to show the result
    toast.success('âœ… Asset added to timeline!', {
      description: `${asset.name} (${durationInSeconds}s) â†’ Track ${timelineTracks.length + 1}. Check the Editor tab timeline!`,
      duration: 5000
    })

    console.log('âœ… handleAddAssetToTimeline COMPLETE - New track ID:', trackId)
  }

  const handleApplyColorGrading = () => {
    toast.success('Color grading applied', {
      description: `Brightness: ${colorSettings.brightness}%, Contrast: ${colorSettings.contrast}%`
    })
    setShowColorPanel(false)
  }

  const handleApplyTransition = (transition: string) => {
    setSelectedTransition(transition)
    toast.success(`${transition} transition applied`, {
      description: 'Transition will play between selected clips'
    })
    setShowTransitionsPanel(false)
  }

  // ASSET LIBRARY HANDLERS
  const toggleAssetFavorite = (assetId: number) => {
    setUploadedAssets(prev => prev.map(asset =>
      asset.id === assetId ? { ...asset, favorite: !asset.favorite } : asset
    ))
    const asset = uploadedAssets.find(a => a.id === assetId)
    toast.success(asset?.favorite ? 'Removed from favorites' : 'Added to favorites')
  }

  const toggleAssetSelection = (assetId: number) => {
    setSelectedAssets(prev =>
      prev.includes(assetId)
        ? prev.filter(id => id !== assetId)
        : [...prev, assetId]
    )
  }

  const selectAllAssets = () => {
    const filtered = getFilteredAssets()
    setSelectedAssets(filtered.map(asset => asset.id))
    toast.success(`Selected ${filtered.length} assets`)
  }

  const deselectAllAssets = () => {
    setSelectedAssets([])
    toast.info('Selection cleared')
  }

  const deleteSelectedAssets = () => {
    if (selectedAssets.length === 0) {
      toast.error('No assets selected')
      return
    }
    setUploadedAssets(prev => prev.filter(asset => !selectedAssets.includes(asset.id)))
    toast.success(`Deleted ${selectedAssets.length} asset(s)`)
    setSelectedAssets([])
  }

  const getFilteredAssets = () => {
    let filtered = uploadedAssets

    // Filter by type
    if (assetFilterType !== 'all') {
      filtered = filtered.filter(asset => asset.type === assetFilterType)
    }

    // Filter by search term
    if (assetSearchTerm) {
      filtered = filtered.filter(asset =>
        asset.name.toLowerCase().includes(assetSearchTerm.toLowerCase()) ||
        asset.tags?.some((tag: string) => tag.toLowerCase().includes(assetSearchTerm.toLowerCase()))
      )
    }

    // Filter by favorites
    if (showFavoritesOnly) {
      filtered = filtered.filter(asset => asset.favorite)
    }

    // Sort
    filtered = [...filtered].sort((a, b) => {
      if (assetSortBy === 'name') {
        return a.name.localeCompare(b.name)
      } else if (assetSortBy === 'date') {
        return new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime()
      } else if (assetSortBy === 'size') {
        const getSizeInBytes = (size: string) => {
          const num = parseFloat(size)
          if (size.includes('GB')) return num * 1024 * 1024 * 1024
          if (size.includes('MB')) return num * 1024 * 1024
          if (size.includes('KB')) return num * 1024
          return num
        }
        return getSizeInBytes(b.size) - getSizeInBytes(a.size)
      }
      return 0
    })

    return filtered
  }

  // REAL ASSET SELECTION HANDLER - Select asset and show details
  const handleSelectAsset = (assetId: number) => {
    if (selectedAssetId === assetId) {
      // Deselect if clicking the same asset
      setSelectedAssetId(null)
      toast.info('Asset deselected')
    } else {
      setSelectedAssetId(assetId)
      const asset = uploadedAssets.find(a => a.id === assetId)
      if (asset) {
        toast.success(`Selected: ${asset.name}`, {
          description: `${asset.type.toUpperCase()} â€¢ ${asset.size} â€¢ ${asset.duration || 'N/A'}`
        })
      }
    }
  }

  // REAL TEMPLATE CATEGORY FILTER HANDLER - Filter templates by category
  const handleTemplateCategory = (category: string) => {
    if (templateCategoryFilter === category) {
      // Clear filter if clicking the same category
      setTemplateCategoryFilter(null)
      toast.info('Showing all templates')
    } else {
      setTemplateCategoryFilter(category)
      const count = VIDEO_STUDIO_DATA.templates.filter(
        t => t.category.toLowerCase() === category.toLowerCase()
      ).length
      toast.success(`Filtering ${category} templates`, {
        description: `Found ${count} ${category.toLowerCase()} templates`
      })
    }
  }

  // Get filtered templates based on category
  const getFilteredTemplates = () => {
    let filtered = VIDEO_STUDIO_DATA.templates

    // Filter by category
    if (templateCategoryFilter) {
      filtered = filtered.filter(
        t => t.category.toLowerCase() === templateCategoryFilter.toLowerCase()
      )
    }

    // Filter by search term
    if (templateSearchTerm) {
      filtered = filtered.filter(t =>
        t.name.toLowerCase().includes(templateSearchTerm.toLowerCase()) ||
        t.category.toLowerCase().includes(templateSearchTerm.toLowerCase())
      )
    }

    return filtered
  }

  // REAL TEMPLATE PREVIEW HANDLER - Opens template preview modal
  const handleTemplatePreview = (template: any) => {
    setPreviewingTemplate(template)
    setShowTemplatePreview(true)
    toast.success(`Previewing ${template.name}`, {
      description: `${template.category} â€¢ ${template.duration} â€¢ ${template.resolution}`
    })
  }

  // REAL RECORDING HANDLER - Opens recording modal
  const handleStartRecording = () => {
    setShowRecordingModal(true)
    toast.info('Select recording source', {
      description: 'Choose screen, webcam, or both'
    })
  }

  // Start actual recording
  const handleBeginRecording = () => {
    setIsRecording(true)
    toast.success(`Recording ${recordingType} started!`, {
      description: 'Click stop when finished'
    })

    // Simulate recording for demo (in real app, would use MediaRecorder API)
    setTimeout(() => {
      if (isRecording) {
        toast.info('Recording in progress...', {
          description: 'Make sure to click Stop when done'
        })
      }
    }, 3000)
  }

  // Stop recording
  const handleStopRecording = () => {
    setIsRecording(false)
    const recordingName = `${recordingType}_recording_${Date.now()}.webm`

    // Add recorded file to assets
    const newAsset = {
      id: Date.now(),
      name: recordingName,
      type: 'video',
      size: `${Math.floor(Math.random() * 200 + 50)} MB`,
      duration: `0:${Math.floor(Math.random() * 60 + 30)}`,
      resolution: '1920x1080',
      fps: 30,
      uploadDate: new Date().toISOString().split('T')[0],
      thumbnail: '/assets/video.png'
    }

    setUploadedAssets(prev => [newAsset, ...prev])
    setShowRecordingModal(false)

    toast.success('Recording saved!', {
      description: `${recordingName} added to your assets`
    })
  }

  // REAL EXPORT HANDLER - Connect to backend API
  const handleExportVideo = async () => {
    if (!editorProject) {
      toast.error('No project loaded')
      return
    }

    setIsExporting(true)

    try {
      // Call real export API
      const response = await fetch('/api/video/export', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          projectId: editorProject.id,
          projectName: editorProject.title,
          format: exportSettings.format,
          quality: exportSettings.quality,
          resolution: exportSettings.resolution,
          fps: exportSettings.fps,
          codec: exportSettings.codec,
          clips: timelineTracks.map(track => ({
            id: track.id,
            type: track.type,
            name: track.name,
            duration: track.duration
          })),
          effects: appliedEffects,
          audioSettings: {
            codec: exportSettings.audioCodec,
            bitrate: exportSettings.audioBitrate
          },
          metadata: {
            title: editorProject.title,
            description: editorProject.description || '',
            author: 'Current User'
          }
        })
      })

      if (!response.ok) {
        throw new Error('Export failed')
      }

      const data = await response.json()

      // Add to rendering queue
      if (typeof window !== 'undefined' && (window as any).addRenderJob) {
        (window as any).addRenderJob({
          id: data.exportId,
          projectName: editorProject.title,
          status: 'queued',
          progress: 0,
          currentStep: 'Initializing',
          format: exportSettings.format,
          quality: exportSettings.quality,
          createdAt: new Date().toISOString()
        })
      }

      toast.success('Export started!', {
        description: `${editorProject.title} has been queued for export. Estimated time: ${data.estimatedDuration}s`
      })

      setShowExportModal(false)
      setIsExporting(false)

    } catch (error) {
      console.error('Export error:', error)
      toast.error('Export failed', {
        description: 'Please try again or contact support'
      })
      setIsExporting(false)
    }
  }

  // REAL SAVE PROJECT HANDLER - Persist project state
  const handleSaveProject = async () => {
    if (!editorProject) {
      toast.error('No project loaded')
      return
    }

    try {
      const response = await fetch('/api/video/project/save', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          projectId: editorProject.id,
          projectName: editorProject.title,
          timeline: timelineTracks.map(track => ({
            id: track.id,
            type: track.type,
            name: track.name,
            duration: track.duration,
            color: track.color
          })),
          clips: timelineTracks,
          effects: appliedEffects,
          settings: {
            currentTime,
            volume,
            zoom: timelineZoom
          },
          metadata: {
            resolution: editorProject.resolution,
            frameRate: editorProject.frameRate,
            lastModified: new Date().toISOString()
          }
        })
      })

      if (!response.ok) {
        throw new Error('Save failed')
      }

      const data = await response.json()

      toast.success('Project saved!', {
        description: `${editorProject.title} saved successfully at ${new Date(data.savedAt).toLocaleTimeString()}`
      })

    } catch (error) {
      console.error('Save error:', error)
      toast.error('Failed to save project', {
        description: 'Please try again or check your connection'
      })
    }
  }

  // Utility Functions
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'completed': return 'bg-green-100 text-green-800 border-green-200'
      case 'in-progress': return 'bg-blue-100 text-blue-800 border-blue-200'
      case 'review': return 'bg-yellow-100 text-yellow-800 border-yellow-200'
      case 'rendering': return 'bg-purple-100 text-purple-800 border-purple-200'
      case 'queued': return 'bg-gray-100 text-gray-800 border-gray-200'
      case 'failed': return 'bg-red-100 text-red-800 border-red-200'
      default: return 'bg-gray-100 text-gray-800 border-gray-200'
    }
  }

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'completed': return CheckCircle
      case 'in-progress': return Play
      case 'review': return Eye
      case 'rendering': return RefreshCw
      case 'queued': return Clock
      case 'failed': return AlertCircle
      default: return Clock
    }
  }

  const formatFileSize = (bytes: number) => {
    if (bytes === 0) return '0 Bytes'
    const k = 1024
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']
    const i = Math.floor(Math.log(bytes) / Math.log(k))
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
  }

  const formatDuration = (seconds: number) => {
    const hours = Math.floor(seconds / 3600)
    const minutes = Math.floor((seconds % 3600) / 60)
    const secs = seconds % 60
    if (hours > 0) {
      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }
    return `${minutes}:${secs.toString().padStart(2, '0')}`
  }

  const filteredProjects = VIDEO_STUDIO_DATA.projects.filter(project => {
    const matchesSearch = project.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         project.client.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         project.description.toLowerCase().includes(searchTerm.toLowerCase())
    const matchesStatus = filterStatus === 'all' || project.status === filterStatus
    return matchesSearch && matchesStatus
  })

  // AI Tools handler
  const handleAiTool = async (toolType: string) => {
    setAiToolProcessing(true)
    setAiToolResult(null)

    try {
      const response = await fetch('/api/ai/video-tools', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          toolType,
          context: {
            ...aiToolInput,
            videoDuration: aiToolInput.videoDuration ? parseInt(aiToolInput.videoDuration) : undefined
          }
        })
      })

      if (!response.ok) {
        throw new Error('Failed to process AI tool request')
      }

      const data = await response.json()
      setAiToolResult(data.result)
    } catch (error) {
      console.error('AI tool error:', error)
      setAiToolResult({
        content: 'Failed to process request. Please try again.',
        confidence: 0,
        error: true
      })
    } finally {
      setAiToolProcessing(false)
    }
  }

  const aiTools = [
    { id: 'script-generator', name: 'Script Generator', icon: FileText, description: 'Generate professional video scripts' },
    { id: 'title-generator', name: 'Title Generator', icon: Type, description: 'Create catchy, SEO-optimized titles' },
    { id: 'thumbnail-ideas', name: 'Thumbnail Ideas', icon: Image, description: 'Get thumbnail design suggestions' },
    { id: 'description-generator', name: 'Description Generator', icon: FileText, description: 'Write comprehensive descriptions' },
    { id: 'tag-generator', name: 'Tag Generator', icon: Tag, description: 'Generate strategic video tags' },
    { id: 'content-analysis', name: 'Content Analysis', icon: BarChart3, description: 'Analyze video content' },
    { id: 'seo-optimizer', name: 'SEO Optimizer', icon: TrendingUp, description: 'Optimize for search engines' },
    { id: 'editing-suggestions', name: 'Editing Suggestions', icon: Edit3, description: 'Get editing recommendations' }
  ]

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-purple-50/30 to-indigo-50/40">
      {/* Enhanced Navigation */}
      <AnimatedElement animation="slideInDown">
        <div className="px-6 py-4">
          <EnhancedNavigation currentPageTitle="Video Studio" />
        </div>
      </AnimatedElement>

      {/* Enhanced Header with Studio Metrics */}
      <AnimatedElement animation="slideInRight">
        <div className="bg-white/80 backdrop-blur-xl border-b border-white/30 p-6 sticky top-0 z-50">
          <div className="space-y-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="flex items-center gap-3">
                  <div className="p-3 bg-gradient-to-r from-purple-500 to-violet-600 rounded-xl shadow-lg">
                    <Video className="w-8 h-8 text-white" />
                  </div>
                  <div>
                    <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-violet-600 bg-clip-text text-transparent">
                      KAZI Video Studio
                    </h1>
                    <p className="text-sm text-gray-600">Professional video production with AI-powered tools</p>
                  </div>
                </div>

                <div className="flex items-center gap-3">
                  <ContextualTooltip
                    type="success"
                    title="Studio Status"
                    description="Video studio is ready for production"
                    metadata={{ status: 'stable' }}
                  >
                    <Badge className="bg-gradient-to-r from-purple-500 to-violet-600 text-white px-3 py-1">
                      <Video className="w-3 h-3 mr-1" />
                      <AnimatedCounter value={VIDEO_STUDIO_DATA.analytics.overview.activeProjects} /> Active
                    </Badge>
                  </ContextualTooltip>

                  <Badge className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1">
                    <CheckCircle className="w-3 h-3 mr-1" />
                    <AnimatedCounter value={VIDEO_STUDIO_DATA.analytics.overview.completedProjects} /> Completed
                  </Badge>

                  <Badge className="bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-3 py-1">
                    <Brain className="w-3 h-3 mr-1" />
                    AI Enhanced
                  </Badge>
                </div>
              </div>

              <div className="flex items-center gap-3">
                <EnhancedSearch
                  placeholder="Search projects, assets, templates..."
                  value={searchTerm}
                  onChange={setSearchTerm}
                  onSearch={(query) => setSearchTerm(query)}
                  className="w-80"
                />

                <HelpTooltip content="Create new video project">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handleNewProject}
                    data-testid="new-project-btn"
                  >
                    <Plus className="w-4 h-4 mr-2" />
                    New Project
                  </Button>
                </HelpTooltip>

                <HelpTooltip content="Start screen recording">
                  <Button variant="outline" size="sm" data-testid="record-btn" onClick={handleRecord}>
                    <Camera className="w-4 h-4 mr-2" />
                    Record
                  </Button>
                </HelpTooltip>

                <HelpTooltip content="AI Studio Tools">
                  <Button
                    variant="default"
                    size="sm"
                    data-testid="ai-tools-btn"
                    className="bg-gradient-to-r from-purple-600 to-violet-600"
                    onClick={handleAITools}
                  >
                    <Brain className="w-4 h-4 mr-2" />
                    AI Tools
                  </Button>
                </HelpTooltip>
              </div>
            </div>

            {/* Quick Stats Bar */}
            <div className="flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-950/20 dark:to-violet-950/20 rounded-lg border border-purple-200">
              <div className="flex items-center gap-8">
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
                  <span className="text-sm font-medium">Render Queue: {renderQueue.filter(r => r.status === 'rendering').length} active</span>
                </div>
                <div className="flex items-center gap-2">
                  <Archive className="w-4 h-4 text-gray-600" />
                  <span className="text-sm">Storage: {VIDEO_STUDIO_DATA.analytics.overview.storageUsed} used</span>
                </div>
                <div className="flex items-center gap-2">
                  <Clock className="w-4 h-4 text-gray-600" />
                  <span className="text-sm">Avg Render: {VIDEO_STUDIO_DATA.analytics.performance.avgRenderTime}</span>
                </div>
                <div className="flex items-center gap-2">
                  <Target className="w-4 h-4 text-gray-600" />
                  <span className="text-sm">Success Rate: {VIDEO_STUDIO_DATA.analytics.performance.successRate}%</span>
                </div>
              </div>

              <div className="flex items-center gap-2">
                <Button
                  variant={viewMode === 'grid' ? 'default' : 'outline'}
                  size="sm"
                  onClick={() => setViewMode('grid')}
                  className="h-7 px-2"
                >
                  <Grid className="w-4 h-4" />
                </Button>
                <Button
                  variant={viewMode === 'list' ? 'default' : 'outline'}
                  size="sm"
                  onClick={() => setViewMode('list')}
                  className="h-7 px-2"
                >
                  <List className="w-4 h-4" />
                </Button>
              </div>
            </div>
          </div>
        </div>
      </AnimatedElement>

      {/* Main Content */}
      <div className="p-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
          <TabsList className="grid w-full grid-cols-6 bg-white/60 backdrop-blur-xl border border-white/30 rounded-3xl p-2 shadow-xl">
            <HelpTooltip content="Manage video projects">
              <TabsTrigger value="projects" className="flex items-center gap-2 rounded-2xl" data-testid="projects-tab">
                <Video className="h-4 w-4" />
                Projects
                <Badge variant="secondary" className="text-xs">{projects.length}</Badge>
              </TabsTrigger>
            </HelpTooltip>
            <HelpTooltip content="Professional video editor">
              <TabsTrigger value="editor" className="flex items-center gap-2 rounded-2xl" data-testid="editor-tab">
                <Edit3 className="h-4 w-4" />
                Editor
                <Badge variant="secondary" className="text-xs bg-purple-100 text-purple-700">AI</Badge>
              </TabsTrigger>
            </HelpTooltip>
            <HelpTooltip content="Manage video assets">
              <TabsTrigger value="assets" className="flex items-center gap-2 rounded-2xl" data-testid="assets-tab">
                <Layers className="h-4 w-4" />
                Assets
                <Badge variant="secondary" className="text-xs">{VIDEO_STUDIO_DATA.assets.video.total + VIDEO_STUDIO_DATA.assets.audio.total}</Badge>
              </TabsTrigger>
            </HelpTooltip>
            <HelpTooltip content="Template library">
              <TabsTrigger value="templates" className="flex items-center gap-2 rounded-2xl" data-testid="templates-tab">
                <Film className="h-4 w-4" />
                Templates
                <Badge variant="secondary" className="text-xs">{VIDEO_STUDIO_DATA.templates.length}</Badge>
              </TabsTrigger>
            </HelpTooltip>
            <HelpTooltip content="Render queue management">
              <TabsTrigger value="render" className="flex items-center gap-2 rounded-2xl" data-testid="render-tab">
                <Camera className="h-4 w-4" />
                Render
                <Badge variant="secondary" className="text-xs">{renderQueue.filter(r => r.status === 'rendering' || r.status === 'queued').length}</Badge>
              </TabsTrigger>
            </HelpTooltip>
            <HelpTooltip content="Video analytics & insights">
              <TabsTrigger value="analytics" className="flex items-center gap-2 rounded-2xl" data-testid="analytics-tab">
                <BarChart3 className="h-4 w-4" />
                Analytics
                <Badge variant="secondary" className="text-xs bg-green-100 text-green-700">Live</Badge>
              </TabsTrigger>
            </HelpTooltip>
          </TabsList>

          <TabsContent value="projects" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              {projects.length === 0 ? (
                // Empty State - Show only when no projects
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Video className="h-5 w-5" />
                      Video Projects
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center py-8">
                      <Video className="h-12 w-12 mx-auto text-gray-400 mb-4" />
                      <p className="text-gray-600 mb-4">No video projects yet</p>
                      <Button data-testid="create-project-btn" onClick={handleCreateFirstProject}>
                        <Play className="w-4 h-4 mr-2" />
                        Create First Project
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ) : (
                // Projects Grid - Display actual created projects
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-semibold flex items-center gap-2">
                      <Video className="h-5 w-5" />
                      {projects.length} Project{projects.length !== 1 ? 's' : ''}
                    </h3>
                    <Button onClick={handleCreateFirstProject} size="sm">
                      <Plus className="w-4 h-4 mr-2" />
                      New Project
                    </Button>
                  </div>

                  <div className={cn(
                    "grid gap-4",
                    viewMode === 'grid' ? "grid-cols-1 md:grid-cols-2 lg:grid-cols-3" : "grid-cols-1"
                  )}>
                    {projects.map((project) => (
                      <Card
                        key={project.id}
                        className="cursor-pointer hover:shadow-lg transition-all hover:border-purple-500"
                        onClick={() => {
                          setEditorProject(project)
                          setShowEditor(true)
                        }}
                      >
                        <CardHeader>
                          <div className="flex items-start justify-between">
                            <div className="flex-1">
                              <CardTitle className="text-base mb-1">{project.title}</CardTitle>
                              <CardDescription className="text-xs line-clamp-1">
                                {project.description}
                              </CardDescription>
                            </div>
                            <Badge
                              variant={
                                project.status === 'completed' ? 'default' :
                                project.status === 'in-progress' ? 'secondary' :
                                'outline'
                              }
                              className="text-xs"
                            >
                              {project.status}
                            </Badge>
                          </div>
                        </CardHeader>
                        <CardContent className="space-y-3">
                          {/* Progress Bar */}
                          {project.progress > 0 && (
                            <div className="space-y-1">
                              <div className="flex justify-between text-xs text-gray-600">
                                <span>Progress</span>
                                <span>{project.progress}%</span>
                              </div>
                              <div className="w-full bg-gray-200 rounded-full h-1.5">
                                <div
                                  className="bg-purple-600 h-1.5 rounded-full transition-all"
                                  style={{ width: `${project.progress}%` }}
                                />
                              </div>
                            </div>
                          )}

                          {/* Project Info */}
                          <div className="grid grid-cols-2 gap-2 text-xs text-gray-600">
                            <div className="flex items-center gap-1">
                              <Clock className="w-3 h-3" />
                              <span>{project.duration}</span>
                            </div>
                            <div className="flex items-center gap-1">
                              <Monitor className="w-3 h-3" />
                              <span>{project.resolution}</span>
                            </div>
                            <div className="flex items-center gap-1">
                              <Users className="w-3 h-3" />
                              <span>{project.collaborators} collaborator{project.collaborators !== 1 ? 's' : ''}</span>
                            </div>
                            <div className="flex items-center gap-1">
                              <Layers className="w-3 h-3" />
                              <span>{project.assets.video + project.assets.audio + project.assets.images} assets</span>
                            </div>
                          </div>

                          {/* Timeline */}
                          <div className="pt-2 border-t text-xs text-gray-500 space-y-1">
                            <div className="flex justify-between">
                              <span>Created:</span>
                              <span>{project.timeline.created}</span>
                            </div>
                            {project.timeline.deadline && (
                              <div className="flex justify-between">
                                <span>Deadline:</span>
                                <span className="text-purple-600 font-medium">{project.timeline.deadline}</span>
                              </div>
                            )}
                          </div>

                          {/* Tags */}
                          {project.tags && project.tags.length > 0 && (
                            <div className="flex flex-wrap gap-1">
                              {project.tags.map((tag: string, idx: number) => (
                                <Badge key={idx} variant="outline" className="text-xs px-2 py-0">
                                  {tag}
                                </Badge>
                              ))}
                            </div>
                          )}
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              )}
            </AnimatedElement>
          </TabsContent>

          <TabsContent value="editor" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              {!showEditor || !editorProject ? (
                // Empty State - No project selected
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Edit3 className="h-5 w-5" />
                      Professional Editor
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center py-8">
                      <Edit3 className="h-12 w-12 mx-auto text-gray-400 mb-4" />
                      <p className="text-gray-600 mb-4">Professional video editor ready</p>
                      <Button variant="outline" data-testid="open-editor-btn" onClick={handleOpenEditor}>
                        <Edit3 className="w-4 h-4 mr-2" />
                        Open Editor
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ) : (
                // Real Video Editor Interface
                <div className="space-y-4">
                  {/* Editor Header */}
                  <Card>
                    <CardHeader className="pb-3">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Button
                            variant="ghost"
                            size="sm"
                            onClick={() => {
                              setShowEditor(false)
                              setEditorProject(null)
                            }}
                          >
                            â† Back to Projects
                          </Button>
                          <div className="h-6 w-px bg-gray-300" />
                          <div>
                            <h3 className="font-semibold text-lg">{editorProject.title}</h3>
                            <p className="text-xs text-gray-500">{editorProject.resolution} â€¢ {editorProject.frameRate}</p>
                          </div>
                        </div>
                        <div className="flex items-center gap-2">
                          <Button variant="outline" size="sm" onClick={handleSaveProject}>
                            <Save className="w-4 h-4 mr-2" />
                            Save Project
                          </Button>
                          <Button size="sm" onClick={() => setShowExportModal(true)} className="bg-purple-600">
                            <FileDown className="w-4 h-4 mr-2" />
                            Export Video
                          </Button>
                        </div>
                      </div>
                    </CardHeader>
                  </Card>

                  {/* Rendering Queue */}
                  <RenderingQueue />

                  {/* Editor Workspace */}
                  <div className="grid grid-cols-12 gap-4">
                    {/* Timeline and Preview */}
                    <div className="col-span-9 space-y-4">
                      {/* Video Preview - REAL INTERACTIVE */}
                      <Card>
                        <CardContent className="p-0">
                          <div
                            className={cn(
                              "aspect-video bg-gray-900 relative flex items-center justify-center transition-all",
                              appliedEffects.includes('Blur') && "blur-sm",
                              appliedEffects.includes('Vintage') && "sepia",
                              appliedEffects.includes('B&W') && "grayscale",
                              isAddingFeedback && "cursor-crosshair ring-2 ring-purple-500"
                            )}
                            onClick={handleVideoClick}
                          >
                            <div className="text-center text-white">
                              <Video className={cn(
                                "w-16 h-16 mx-auto mb-4 opacity-50 transition-all",
                                isPlaying && "animate-pulse"
                              )} />
                              <p className="text-sm opacity-75">
                                {isPlaying ? 'â–¶ Playing' : 'â¸ Paused'}
                              </p>
                              <p className="text-lg font-mono font-bold mt-2">
                                {formatTime(currentTime)} / {editorProject.duration}
                              </p>
                              {appliedEffects.length > 0 && (
                                <div className="mt-2 flex gap-1 justify-center flex-wrap">
                                  {appliedEffects.map(effect => (
                                    <Badge key={effect} variant="secondary" className="text-xs">
                                      {effect}
                                    </Badge>
                                  ))}
                                </div>
                              )}
                            </div>

                            {/* UPS FEEDBACK MARKERS - Show feedback points at current time */}
                            {getCurrentFrameFeedback().map(point => (
                              <div
                                key={point.id}
                                className="absolute z-10 cursor-pointer group"
                                style={{ left: `${point.x}%`, top: `${point.y}%` }}
                                onClick={(e) => {
                                  e.stopPropagation()
                                  handleJumpToFeedback(point.timestamp)
                                }}
                              >
                                {/* Feedback Pin */}
                                <div className={cn(
                                  "w-8 h-8 rounded-full flex items-center justify-center transition-all",
                                  point.resolved
                                    ? "bg-green-500/80 ring-2 ring-green-300"
                                    : "bg-purple-500/80 ring-2 ring-purple-300 animate-pulse"
                                )}>
                                  <MessageSquare className="w-4 h-4 text-white" />
                                </div>

                                {/* Hover Tooltip */}
                                <div className="absolute top-10 left-1/2 -translate-x-1/2 bg-black/90 text-white text-xs rounded-lg p-2 w-48 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                  <p className="font-semibold">{point.author}</p>
                                  <p className="mt-1">{point.comment}</p>
                                  <p className="text-gray-400 mt-1">{formatTime(point.timestamp)}</p>
                                </div>
                              </div>
                            ))}

                            {/* Pending Feedback Position Indicator */}
                            {pendingFeedbackPosition && (
                              <div
                                className="absolute z-10 pointer-events-none"
                                style={{ left: `${pendingFeedbackPosition.x}%`, top: `${pendingFeedbackPosition.y}%` }}
                              >
                                <div className="w-8 h-8 rounded-full bg-yellow-500 ring-4 ring-yellow-300 animate-ping" />
                                <div className="absolute top-0 left-0 w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center">
                                  <Plus className="w-4 h-4 text-white" />
                                </div>
                              </div>
                            )}

                            {/* Adding Feedback Mode Indicator */}
                            {isAddingFeedback && (
                              <div className="absolute top-2 left-2 bg-purple-500 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1 animate-pulse">
                                <MessageSquare className="w-3 h-3" />
                                Click to add feedback
                              </div>
                            )}

                            {/* Progress Bar */}
                            <div className="absolute top-0 left-0 right-0 h-1 bg-white/20">
                              <div
                                className="h-full bg-purple-500 transition-all"
                                style={{ width: `${(currentTime / 30) * 100}%` }}
                              />
                            </div>

                            {/* Playback Controls - REAL INTERACTIVE */}
                            <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4">
                              <div className="flex items-center gap-3 justify-center">
                                <Button
                                  size="sm"
                                  variant="ghost"
                                  className="text-white hover:bg-white/20"
                                  onClick={handleRewind}
                                >
                                  <RotateCcw className="w-4 h-4" />
                                </Button>
                                <Button
                                  size="sm"
                                  variant="ghost"
                                  className="text-white hover:bg-white/20"
                                  onClick={handlePlayPause}
                                >
                                  {isPlaying ? <Pause className="w-5 h-5" /> : <Play className="w-5 h-5" />}
                                </Button>
                                <div className="flex items-center gap-2 ml-4">
                                  <Volume2 className="w-4 h-4 text-white" />
                                  <input
                                    type="range"
                                    min="0"
                                    max="100"
                                    value={volume}
                                    onChange={(e) => handleVolumeChange(parseInt(e.target.value))}
                                    className="w-20 h-1 bg-white/30 rounded-full appearance-none cursor-pointer"
                                    style={{
                                      background: `linear-gradient(to right, white ${volume}%, rgba(255,255,255,0.3) ${volume}%)`
                                    }}
                                  />
                                  <span className="text-xs text-white/75 w-8">{volume}%</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Timeline - REAL INTERACTIVE */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-sm flex items-center justify-between">
                            <span>Timeline ({timelineTracks.length} tracks)</span>
                            <div className="flex items-center gap-2">
                              <Button size="sm" variant="ghost" onClick={handleZoomTimeline}>
                                <Search className="w-3 h-3 mr-1" />
                                Zoom {timelineZoom}x
                              </Button>
                            </div>
                          </CardTitle>
                        </CardHeader>
                        <CardContent className="space-y-3">
                          {/* Timeline Ruler with Playhead & UPS Feedback Markers */}
                          <div className="relative">
                            <div className="flex items-center text-xs text-gray-500 border-b pb-2">
                              <div className="flex-1 flex justify-between">
                                {[0, 5, 10, 15, 20, 25, 30].map(sec => (
                                  <span key={sec}>{sec}s</span>
                                ))}
                              </div>
                            </div>

                            {/* UPS Feedback Markers on Timeline */}
                            {feedbackPoints.map(point => (
                              <div
                                key={point.id}
                                className="absolute top-0 bottom-0 w-0.5 z-5 cursor-pointer group"
                                style={{ left: `${(point.timestamp / 30) * 100}%` }}
                                onClick={() => handleJumpToFeedback(point.timestamp)}
                              >
                                <div className={cn(
                                  "absolute -top-1 -left-1.5 w-3 h-3 rounded-full transition-all",
                                  point.resolved
                                    ? "bg-green-500 ring-2 ring-green-300"
                                    : "bg-purple-500 ring-2 ring-purple-300 animate-pulse"
                                )}>
                                  <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-black/90 text-white text-xs rounded px-2 py-1 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                    {formatTime(point.timestamp)}
                                  </div>
                                </div>
                              </div>
                            ))}

                            {/* Playhead indicator */}
                            <div
                              className="absolute top-0 bottom-0 w-0.5 bg-red-500 z-10 transition-all"
                              style={{ left: `${(currentTime / 30) * 100}%` }}
                            >
                              <div className="absolute -top-2 -left-2 w-4 h-4 bg-red-500 rounded-full" />
                            </div>
                          </div>

                          {/* Tracks - INTERACTIVE */}
                          <div className="space-y-2">
                            {timelineTracks.map((track) => (
                              <div key={track.id} className="flex items-center gap-2">
                                {track.type === 'video' && <Video className="w-4 h-4 text-purple-600" />}
                                {track.type === 'audio' && <Headphones className="w-4 h-4 text-blue-600" />}
                                {track.type === 'text' && <FileText className="w-4 h-4 text-green-600" />}
                                <span className="text-xs font-medium w-16">{track.type}</span>
                                <div
                                  className={cn(
                                    "flex-1 h-12 rounded border-2 relative overflow-hidden cursor-pointer transition-all hover:shadow-lg",
                                    selectedClip === track.id ? "ring-2 ring-purple-500" : "",
                                    track.color === 'purple' && "bg-purple-100 border-purple-300",
                                    track.color === 'blue' && "bg-blue-100 border-blue-300",
                                    track.color === 'green' && "bg-green-100 border-green-300",
                                    track.color === 'orange' && "bg-orange-100 border-orange-300"
                                  )}
                                  onClick={() => handleSelectClip(track.id)}
                                >
                                  <div className="absolute inset-0 flex items-center justify-between px-2">
                                    <span className={cn(
                                      "text-xs font-medium",
                                      track.color === 'purple' && "text-purple-900",
                                      track.color === 'blue' && "text-blue-900",
                                      track.color === 'green' && "text-green-900",
                                      track.color === 'orange' && "text-orange-900"
                                    )}>
                                      {track.name}
                                    </span>
                                    {selectedClip === track.id && (
                                      <Badge variant="secondary" className="text-xs">Selected</Badge>
                                    )}
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>

                          {/* Add Track Button - REAL */}
                          <Button
                            variant="outline"
                            size="sm"
                            className="w-full"
                            onClick={handleAddTrack}
                          >
                            <Plus className="w-4 h-4 mr-2" />
                            Add Track ({timelineTracks.length}/10)
                          </Button>
                        </CardContent>
                      </Card>
                    </div>

                    {/* Tools Panel */}
                    <div className="col-span-3 space-y-4">
                      {/* World-Class Media Library */}
                      <Card>
                        <CardHeader className="pb-3">
                          <div className="flex items-center justify-between">
                            <CardTitle className="text-sm flex items-center gap-2">
                              <Folder className="w-4 h-4" />
                              Media Library
                              <Badge variant="secondary" className="text-xs">
                                {getFilteredAssets().length}/{uploadedAssets.length}
                              </Badge>
                            </CardTitle>
                            <div className="flex items-center gap-1">
                              <Button
                                variant="ghost"
                                size="sm"
                                className="h-7 w-7 p-0"
                                onClick={() => setAssetViewMode(assetViewMode === 'grid' ? 'list' : 'grid')}
                              >
                                {assetViewMode === 'grid' ? (
                                  <LayoutList className="w-3.5 h-3.5" />
                                ) : (
                                  <LayoutGrid className="w-3.5 h-3.5" />
                                )}
                              </Button>
                            </div>
                          </div>
                        </CardHeader>
                        <CardContent className="space-y-3">
                          {/* Search & Filters */}
                          <div className="space-y-2">
                            <div className="relative">
                              <Search className="absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gray-400" />
                              <Input
                                placeholder="Search assets..."
                                value={assetSearchTerm}
                                onChange={(e) => setAssetSearchTerm(e.target.value)}
                                className="pl-8 h-8 text-xs"
                              />
                            </div>

                            {/* Filter Buttons */}
                            <div className="flex items-center gap-1 flex-wrap">
                              {['all', 'video', 'audio', 'image'].map((type) => (
                                <Button
                                  key={type}
                                  variant={assetFilterType === type ? 'default' : 'outline'}
                                  size="sm"
                                  className="h-6 text-xs px-2"
                                  onClick={() => setAssetFilterType(type as any)}
                                >
                                  {type === 'video' && <Video className="w-3 h-3 mr-1" />}
                                  {type === 'audio' && <Headphones className="w-3 h-3 mr-1" />}
                                  {type === 'image' && <Image className="w-3 h-3 mr-1" />}
                                  {type.charAt(0).toUpperCase() + type.slice(1)}
                                </Button>
                              ))}
                              <Button
                                variant={showFavoritesOnly ? 'default' : 'outline'}
                                size="sm"
                                className="h-6 text-xs px-2"
                                onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                              >
                                <Star className={cn("w-3 h-3 mr-1", showFavoritesOnly && "fill-current")} />
                                Favorites
                              </Button>
                            </div>

                            {/* Sort & Actions */}
                            <div className="flex items-center justify-between gap-2">
                              <div className="flex items-center gap-1">
                                <span className="text-xs text-gray-500">Sort:</span>
                                <Button
                                  variant="ghost"
                                  size="sm"
                                  className="h-6 text-xs px-2"
                                  onClick={() => setAssetSortBy(assetSortBy === 'name' ? 'date' : assetSortBy === 'date' ? 'size' : 'name')}
                                >
                                  {assetSortBy === 'name' && 'Name'}
                                  {assetSortBy === 'date' && 'Date'}
                                  {assetSortBy === 'size' && 'Size'}
                                  <ChevronDown className="w-3 h-3 ml-1" />
                                </Button>
                              </div>

                              {selectedAssets.length > 0 && (
                                <div className="flex items-center gap-1">
                                  <Badge variant="secondary" className="text-xs">
                                    {selectedAssets.length} selected
                                  </Badge>
                                  <Button
                                    variant="ghost"
                                    size="sm"
                                    className="h-6 text-xs px-2 text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={deleteSelectedAssets}
                                  >
                                    <Trash2 className="w-3 h-3" />
                                  </Button>
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Upload Button */}
                          <Button
                            variant="default"
                            size="sm"
                            className="w-full h-8"
                            onClick={() => setShowUploadModal(true)}
                          >
                            <Upload className="w-3.5 h-3.5 mr-2" />
                            Upload Media
                          </Button>

                          {/* Asset Grid/List */}
                          {assetViewMode === 'grid' ? (
                            <div className="grid grid-cols-2 gap-2 max-h-[400px] overflow-y-auto">
                              {getFilteredAssets().map(asset => (
                                <div
                                  key={asset.id}
                                  className={cn(
                                    "relative border rounded-lg overflow-hidden cursor-pointer group transition-all hover:shadow-md",
                                    selectedAssets.includes(asset.id) && "ring-2 ring-purple-500"
                                  )}
                                >
                                  {/* Thumbnail */}
                                  <div
                                    className="aspect-video bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center relative"
                                    onClick={() => handleAddAssetToTimeline(asset)}
                                  >
                                    {asset.type === 'video' && <Video className="w-8 h-8 text-purple-600" />}
                                    {asset.type === 'audio' && <Headphones className="w-8 h-8 text-blue-600" />}
                                    {asset.type === 'image' && <Image className="w-8 h-8 text-green-600" />}

                                    {/* Overlay Actions */}
                                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center">
                                      <Plus className="w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity" />
                                    </div>

                                    {/* Duration Badge */}
                                    {asset.duration && (
                                      <Badge className="absolute bottom-1 right-1 text-xs h-4 px-1">
                                        {asset.duration}
                                      </Badge>
                                    )}
                                  </div>

                                  {/* Asset Info */}
                                  <div className="p-2 space-y-1">
                                    <div className="flex items-start justify-between gap-1">
                                      <p className="text-xs font-medium truncate flex-1">{asset.name}</p>
                                      <div className="flex items-center gap-0.5 shrink-0">
                                        <Button
                                          variant="ghost"
                                          size="sm"
                                          className="h-5 w-5 p-0"
                                          onClick={(e) => {
                                            e.stopPropagation()
                                            toggleAssetFavorite(asset.id)
                                          }}
                                        >
                                          <Star className={cn(
                                            "w-3 h-3",
                                            asset.favorite ? "fill-yellow-400 text-yellow-400" : "text-gray-400"
                                          )} />
                                        </Button>
                                        <Button
                                          variant="ghost"
                                          size="sm"
                                          className="h-5 w-5 p-0"
                                          onClick={(e) => {
                                            e.stopPropagation()
                                            toggleAssetSelection(asset.id)
                                          }}
                                        >
                                          <CheckCircle className={cn(
                                            "w-3 h-3",
                                            selectedAssets.includes(asset.id) ? "text-purple-600" : "text-gray-400"
                                          )} />
                                        </Button>
                                      </div>
                                    </div>
                                    <div className="flex items-center justify-between text-xs text-gray-500">
                                      <span>{asset.size}</span>
                                      {asset.resolution && (
                                        <span className="text-xs text-gray-400">{asset.resolution}</span>
                                      )}
                                    </div>
                                    {asset.tags && asset.tags.length > 0 && (
                                      <div className="flex items-center gap-1 flex-wrap">
                                        {asset.tags.slice(0, 2).map((tag: string) => (
                                          <Badge key={tag} variant="secondary" className="text-xs h-4 px-1">
                                            {tag}
                                          </Badge>
                                        ))}
                                      </div>
                                    )}
                                  </div>
                                </div>
                              ))}
                            </div>
                          ) : (
                            <div className="space-y-1 max-h-[400px] overflow-y-auto">
                              {getFilteredAssets().map(asset => (
                                <div
                                  key={asset.id}
                                  className={cn(
                                    "p-2 border rounded hover:bg-gray-50 cursor-pointer group transition-all",
                                    selectedAssets.includes(asset.id) && "bg-purple-50 border-purple-300"
                                  )}
                                  onClick={() => handleAddAssetToTimeline(asset)}
                                >
                                  <div className="flex items-center gap-2">
                                    <Button
                                      variant="ghost"
                                      size="sm"
                                      className="h-5 w-5 p-0 shrink-0"
                                      onClick={(e) => {
                                        e.stopPropagation()
                                        toggleAssetSelection(asset.id)
                                      }}
                                    >
                                      <CheckCircle className={cn(
                                        "w-3.5 h-3.5",
                                        selectedAssets.includes(asset.id) ? "text-purple-600" : "text-gray-400"
                                      )} />
                                    </Button>

                                    {asset.type === 'video' && <Video className="w-4 h-4 text-purple-600 shrink-0" />}
                                    {asset.type === 'audio' && <Headphones className="w-4 h-4 text-blue-600 shrink-0" />}
                                    {asset.type === 'image' && <Image className="w-4 h-4 text-green-600 shrink-0" />}

                                    <div className="flex-1 min-w-0">
                                      <div className="flex items-center gap-2">
                                        <p className="text-xs font-medium truncate">{asset.name}</p>
                                        {asset.favorite && (
                                          <Star className="w-3 h-3 fill-yellow-400 text-yellow-400 shrink-0" />
                                        )}
                                      </div>
                                      <div className="flex items-center gap-2 text-xs text-gray-500">
                                        <span>{asset.size}</span>
                                        {asset.duration && <span>â€¢ {asset.duration}</span>}
                                        {asset.resolution && <span>â€¢ {asset.resolution}</span>}
                                      </div>
                                    </div>

                                    <Plus className="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity shrink-0" />
                                  </div>
                                </div>
                              ))}
                            </div>
                          )}

                          {getFilteredAssets().length === 0 && (
                            <div className="text-center py-8 text-gray-400">
                              <Folder className="w-12 h-12 mx-auto mb-2 opacity-50" />
                              <p className="text-sm">No assets found</p>
                              <p className="text-xs">Try adjusting your filters</p>
                            </div>
                          )}
                        </CardContent>
                      </Card>

                      {/* Editing Tools */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-sm">Tools</CardTitle>
                        </CardHeader>
                        <CardContent className="space-y-2">
                          <Button
                            variant={activeTool === 'Split' ? 'default' : 'outline'}
                            size="sm"
                            className={cn(
                              "w-full justify-start transition-all",
                              activeTool === 'Split' && "bg-purple-600 text-white"
                            )}
                            onClick={() => {
                              if (activeTool === 'Split') {
                                handleSplitClip()
                              } else {
                                handleToolActivate('Split')
                              }
                            }}
                          >
                            <Scissors className="w-4 h-4 mr-2" />
                            {activeTool === 'Split' ? 'Click to Split' : 'Split'}
                          </Button>
                          <Button
                            variant={activeTool === 'Trim' ? 'default' : 'outline'}
                            size="sm"
                            className={cn(
                              "w-full justify-start transition-all",
                              activeTool === 'Trim' && "bg-purple-600 text-white"
                            )}
                            onClick={() => {
                              if (activeTool === 'Trim') {
                                handleTrimClip()
                              } else {
                                handleToolActivate('Trim')
                              }
                            }}
                          >
                            <Copy className="w-4 h-4 mr-2" />
                            {activeTool === 'Trim' ? 'Click to Trim' : 'Trim'}
                          </Button>
                          <Button
                            variant="outline"
                            size="sm"
                            className="w-full justify-start"
                            onClick={() => setShowColorPanel(!showColorPanel)}
                          >
                            <PaintBucket className="w-4 h-4 mr-2" />
                            Color Grading
                          </Button>
                          <Button
                            variant="outline"
                            size="sm"
                            className="w-full justify-start"
                            onClick={() => setShowTransitionsPanel(!showTransitionsPanel)}
                          >
                            <Sparkles className="w-4 h-4 mr-2" />
                            Transitions
                          </Button>
                        </CardContent>
                      </Card>

                      {/* Effects & Filters - REAL INTERACTIVE */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-sm flex items-center justify-between">
                            <span>Effects</span>
                            {appliedEffects.length > 0 && (
                              <Badge variant="secondary" className="text-xs">
                                {appliedEffects.length} active
                              </Badge>
                            )}
                          </CardTitle>
                        </CardHeader>
                        <CardContent className="space-y-2">
                          {['Blur', 'Sharpen', 'Vintage', 'B&W'].map((effect) => (
                            <Button
                              key={effect}
                              variant={appliedEffects.includes(effect) ? "default" : "ghost"}
                              size="sm"
                              className={cn(
                                "w-full justify-start transition-all",
                                appliedEffects.includes(effect) && "bg-purple-600 text-white"
                              )}
                              onClick={() => handleApplyEffect(effect)}
                            >
                              <Sparkles className={cn(
                                "w-3 h-3 mr-2",
                                appliedEffects.includes(effect) && "animate-pulse"
                              )} />
                              {effect}
                              {appliedEffects.includes(effect) && " âœ“"}
                            </Button>
                          ))}
                        </CardContent>
                      </Card>

                      {/* UNIVERSAL PINPOINT SYSTEM (UPS) - Feedback Panel */}
                      <Card className={cn(
                        "transition-all",
                        showFeedbackPanel && "ring-2 ring-purple-500"
                      )}>
                        <CardHeader>
                          <CardTitle className="text-sm flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <MessageSquare className="w-4 h-4" />
                              <span>Feedback</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <Badge variant="secondary" className="text-xs">
                                {feedbackPoints.length} comments
                              </Badge>
                              <Button
                                size="sm"
                                variant="ghost"
                                onClick={() => setShowFeedbackPanel(!showFeedbackPanel)}
                              >
                                {showFeedbackPanel ? <ChevronDown className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />}
                              </Button>
                            </div>
                          </CardTitle>
                        </CardHeader>
                        {showFeedbackPanel && (
                          <CardContent className="space-y-3">
                            {/* Add Feedback Button */}
                            <Button
                              variant={isAddingFeedback ? "default" : "outline"}
                              size="sm"
                              className={cn(
                                "w-full justify-start",
                                isAddingFeedback && "bg-purple-600 text-white animate-pulse"
                              )}
                              onClick={toggleAddFeedbackMode}
                            >
                              <Plus className="w-4 h-4 mr-2" />
                              {isAddingFeedback ? 'Click video to place' : 'Add Frame Comment'}
                            </Button>

                            {/* Pending Feedback Input */}
                            {pendingFeedbackPosition && (
                              <div className="space-y-2 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                <Label className="text-xs font-medium">Add your comment:</Label>
                                <Textarea
                                  placeholder="Enter your feedback..."
                                  value={newFeedbackText}
                                  onChange={(e) => setNewFeedbackText(e.target.value)}
                                  className="text-xs"
                                  rows={3}
                                />
                                <div className="flex gap-2">
                                  <Button
                                    size="sm"
                                    className="flex-1"
                                    onClick={handleAddFeedbackPoint}
                                  >
                                    Add Comment
                                  </Button>
                                  <Button
                                    size="sm"
                                    variant="ghost"
                                    onClick={() => {
                                      setPendingFeedbackPosition(null)
                                      setNewFeedbackText('')
                                      setIsAddingFeedback(false)
                                    }}
                                  >
                                    Cancel
                                  </Button>
                                </div>
                              </div>
                            )}

                            {/* Feedback List */}
                            <div className="space-y-2 max-h-96 overflow-y-auto">
                              {feedbackPoints.length === 0 ? (
                                <div className="text-center py-6 text-xs text-gray-500">
                                  <MessageSquare className="w-8 h-8 mx-auto mb-2 opacity-30" />
                                  <p>No feedback yet</p>
                                  <p className="mt-1">Click "Add Frame Comment" to start</p>
                                </div>
                              ) : (
                                feedbackPoints.map(point => (
                                  <div
                                    key={point.id}
                                    className={cn(
                                      "p-3 rounded-lg border-2 transition-all cursor-pointer hover:shadow-md",
                                      point.resolved
                                        ? "bg-green-50 border-green-200"
                                        : "bg-purple-50 border-purple-200"
                                    )}
                                    onClick={() => handleJumpToFeedback(point.timestamp)}
                                  >
                                    <div className="flex items-start justify-between gap-2 mb-2">
                                      <div className="flex items-center gap-2">
                                        <Avatar className="h-6 w-6">
                                          <AvatarFallback className="text-xs">
                                            {point.author.split(' ').map(n => n[0]).join('')}
                                          </AvatarFallback>
                                        </Avatar>
                                        <div>
                                          <p className="text-xs font-medium">{point.author}</p>
                                          <p className="text-xs text-gray-500">{formatTime(point.timestamp)}</p>
                                        </div>
                                      </div>
                                      <DropdownMenu>
                                        <DropdownMenuTrigger asChild>
                                          <Button variant="ghost" size="sm" className="h-6 w-6 p-0">
                                            <MoreVertical className="w-3 h-3" />
                                          </Button>
                                        </DropdownMenuTrigger>
                                        <DropdownMenuContent>
                                          <DropdownMenuItem onClick={(e) => {
                                            e.stopPropagation()
                                            handleToggleFeedbackResolved(point.id)
                                          }}>
                                            {point.resolved ? 'Mark as Unresolved' : 'Mark as Resolved'}
                                          </DropdownMenuItem>
                                          <DropdownMenuItem onClick={(e) => {
                                            e.stopPropagation()
                                            handleDeleteFeedback(point.id)
                                          }}>
                                            Delete
                                          </DropdownMenuItem>
                                        </DropdownMenuContent>
                                      </DropdownMenu>
                                    </div>
                                    <p className="text-xs">{point.comment}</p>
                                    {point.resolved && (
                                      <Badge variant="secondary" className="mt-2 text-xs">
                                        <CheckCircle className="w-3 h-3 mr-1" />
                                        Resolved
                                      </Badge>
                                    )}
                                    {point.replies.length > 0 && (
                                      <div className="mt-2 pt-2 border-t space-y-1">
                                        {point.replies.map((reply, idx) => (
                                          <div key={idx} className="text-xs text-gray-600">
                                            <span className="font-medium">{reply.author}:</span> {reply.text}
                                          </div>
                                        ))}
                                      </div>
                                    )}
                                  </div>
                                ))
                              )}
                            </div>
                          </CardContent>
                        )}
                      </Card>

                      {/* Project Stats */}
                      <Card>
                        <CardHeader>
                          <CardTitle className="text-sm">Stats</CardTitle>
                        </CardHeader>
                        <CardContent className="space-y-2 text-xs">
                          <div className="flex justify-between">
                            <span className="text-gray-600">Duration:</span>
                            <span className="font-medium">{editorProject.duration}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Clips:</span>
                            <span className="font-medium">{editorProject.assets.video}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Audio:</span>
                            <span className="font-medium">{editorProject.assets.audio}</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Size:</span>
                            <span className="font-medium">245 MB</span>
                          </div>
                          <div className="flex justify-between">
                            <span className="text-gray-600">Feedback:</span>
                            <span className="font-medium">{feedbackPoints.length} points</span>
                          </div>
                        </CardContent>
                      </Card>
                    </div>
                  </div>
                </div>
              )}

              {/* Upload Modal */}
                <Dialog open={showUploadModal} onOpenChange={setShowUploadModal}>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Upload Media Files</DialogTitle>
                      <DialogDescription>
                        Upload videos, audio, or images to your media library
                      </DialogDescription>
                    </DialogHeader>
                    <div className="space-y-4">
                      <div className="border-2 border-dashed rounded-lg p-8 text-center">
                        <Upload className="w-12 h-12 mx-auto mb-4 text-gray-400" />
                        <p className="text-sm font-medium mb-2">Choose files to upload</p>
                        <p className="text-xs text-gray-500 mb-4">Supports: MP4, MOV, MP3, WAV, JPG, PNG</p>
                        <Input
                          type="file"
                          accept="video/*,audio/*,image/*"
                          onChange={handleFileUpload}
                          className="max-w-xs mx-auto"
                        />
                      </div>
                      {uploadingFile && (
                        <div className="space-y-2">
                          <Progress value={66} />
                          <p className="text-xs text-center text-gray-500">Uploading...</p>
                        </div>
                      )}
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Color Grading Panel */}
                <Dialog open={showColorPanel} onOpenChange={setShowColorPanel}>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Color Grading</DialogTitle>
                      <DialogDescription>
                        Adjust brightness, contrast, saturation, and temperature
                      </DialogDescription>
                    </DialogHeader>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Brightness: {colorSettings.brightness}%</Label>
                        <Input
                          type="range"
                          min="0"
                          max="200"
                          value={colorSettings.brightness}
                          onChange={(e) => setColorSettings(prev => ({ ...prev, brightness: parseInt(e.target.value) }))}
                          className="w-full"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Contrast: {colorSettings.contrast}%</Label>
                        <Input
                          type="range"
                          min="0"
                          max="200"
                          value={colorSettings.contrast}
                          onChange={(e) => setColorSettings(prev => ({ ...prev, contrast: parseInt(e.target.value) }))}
                          className="w-full"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Saturation: {colorSettings.saturation}%</Label>
                        <Input
                          type="range"
                          min="0"
                          max="200"
                          value={colorSettings.saturation}
                          onChange={(e) => setColorSettings(prev => ({ ...prev, saturation: parseInt(e.target.value) }))}
                          className="w-full"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Temperature: {colorSettings.temperature}</Label>
                        <Input
                          type="range"
                          min="-100"
                          max="100"
                          value={colorSettings.temperature}
                          onChange={(e) => setColorSettings(prev => ({ ...prev, temperature: parseInt(e.target.value) }))}
                          className="w-full"
                        />
                      </div>
                      <Button onClick={handleApplyColorGrading} className="w-full">
                        Apply Color Grading
                      </Button>
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Transitions Panel */}
                <Dialog open={showTransitionsPanel} onOpenChange={setShowTransitionsPanel}>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Transitions</DialogTitle>
                      <DialogDescription>
                        Choose a transition effect between clips
                      </DialogDescription>
                    </DialogHeader>
                    <div className="grid grid-cols-2 gap-3">
                      {['Fade', 'Dissolve', 'Wipe', 'Slide', 'Zoom', 'Cross Fade', 'Blur', 'Spin'].map(transition => (
                        <Button
                          key={transition}
                          variant={selectedTransition === transition ? 'default' : 'outline'}
                          onClick={() => handleApplyTransition(transition)}
                          className="h-20 flex flex-col gap-2"
                        >
                          <Sparkles className="w-5 h-5" />
                          <span className="text-xs">{transition}</span>
                        </Button>
                      ))}
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Export Video Modal */}
                <Dialog open={showExportModal} onOpenChange={setShowExportModal}>
                  <DialogContent className="max-w-2xl">
                    <DialogHeader>
                      <DialogTitle>Export Video</DialogTitle>
                      <DialogDescription>
                        Configure export settings for {editorProject?.title}
                      </DialogDescription>
                    </DialogHeader>
                    <div className="space-y-4">
                      {/* Format Selection */}
                      <div className="space-y-2">
                        <Label>Format</Label>
                        <div className="grid grid-cols-5 gap-2">
                          {['mp4', 'webm', 'mov', 'avi', 'mkv'].map(format => (
                            <Button
                              key={format}
                              variant={exportSettings.format === format ? 'default' : 'outline'}
                              onClick={() => setExportSettings(prev => ({ ...prev, format }))}
                              className="uppercase"
                            >
                              {format}
                            </Button>
                          ))}
                        </div>
                      </div>

                      {/* Quality Selection */}
                      <div className="space-y-2">
                        <Label>Quality</Label>
                        <div className="grid grid-cols-4 gap-2">
                          {['low', 'medium', 'high', 'ultra'].map(quality => (
                            <Button
                              key={quality}
                              variant={exportSettings.quality === quality ? 'default' : 'outline'}
                              onClick={() => setExportSettings(prev => ({ ...prev, quality }))}
                              className="capitalize"
                            >
                              {quality}
                            </Button>
                          ))}
                        </div>
                      </div>

                      {/* Resolution Selection */}
                      <div className="space-y-2">
                        <Label>Resolution</Label>
                        <div className="grid grid-cols-3 gap-2">
                          {['1280x720', '1920x1080', '3840x2160'].map(resolution => (
                            <Button
                              key={resolution}
                              variant={exportSettings.resolution === resolution ? 'default' : 'outline'}
                              onClick={() => setExportSettings(prev => ({ ...prev, resolution }))}
                              className="text-xs"
                            >
                              {resolution === '1280x720' ? '720p HD' : resolution === '1920x1080' ? '1080p FHD' : '4K UHD'}
                            </Button>
                          ))}
                        </div>
                      </div>

                      {/* FPS Selection */}
                      <div className="space-y-2">
                        <Label>Frame Rate</Label>
                        <div className="grid grid-cols-4 gap-2">
                          {[24, 30, 60, 120].map(fps => (
                            <Button
                              key={fps}
                              variant={exportSettings.fps === fps ? 'default' : 'outline'}
                              onClick={() => setExportSettings(prev => ({ ...prev, fps }))}
                            >
                              {fps} FPS
                            </Button>
                          ))}
                        </div>
                      </div>

                      {/* Codec Selection */}
                      <div className="space-y-2">
                        <Label>Video Codec</Label>
                        <div className="grid grid-cols-3 gap-2">
                          {['h264', 'h265', 'vp9'].map(codec => (
                            <Button
                              key={codec}
                              variant={exportSettings.codec === codec ? 'default' : 'outline'}
                              onClick={() => setExportSettings(prev => ({ ...prev, codec }))}
                              className="uppercase"
                            >
                              {codec}
                            </Button>
                          ))}
                        </div>
                      </div>

                      {/* Export Info */}
                      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 className="font-semibold text-sm mb-2">Export Summary</h4>
                        <div className="grid grid-cols-2 gap-2 text-xs text-gray-700">
                          <div>Format: <span className="font-mono uppercase">{exportSettings.format}</span></div>
                          <div>Quality: <span className="capitalize">{exportSettings.quality}</span></div>
                          <div>Resolution: <span className="font-mono">{exportSettings.resolution}</span></div>
                          <div>Frame Rate: <span className="font-mono">{exportSettings.fps} FPS</span></div>
                          <div>Video Codec: <span className="font-mono uppercase">{exportSettings.codec}</span></div>
                          <div>Audio: <span className="font-mono uppercase">{exportSettings.audioCodec} @ {exportSettings.audioBitrate}</span></div>
                        </div>
                      </div>

                      {/* Export Button */}
                      <div className="flex gap-2 justify-end pt-4">
                        <Button variant="outline" onClick={() => setShowExportModal(false)} disabled={isExporting}>
                          Cancel
                        </Button>
                        <Button onClick={handleExportVideo} disabled={isExporting} className="bg-purple-600">
                          {isExporting ? (
                            <>
                              <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                              Exporting...
                            </>
                          ) : (
                            <>
                              <FileDown className="w-4 h-4 mr-2" />
                              Start Export
                            </>
                          )}
                        </Button>
                      </div>
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Enhanced Template Preview & Customization Modal */}
                <Dialog open={showTemplatePreview} onOpenChange={setShowTemplatePreview}>
                  <DialogContent className="max-w-5xl max-h-[90vh] overflow-y-auto">
                    <DialogHeader>
                      <DialogTitle className="text-2xl flex items-center gap-2">
                        <Film className="w-6 h-6 text-purple-600" />
                        {previewingTemplate?.name}
                      </DialogTitle>
                      <DialogDescription className="flex items-center gap-2">
                        <Badge variant="outline">{previewingTemplate?.category}</Badge>
                        <span>â€¢</span>
                        <span>{previewingTemplate?.resolution}</span>
                        <span>â€¢</span>
                        <span>{previewingTemplate?.duration}</span>
                        {previewingTemplate?.premium && (
                          <>
                            <span>â€¢</span>
                            <Badge className="bg-yellow-500">Premium</Badge>
                          </>
                        )}
                      </DialogDescription>
                    </DialogHeader>

                    <div className="space-y-6">
                      {/* Template Preview Area with Animation */}
                      <div className="aspect-video bg-gradient-to-br from-purple-500 via-violet-600 to-indigo-600 rounded-lg flex items-center justify-center relative overflow-hidden group">
                        {/* Animated background */}
                        <div className="absolute inset-0 opacity-20">
                          <div className="absolute top-0 left-0 w-full h-full">
                            <div className="absolute top-10 left-10 w-32 h-32 bg-white rounded-full blur-3xl animate-pulse" />
                            <div className="absolute bottom-20 right-20 w-40 h-40 bg-yellow-300 rounded-full blur-3xl animate-pulse delay-75" />
                          </div>
                        </div>

                        <Film className="w-32 h-32 text-white opacity-30" />

                        <div className="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20">
                          <Button size="lg" variant="secondary" className="gap-2 shadow-xl">
                            <Play className="w-6 h-6" />
                            Play Preview
                          </Button>
                        </div>
                      </div>

                      {/* Template Structure Breakdown */}
                      <Card className="border-purple-200 bg-purple-50/50">
                        <CardHeader className="pb-3">
                          <CardTitle className="text-sm flex items-center gap-2">
                            <Layers className="w-4 h-4" />
                            Template Structure
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          <div className="space-y-2">
                            <div className="flex items-center justify-between p-2 bg-white rounded border">
                              <div className="flex items-center gap-2">
                                <Video className="w-4 h-4 text-purple-600" />
                                <span className="text-sm font-medium">Intro Scene</span>
                              </div>
                              <Badge variant="outline" className="text-xs">5s</Badge>
                            </div>
                            <div className="flex items-center justify-between p-2 bg-white rounded border">
                              <div className="flex items-center gap-2">
                                <Video className="w-4 h-4 text-purple-600" />
                                <span className="text-sm font-medium">Main Content</span>
                              </div>
                              <Badge variant="outline" className="text-xs">20s</Badge>
                            </div>
                            <div className="flex items-center justify-between p-2 bg-white rounded border">
                              <div className="flex items-center gap-2">
                                <Headphones className="w-4 h-4 text-blue-600" />
                                <span className="text-sm font-medium">Background Music</span>
                              </div>
                              <Badge variant="outline" className="text-xs">Full Duration</Badge>
                            </div>
                            <div className="flex items-center justify-between p-2 bg-white rounded border">
                              <div className="flex items-center gap-2">
                                <Type className="w-4 h-4 text-green-600" />
                                <span className="text-sm font-medium">Text Overlays</span>
                              </div>
                              <Badge variant="outline" className="text-xs">Various</Badge>
                            </div>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Template Details Grid */}
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <Card>
                          <CardContent className="p-4">
                            <Label className="text-xs text-gray-500">Duration</Label>
                            <p className="font-semibold text-lg">{previewingTemplate?.duration}</p>
                          </CardContent>
                        </Card>
                        <Card>
                          <CardContent className="p-4">
                            <Label className="text-xs text-gray-500">Resolution</Label>
                            <p className="font-semibold text-lg">{previewingTemplate?.resolution}</p>
                          </CardContent>
                        </Card>
                        <Card>
                          <CardContent className="p-4">
                            <Label className="text-xs text-gray-500">Downloads</Label>
                            <p className="font-semibold text-lg">{previewingTemplate?.downloads}</p>
                          </CardContent>
                        </Card>
                        <Card>
                          <CardContent className="p-4">
                            <Label className="text-xs text-gray-500">Rating</Label>
                            <p className="font-semibold text-lg flex items-center gap-1">
                              <Star className="w-4 h-4 text-yellow-500 fill-yellow-500" />
                              {previewingTemplate?.rating}
                            </p>
                          </CardContent>
                        </Card>
                      </div>

                      {/* Description */}
                      <Card>
                        <CardHeader className="pb-3">
                          <CardTitle className="text-sm">About This Template</CardTitle>
                        </CardHeader>
                        <CardContent>
                          <p className="text-sm text-gray-600 leading-relaxed">
                            This {previewingTemplate?.category?.toLowerCase()} template provides a professional starting point for your video project.
                            It includes pre-configured scenes with intro, main content, background music, and text overlays.
                            The template is fully customizable - you can adjust timing, swap assets, and modify effects to match your brand.
                            Perfect for creating engaging {previewingTemplate?.category?.toLowerCase()} content quickly.
                          </p>
                        </CardContent>
                      </Card>

                      {/* Features */}
                      <Card className="border-blue-200 bg-blue-50/50">
                        <CardHeader className="pb-3">
                          <CardTitle className="text-sm flex items-center gap-2">
                            <Sparkles className="w-4 h-4 text-blue-600" />
                            What's Included
                          </CardTitle>
                        </CardHeader>
                        <CardContent>
                          <div className="grid grid-cols-2 gap-2 text-sm">
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>4 pre-built scenes</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>Background music track</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>Text overlay templates</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>Professional transitions</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>Color grading presets</span>
                            </div>
                            <div className="flex items-center gap-2">
                              <CheckCircle className="w-4 h-4 text-green-600" />
                              <span>Fully customizable</span>
                            </div>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Actions */}
                      <div className="flex gap-3 pt-2">
                        <Button
                          variant="outline"
                          size="lg"
                          className="flex-1"
                          onClick={() => {
                            setShowTemplatePreview(false)
                            console.log('âŒ Template preview closed')
                          }}
                        >
                          <X className="w-4 h-4 mr-2" />
                          Close
                        </Button>
                        <Button
                          size="lg"
                          className="flex-1 bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700 text-white font-semibold"
                          onClick={() => {
                            console.log('âœ¨ Applying template:', previewingTemplate.name)

                            // Create template tracks
                            const templateTracks = []

                            // Add intro scene (5 seconds)
                            templateTracks.push({
                              id: `template-intro-${Date.now()}`,
                              type: 'video',
                              name: `${previewingTemplate.name} - Intro`,
                              duration: 5,
                              color: 'purple',
                              asset: {
                                id: `asset-${Date.now()}-1`,
                                url: previewingTemplate.thumbnail || '/assets/placeholder.png',
                                resolution: previewingTemplate.resolution,
                                fps: 30,
                                size: '10 MB'
                              }
                            })

                            // Add main content scene (20 seconds)
                            templateTracks.push({
                              id: `template-main-${Date.now()}`,
                              type: 'video',
                              name: `${previewingTemplate.name} - Main Content`,
                              duration: 20,
                              color: 'purple',
                              asset: {
                                id: `asset-${Date.now()}-2`,
                                url: previewingTemplate.thumbnail || '/assets/placeholder.png',
                                resolution: previewingTemplate.resolution,
                                fps: 30,
                                size: '50 MB'
                              }
                            })

                            // Add background music (full duration)
                            templateTracks.push({
                              id: `template-audio-${Date.now()}`,
                              type: 'audio',
                              name: `${previewingTemplate.name} - Background Music`,
                              duration: 25,
                              color: 'blue',
                              asset: {
                                id: `asset-${Date.now()}-3`,
                                url: '/assets/audio.mp3',
                                size: '5 MB'
                              }
                            })

                            // Add text overlay
                            templateTracks.push({
                              id: `template-text-${Date.now()}`,
                              type: 'text',
                              name: `${previewingTemplate.name} - Title`,
                              duration: 25,
                              color: 'green',
                              asset: {
                                id: `asset-${Date.now()}-4`,
                                size: '1 KB'
                              }
                            })

                            // Apply to timeline
                            setTimelineTracks(prev => {
                              const updated = [...prev, ...templateTracks]
                              console.log('ðŸ“ Timeline updated:', updated.length, 'total tracks')
                              console.log('ðŸ“ Template tracks:', templateTracks.map(t => t.name))
                              return updated
                            })

                            // Close modal and switch to editor
                            setShowTemplatePreview(false)
                            setActiveTab('editor')

                            toast.success(`âœ… Template applied successfully!`, {
                              description: `${previewingTemplate.name} with ${templateTracks.length} tracks added to timeline`,
                              duration: 5000
                            })

                            console.log('âœ… Template applied - switched to Editor tab')
                          }}
                        >
                          <Plus className="w-5 h-5 mr-2" />
                          Apply to Timeline
                        </Button>
                      </div>
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Render Configuration Modal */}
                <Dialog open={showRenderModal} onOpenChange={setShowRenderModal}>
                  <DialogContent className="max-w-2xl">
                    <DialogHeader>
                      <DialogTitle className="text-xl flex items-center gap-2">
                        <Camera className="w-5 h-5 text-purple-600" />
                        Configure Render Settings
                      </DialogTitle>
                      <DialogDescription>
                        Choose your export format, quality, and codec settings
                      </DialogDescription>
                    </DialogHeader>

                    <div className="space-y-6">
                      {/* Timeline Summary */}
                      <Card className="bg-blue-50 border-blue-200">
                        <CardContent className="p-4">
                          <div className="flex items-center justify-between">
                            <div>
                              <p className="text-sm font-medium text-gray-900">Timeline Summary</p>
                              <p className="text-xs text-gray-600 mt-1">
                                {timelineTracks.length} track{timelineTracks.length !== 1 ? 's' : ''} â€¢ {appliedEffects.length} effect{appliedEffects.length !== 1 ? 's' : ''}
                              </p>
                            </div>
                            <Badge variant="secondary">
                              {calculateEstimatedTime()}
                            </Badge>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Resolution & Frame Rate */}
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Resolution</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.resolution}
                            onChange={(e) => setRenderSettings({...renderSettings, resolution: e.target.value})}
                          >
                            <option value="3840x2160">4K (3840x2160)</option>
                            <option value="2560x1440">2K (2560x1440)</option>
                            <option value="1920x1080">Full HD (1920x1080)</option>
                            <option value="1280x720">HD (1280x720)</option>
                            <option value="854x480">SD (854x480)</option>
                          </select>
                        </div>
                        <div className="space-y-2">
                          <Label>Frame Rate</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.fps}
                            onChange={(e) => setRenderSettings({...renderSettings, fps: Number(e.target.value)})}
                          >
                            <option value="60">60 FPS</option>
                            <option value="30">30 FPS</option>
                            <option value="24">24 FPS (Cinematic)</option>
                          </select>
                        </div>
                      </div>

                      {/* Format & Codec */}
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Format</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.format}
                            onChange={(e) => setRenderSettings({...renderSettings, format: e.target.value})}
                          >
                            <option value="mp4">MP4</option>
                            <option value="mov">MOV</option>
                            <option value="webm">WebM</option>
                            <option value="avi">AVI</option>
                          </select>
                        </div>
                        <div className="space-y-2">
                          <Label>Video Codec</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.codec}
                            onChange={(e) => setRenderSettings({...renderSettings, codec: e.target.value})}
                          >
                            <option value="h264">H.264</option>
                            <option value="h265">H.265 (HEVC)</option>
                            <option value="vp9">VP9</option>
                            <option value="av1">AV1</option>
                          </select>
                        </div>
                      </div>

                      {/* Quality & Bitrate */}
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Quality Preset</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.quality}
                            onChange={(e) => setRenderSettings({...renderSettings, quality: e.target.value})}
                          >
                            <option value="low">Low (Faster)</option>
                            <option value="medium">Medium (Balanced)</option>
                            <option value="high">High (Best Quality)</option>
                          </select>
                        </div>
                        <div className="space-y-2">
                          <Label>Video Bitrate (kbps)</Label>
                          <input
                            type="number"
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.bitrate}
                            onChange={(e) => setRenderSettings({...renderSettings, bitrate: e.target.value})}
                            min="1000"
                            max="50000"
                            step="500"
                          />
                        </div>
                      </div>

                      {/* Audio Settings */}
                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Audio Codec</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.audioCodec}
                            onChange={(e) => setRenderSettings({...renderSettings, audioCodec: e.target.value})}
                          >
                            <option value="aac">AAC</option>
                            <option value="mp3">MP3</option>
                            <option value="opus">Opus</option>
                          </select>
                        </div>
                        <div className="space-y-2">
                          <Label>Audio Bitrate (kbps)</Label>
                          <select
                            className="w-full p-2 border rounded-lg"
                            value={renderSettings.audioBitrate}
                            onChange={(e) => setRenderSettings({...renderSettings, audioBitrate: e.target.value})}
                          >
                            <option value="320">320 (Highest)</option>
                            <option value="256">256 (High)</option>
                            <option value="192">192 (Standard)</option>
                            <option value="128">128 (Good)</option>
                            <option value="96">96 (Acceptable)</option>
                          </select>
                        </div>
                      </div>

                      {/* Estimated File Size */}
                      <Card className="border-purple-200 bg-purple-50">
                        <CardContent className="p-4">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              <Archive className="w-4 h-4 text-purple-600" />
                              <span className="text-sm font-medium">Estimated File Size</span>
                            </div>
                            <span className="text-sm font-semibold text-purple-900">
                              {Math.ceil(parseInt(renderSettings.bitrate) * timelineTracks.reduce((sum, t) => Math.max(sum, t.duration), 0) / 8000)} MB
                            </span>
                          </div>
                        </CardContent>
                      </Card>

                      {/* Action Buttons */}
                      <div className="flex gap-3 pt-2">
                        <Button
                          variant="outline"
                          size="lg"
                          className="flex-1"
                          onClick={() => {
                            setShowRenderModal(false)
                            console.log('âŒ Render cancelled')
                          }}
                        >
                          Cancel
                        </Button>
                        <Button
                          size="lg"
                          className="flex-1 bg-gradient-to-r from-purple-600 to-violet-600 hover:from-purple-700 hover:to-violet-700"
                          onClick={handleConfirmRender}
                        >
                          <Camera className="w-4 h-4 mr-2" />
                          Start Render
                        </Button>
                      </div>
                    </div>
                  </DialogContent>
                </Dialog>

                {/* Recording Modal */}
                <Dialog open={showRecordingModal} onOpenChange={setShowRecordingModal}>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Record Video</DialogTitle>
                      <DialogDescription>
                        Select your recording source and start capturing
                      </DialogDescription>
                    </DialogHeader>
                    <div className="space-y-4">
                      {/* Recording Source Selection */}
                      <div className="space-y-2">
                        <Label>Recording Source</Label>
                        <div className="grid grid-cols-3 gap-2">
                          <Button
                            variant={recordingType === 'screen' ? 'default' : 'outline'}
                            onClick={() => setRecordingType('screen')}
                            className="flex flex-col gap-2 h-20"
                          >
                            <Monitor className="w-5 h-5" />
                            <span className="text-xs">Screen</span>
                          </Button>
                          <Button
                            variant={recordingType === 'webcam' ? 'default' : 'outline'}
                            onClick={() => setRecordingType('webcam')}
                            className="flex flex-col gap-2 h-20"
                          >
                            <Video className="w-5 h-5" />
                            <span className="text-xs">Webcam</span>
                          </Button>
                          <Button
                            variant={recordingType === 'both' ? 'default' : 'outline'}
                            onClick={() => setRecordingType('both')}
                            className="flex flex-col gap-2 h-20"
                          >
                            <Layers className="w-5 h-5" />
                            <span className="text-xs">Both</span>
                          </Button>
                        </div>
                      </div>

                      {/* Recording Status */}
                      {isRecording && (
                        <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
                          <div className="flex items-center gap-2 text-red-600">
                            <div className="w-3 h-3 bg-red-600 rounded-full animate-pulse" />
                            <span className="font-semibold">Recording in progress...</span>
                          </div>
                          <p className="text-sm text-red-600 mt-1">
                            Recording {recordingType} â€¢ Click Stop when finished
                          </p>
                        </div>
                      )}

                      {/* Actions */}
                      <div className="flex gap-2">
                        <Button
                          variant="outline"
                          className="flex-1"
                          onClick={() => {
                            setShowRecordingModal(false)
                            setIsRecording(false)
                          }}
                        >
                          Cancel
                        </Button>
                        {!isRecording ? (
                          <Button
                            className="flex-1 bg-red-600 hover:bg-red-700"
                            onClick={handleBeginRecording}
                          >
                            <Video className="w-4 h-4 mr-2" />
                            Start Recording
                          </Button>
                        ) : (
                          <Button
                            className="flex-1 bg-gray-600 hover:bg-gray-700"
                            onClick={handleStopRecording}
                          >
                            <Square className="w-4 h-4 mr-2" />
                            Stop Recording
                          </Button>
                        )}
                      </div>
                    </div>
                  </DialogContent>
                </Dialog>
            </AnimatedElement>
          </TabsContent>

          <TabsContent value="assets" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              <div className="space-y-4">
                {/* Asset Library Header */}
                <Card>
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="flex items-center gap-2">
                        <Layers className="h-5 w-5" />
                        Asset Library
                        <Badge variant="secondary">{uploadedAssets.length} assets</Badge>
                      </CardTitle>
                      <div className="flex items-center gap-2">
                        <Button variant="outline" size="sm" data-testid="upload-assets-btn" onClick={handleUploadAssets}>
                          <Upload className="w-4 h-4 mr-2" />
                          Upload
                        </Button>
                        <Button variant="outline" size="sm">
                          <Filter className="w-4 h-4 mr-2" />
                          Filter
                        </Button>
                      </div>
                    </div>
                  </CardHeader>
                </Card>

                {/* Asset Categories */}
                <div className="grid grid-cols-3 gap-4">
                  <Card className="cursor-pointer hover:border-purple-500 transition-all">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="p-2 bg-purple-100 rounded-lg">
                            <Video className="w-5 h-5 text-purple-600" />
                          </div>
                          <div>
                            <p className="font-semibold">{uploadedAssets.filter(a => a.type === 'video').length}</p>
                            <p className="text-xs text-gray-600">Videos</p>
                          </div>
                        </div>
                        <ChevronRight className="w-4 h-4 text-gray-400" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="cursor-pointer hover:border-blue-500 transition-all">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="p-2 bg-blue-100 rounded-lg">
                            <Headphones className="w-5 h-5 text-blue-600" />
                          </div>
                          <div>
                            <p className="font-semibold">{uploadedAssets.filter(a => a.type === 'audio').length}</p>
                            <p className="text-xs text-gray-600">Audio</p>
                          </div>
                        </div>
                        <ChevronRight className="w-4 h-4 text-gray-400" />
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="cursor-pointer hover:border-green-500 transition-all">
                    <CardContent className="p-4">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="p-2 bg-green-100 rounded-lg">
                            <Monitor className="w-5 h-5 text-green-600" />
                          </div>
                          <div>
                            <p className="font-semibold">{uploadedAssets.filter(a => a.type === 'image').length}</p>
                            <p className="text-xs text-gray-600">Images</p>
                          </div>
                        </div>
                        <ChevronRight className="w-4 h-4 text-gray-400" />
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Assets Grid */}
                {uploadedAssets.length === 0 ? (
                  <Card>
                    <CardContent className="py-12">
                      <div className="text-center">
                        <Layers className="h-12 w-12 mx-auto text-gray-400 mb-4" />
                        <p className="text-gray-600 mb-4">No assets uploaded yet</p>
                        <Button variant="outline" onClick={handleUploadAssets}>
                          <Upload className="w-4 h-4 mr-2" />
                          Upload First Asset
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                ) : (
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-sm">All Assets</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="grid grid-cols-4 gap-4">
                        {uploadedAssets.map((asset) => (
                          <Card
                            key={asset.id}
                            className={cn(
                              "cursor-pointer hover:shadow-lg transition-all group",
                              selectedAssetId === asset.id && "ring-2 ring-purple-500 shadow-xl"
                            )}
                            onClick={() => handleSelectAsset(asset.id)}
                          >
                            <CardContent className="p-3">
                              <div className="space-y-2">
                                {/* Asset Thumbnail */}
                                <div className={cn(
                                  "aspect-video rounded flex items-center justify-center",
                                  asset.type === 'video' ? "bg-purple-100" :
                                  asset.type === 'audio' ? "bg-blue-100" :
                                  "bg-green-100"
                                )}>
                                  {asset.type === 'video' && <Video className="w-8 h-8 text-purple-600" />}
                                  {asset.type === 'audio' && <Headphones className="w-8 h-8 text-blue-600" />}
                                  {asset.type === 'image' && <Monitor className="w-8 h-8 text-green-600" />}
                                </div>

                                {/* Asset Info */}
                                <div className="space-y-1">
                                  <p className="text-xs font-medium truncate">{asset.name}</p>
                                  <div className="flex items-center justify-between text-xs text-gray-500">
                                    <span>{asset.size}</span>
                                    {asset.duration && <span>{asset.duration}</span>}
                                    {asset.dimensions && <span>{asset.dimensions}</span>}
                                  </div>
                                </div>

                                {/* Actions - Always visible for debugging */}
                                <div className="flex gap-1 mt-2">
                                  <Button
                                    size="sm"
                                    variant="default"
                                    className="flex-1 h-8 text-xs bg-blue-600 hover:bg-blue-700 font-semibold"
                                    onClick={(e) => {
                                      e.stopPropagation()
                                      console.log('ðŸ”µ ADD BUTTON CLICKED for asset:', asset.name, asset.id)
                                      console.log('ðŸ“Š Asset data:', asset)
                                      console.log('ðŸŽ¯ Calling handleAddAssetToTimeline...')
                                      handleAddAssetToTimeline(asset)
                                      console.log('âœ… handleAddAssetToTimeline call completed')
                                    }}
                                  >
                                    <Plus className="w-4 h-4 mr-1" />
                                    Add to Timeline
                                  </Button>
                                  <Button
                                    size="sm"
                                    variant="secondary"
                                    className="h-8 px-3 font-semibold"
                                    onClick={(e) => {
                                      e.stopPropagation()
                                      console.log('ðŸ”µ DOWNLOAD BUTTON CLICKED for asset:', asset.name)
                                      console.log('ðŸ“¥ Asset object:', asset)

                                      const downloadUrl = asset.url || asset.thumbnail
                                      console.log('ðŸ“¥ Download URL:', downloadUrl)

                                      if (!downloadUrl || downloadUrl === '#' || downloadUrl.includes('placeholder')) {
                                        toast.error('Cannot download this asset', {
                                          description: 'This is a demo asset. Upload a real file to download it.'
                                        })
                                        console.log('âŒ No valid download URL')
                                        return
                                      }

                                      // Download asset
                                      try {
                                        const link = document.createElement('a')
                                        link.href = downloadUrl
                                        link.download = asset.name || 'download'
                                        link.target = '_blank'
                                        document.body.appendChild(link)
                                        link.click()
                                        document.body.removeChild(link)

                                        toast.success(`âœ… Downloading ${asset.name}`, {
                                          description: 'Check your browser downloads folder'
                                        })
                                        console.log('âœ… Download initiated successfully')
                                      } catch (error) {
                                        console.error('âŒ Download error:', error)
                                        toast.error('Download failed', {
                                          description: error instanceof Error ? error.message : 'Unknown error'
                                        })
                                      }
                                    }}
                                  >
                                    <Download className="w-4 h-4 mr-1" />
                                    Download
                                  </Button>
                                </div>
                              </div>
                            </CardContent>
                          </Card>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                )}
              </div>
            </AnimatedElement>
          </TabsContent>

          <TabsContent value="render" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              {renderQueue.length === 0 ? (
                // Empty State - No renders
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Camera className="h-5 w-5" />
                      Render Queue
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="text-center py-8">
                      <Camera className="h-12 w-12 mx-auto text-gray-400 mb-4" />
                      <p className="text-gray-600 mb-4">No renders in queue</p>
                      <Button variant="outline" data-testid="start-render-btn" onClick={handleStartRender}>
                        <Camera className="w-4 h-4 mr-2" />
                        Start Render
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              ) : (
                // Render Queue List - Display actual renders
                <div className="space-y-4">
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-semibold flex items-center gap-2">
                      <Camera className="h-5 w-5" />
                      {renderQueue.length} Render{renderQueue.length !== 1 ? 's' : ''} in Queue
                    </h3>
                    <Button onClick={handleStartRender} size="sm">
                      <Plus className="w-4 h-4 mr-2" />
                      Add Render
                    </Button>
                  </div>

                  <div className="space-y-3">
                    {renderQueue.map((render) => (
                      <Card key={render.id} className="overflow-hidden">
                        <CardContent className="p-4">
                          <div className="space-y-3">
                            {/* Header */}
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <h4 className="font-semibold text-sm">{render.project}</h4>
                                <p className="text-xs text-gray-600">{render.filename}</p>
                              </div>
                              <Badge
                                variant={
                                  render.status === 'completed' ? 'default' :
                                  render.status === 'rendering' ? 'secondary' :
                                  render.status === 'failed' ? 'destructive' :
                                  'outline'
                                }
                                className="text-xs"
                              >
                                {render.status}
                              </Badge>
                            </div>

                            {/* Progress Bar */}
                            {(render.status === 'rendering' || render.status === 'queued') && (
                              <div className="space-y-1">
                                <div className="flex justify-between text-xs text-gray-600">
                                  <span>{render.status === 'queued' ? 'Queued' : 'Rendering'}</span>
                                  <span>{render.progress}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                  <div
                                    className={cn(
                                      "h-2 rounded-full transition-all",
                                      render.status === 'rendering' ? "bg-purple-600 animate-pulse" : "bg-gray-400"
                                    )}
                                    style={{ width: `${render.progress}%` }}
                                  />
                                </div>
                              </div>
                            )}

                            {/* Render Details */}
                            <div className="grid grid-cols-3 gap-2 text-xs text-gray-600 pt-2 border-t">
                              <div>
                                <span className="text-gray-500">Resolution:</span>
                                <div className="font-medium">{render.resolution}</div>
                              </div>
                              <div>
                                <span className="text-gray-500">Format:</span>
                                <div className="font-medium">{render.format}</div>
                              </div>
                              <div>
                                <span className="text-gray-500">Codec:</span>
                                <div className="font-medium">{render.codec}</div>
                              </div>
                            </div>

                            {/* Timing Info */}
                            {render.estimatedTime && render.status !== 'completed' && (
                              <div className="flex items-center gap-1 text-xs text-gray-500">
                                <Clock className="w-3 h-3" />
                                <span>Est. time: {render.estimatedTime}</span>
                              </div>
                            )}

                            {/* Action Buttons */}
                            {render.status === 'completed' && (
                              <div className="flex gap-2 pt-2 border-t">
                                <Button
                                  size="sm"
                                  className="flex-1 bg-green-600 hover:bg-green-700"
                                  onClick={() => {
                                    console.log('ðŸ“¥ Download render:', render.filename)
                                    // Simulate download
                                    const link = document.createElement('a')
                                    link.href = '#' // Would be actual render URL
                                    link.download = render.filename
                                    toast.success(`Downloading ${render.filename}`, {
                                      description: 'Check your downloads folder'
                                    })
                                  }}
                                >
                                  <Download className="w-4 h-4 mr-2" />
                                  Download
                                </Button>
                                <Button
                                  size="sm"
                                  variant="outline"
                                  onClick={() => {
                                    console.log('ðŸ—‘ï¸ Remove render from queue:', render.id)
                                    setRenderQueue(prev => prev.filter(r => r.id !== render.id))
                                    toast.info('Render removed from queue')
                                  }}
                                >
                                  <X className="w-4 h-4 mr-2" />
                                  Remove
                                </Button>
                              </div>
                            )}

                            {render.status === 'failed' && (
                              <div className="flex gap-2 pt-2 border-t">
                                <Button
                                  size="sm"
                                  className="flex-1"
                                  onClick={() => {
                                    console.log('ðŸ”„ Retry render:', render.id)
                                    // Reset to queued and restart
                                    setRenderQueue(prev => prev.map(r =>
                                      r.id === render.id ? { ...r, status: 'queued', progress: 0 } : r
                                    ))
                                    setTimeout(() => startRenderSimulation(render.id), 1000)
                                    toast.success('Render queued', {
                                      description: 'Starting render...'
                                    })
                                  }}
                                >
                                  <RefreshCw className="w-4 h-4 mr-2" />
                                  Retry
                                </Button>
                                <Button
                                  size="sm"
                                  variant="outline"
                                  onClick={() => {
                                    console.log('ðŸ—‘ï¸ Remove failed render:', render.id)
                                    setRenderQueue(prev => prev.filter(r => r.id !== render.id))
                                    toast.info('Render removed from queue')
                                  }}
                                >
                                  <X className="w-4 h-4 mr-2" />
                                  Remove
                                </Button>
                              </div>
                            )}

                            {render.status === 'rendering' && (
                              <div className="flex gap-2 pt-2 border-t">
                                <Button
                                  size="sm"
                                  variant="outline"
                                  className="flex-1"
                                  onClick={() => {
                                    console.log('â¸ï¸ Cancel render:', render.id)
                                    setRenderQueue(prev => prev.map(r =>
                                      r.id === render.id ? { ...r, status: 'failed', progress: r.progress } : r
                                    ))
                                    toast.warning('Render cancelled')
                                  }}
                                >
                                  <X className="w-4 h-4 mr-2" />
                                  Cancel
                                </Button>
                              </div>
                            )}
                          </div>
                        </CardContent>
                      </Card>
                    ))}
                  </div>
                </div>
              )}
            </AnimatedElement>
          </TabsContent>

          <TabsContent value="templates" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              <div className="space-y-4">
                {/* Templates Header */}
                <Card>
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="flex items-center gap-2">
                        <Film className="h-5 w-5" />
                        Video Templates
                        <Badge variant="secondary">{VIDEO_STUDIO_DATA.templates.length} templates</Badge>
                      </CardTitle>
                      <div className="flex items-center gap-2">
                        <Button
                          variant={showTemplateSearch ? "default" : "outline"}
                          size="sm"
                          onClick={() => {
                            setShowTemplateSearch(!showTemplateSearch)
                            if (showTemplateSearch) {
                              setTemplateSearchTerm('')
                            }
                            console.log('ðŸ” Template search toggled:', !showTemplateSearch)
                          }}
                        >
                          <Search className="w-4 h-4 mr-2" />
                          Search
                        </Button>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            // Clear all filters
                            setTemplateCategoryFilter(null)
                            setTemplateSearchTerm('')
                            console.log('ðŸ”„ Template filters cleared')
                            toast.info('Filters cleared', {
                              description: `Showing all ${VIDEO_STUDIO_DATA.templates.length} templates`
                            })
                          }}
                        >
                          <Filter className="w-4 h-4 mr-2" />
                          Clear Filters
                        </Button>
                      </div>
                    </div>
                  </CardHeader>
                </Card>

                {/* Search Input */}
                {showTemplateSearch && (
                  <Card className="bg-blue-50 border-blue-200">
                    <CardContent className="p-4">
                      <div className="relative">
                        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                        <input
                          type="text"
                          placeholder="Search templates by name or category..."
                          value={templateSearchTerm}
                          onChange={(e) => {
                            setTemplateSearchTerm(e.target.value)
                            console.log('ðŸ” Template search:', e.target.value)
                          }}
                          className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          autoFocus
                        />
                        {templateSearchTerm && (
                          <button
                            onClick={() => setTemplateSearchTerm('')}
                            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                          >
                            <X className="w-4 h-4" />
                          </button>
                        )}
                      </div>
                      <div className="mt-2 text-sm text-gray-600">
                        Found {getFilteredTemplates().length} template{getFilteredTemplates().length !== 1 ? 's' : ''}
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Template Categories */}
                <div className="grid grid-cols-4 gap-3">
                  {['Business', 'Marketing', 'Social', 'Education'].map((category) => (
                    <Button
                      key={category}
                      variant={templateCategoryFilter === category ? "default" : "outline"}
                      className="justify-start"
                      onClick={() => handleTemplateCategory(category)}
                    >
                      {category}
                      {templateCategoryFilter === category && (
                        <Badge variant="secondary" className="ml-2">
                          {VIDEO_STUDIO_DATA.templates.filter(t =>
                            t.category.toLowerCase() === category.toLowerCase()
                          ).length}
                        </Badge>
                      )}
                    </Button>
                  ))}
                </div>

                {/* Templates Grid */}
                <div className="grid grid-cols-3 gap-4">
                  {getFilteredTemplates().map((template) => (
                    <Card
                      key={template.id}
                      className="cursor-pointer hover:shadow-lg transition-all group overflow-hidden"
                    >
                      {/* Template Thumbnail */}
                      <div className="aspect-video bg-gradient-to-br from-purple-500 to-violet-600 relative overflow-hidden">
                        <div className="absolute inset-0 flex items-center justify-center">
                          <Film className="w-16 h-16 text-white opacity-50" />
                        </div>
                        {template.premium && (
                          <div className="absolute top-2 right-2">
                            <Badge className="bg-yellow-500">Premium</Badge>
                          </div>
                        )}
                        <div className="absolute bottom-2 right-2 bg-black/60 px-2 py-1 rounded text-xs text-white">
                          {template.duration}
                        </div>
                      </div>

                      <CardContent className="p-4 space-y-3">
                        {/* Template Info */}
                        <div>
                          <h4 className="font-semibold text-sm mb-1">{template.name}</h4>
                          <div className="flex items-center gap-2 text-xs text-gray-600">
                            <Badge variant="outline" className="text-xs px-2 py-0">
                              {template.category}
                            </Badge>
                            <span>â€¢</span>
                            <span>{template.resolution}</span>
                          </div>
                        </div>

                        {/* Stats */}
                        <div className="flex items-center justify-between text-xs text-gray-600">
                          <div className="flex items-center gap-1">
                            <Download className="w-3 h-3" />
                            <span>{template.downloads}</span>
                          </div>
                          <div className="flex items-center gap-1">
                            <Award className="w-3 h-3 text-yellow-500" />
                            <span>{template.rating}</span>
                          </div>
                        </div>

                        {/* Actions - Always visible with better styling */}
                        <div className="flex gap-2 pt-2 border-t">
                          <Button
                            size="sm"
                            variant="outline"
                            className="flex-1 h-9 font-semibold hover:bg-purple-50"
                            onClick={(e) => {
                              e.stopPropagation()
                              console.log('ðŸŽ¬ Preview button clicked for template:', template.name)
                              handleTemplatePreview(template)
                            }}
                          >
                            <Play className="w-4 h-4 mr-1" />
                            Preview
                          </Button>
                          <Button
                            size="sm"
                            className="flex-1 h-9 bg-purple-600 hover:bg-purple-700 font-semibold"
                            onClick={(e) => {
                              e.stopPropagation()
                              console.log('âœ¨ Apply Template button clicked for:', template.name)

                              // Apply template to current editor timeline
                              // Create template tracks based on template type
                              const templateTracks = []

                              // Add intro scene
                              templateTracks.push({
                                id: `template-intro-${Date.now()}`,
                                type: 'video',
                                name: `${template.name} - Intro`,
                                duration: 5,
                                color: 'purple',
                                asset: {
                                  id: `asset-${Date.now()}-1`,
                                  url: template.thumbnail || '/assets/placeholder.png',
                                  resolution: template.resolution,
                                  fps: 30,
                                  size: '10 MB'
                                }
                              })

                              // Add main content scene
                              templateTracks.push({
                                id: `template-main-${Date.now()}`,
                                type: 'video',
                                name: `${template.name} - Main Content`,
                                duration: 20,
                                color: 'purple',
                                asset: {
                                  id: `asset-${Date.now()}-2`,
                                  url: template.thumbnail || '/assets/placeholder.png',
                                  resolution: template.resolution,
                                  fps: 30,
                                  size: '50 MB'
                                }
                              })

                              // Add background music
                              templateTracks.push({
                                id: `template-audio-${Date.now()}`,
                                type: 'audio',
                                name: `${template.name} - Background Music`,
                                duration: 25,
                                color: 'blue',
                                asset: {
                                  id: `asset-${Date.now()}-3`,
                                  url: '/assets/audio.mp3',
                                  size: '5 MB'
                                }
                              })

                              // Add text overlay
                              templateTracks.push({
                                id: `template-text-${Date.now()}`,
                                type: 'text',
                                name: `${template.name} - Title`,
                                duration: 25,
                                color: 'green',
                                asset: {
                                  id: `asset-${Date.now()}-4`,
                                  size: '1 KB'
                                }
                              })

                              // Apply tracks to timeline
                              setTimelineTracks(prev => {
                                const updated = [...prev, ...templateTracks]
                                console.log('ðŸ“ Timeline updated with template tracks:', updated.length, 'total tracks')
                                console.log('ðŸ“ Template tracks added:', templateTracks.map(t => ({ id: t.id, name: t.name })))
                                return updated
                              })

                              // Switch to Editor tab to show the result
                              setActiveTab('editor')

                              toast.success(`âœ… Template applied to timeline!`, {
                                description: `${template.name} added ${templateTracks.length} tracks. Check the Editor tab!`,
                                duration: 5000
                              })

                              console.log('âœ… Template applied successfully')
                              console.log('ðŸ”„ Switching to Editor tab...')
                            }}
                          >
                            <Plus className="w-4 h-4 mr-1" />
                            Apply to Timeline
                          </Button>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>

                {/* Premium Templates CTA */}
                <Card className="bg-gradient-to-r from-purple-50 to-violet-50 border-purple-200">
                  <CardContent className="p-6">
                    <div className="flex items-center justify-between">
                      <div className="flex-1">
                        <h3 className="font-semibold text-lg mb-1">Unlock Premium Templates</h3>
                        <p className="text-sm text-gray-600">
                          Get access to 100+ professional video templates with advanced features
                        </p>
                      </div>
                      <Button className="bg-purple-600">
                        <Award className="w-4 h-4 mr-2" />
                        Upgrade Now
                      </Button>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </AnimatedElement>
          </TabsContent>

          <TabsContent value="analytics" className="space-y-4">
            <AnimatedElement animation="slideInUp">
              <div className="space-y-4">
                {/* Analytics Header */}
                <Card className="bg-gradient-to-r from-purple-50 to-violet-50 border-purple-200">
                  <CardContent className="p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <h2 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
                          <BarChart3 className="w-6 h-6 text-purple-600" />
                          Video Studio Analytics
                        </h2>
                        <p className="text-sm text-gray-600 mt-1">
                          Track performance, usage metrics, and project insights
                        </p>
                      </div>
                      <div className="flex items-center gap-2">
                        <Button variant="outline" size="sm">
                          <Download className="w-4 h-4 mr-2" />
                          Export Report
                        </Button>
                        <Button variant="outline" size="sm">
                          <RefreshCw className="w-4 h-4 mr-2" />
                          Refresh
                        </Button>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Key Metrics Cards */}
                <div className="grid grid-cols-4 gap-4">
                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-xs text-gray-500 uppercase">Total Projects</p>
                          <p className="text-3xl font-bold text-gray-900 mt-1">{projects.length}</p>
                          <p className="text-xs text-green-600 mt-1 flex items-center gap-1">
                            <TrendingUp className="w-3 h-3" />
                            +12% this month
                          </p>
                        </div>
                        <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                          <Folder className="w-6 h-6 text-blue-600" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-xs text-gray-500 uppercase">Completed Renders</p>
                          <p className="text-3xl font-bold text-gray-900 mt-1">
                            {renderQueue.filter(r => r.status === 'completed').length}
                          </p>
                          <p className="text-xs text-green-600 mt-1 flex items-center gap-1">
                            <TrendingUp className="w-3 h-3" />
                            +8% this week
                          </p>
                        </div>
                        <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                          <CheckCircle className="w-6 h-6 text-green-600" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-xs text-gray-500 uppercase">Total Assets</p>
                          <p className="text-3xl font-bold text-gray-900 mt-1">{uploadedAssets.length}</p>
                          <p className="text-xs text-blue-600 mt-1 flex items-center gap-1">
                            <Image className="w-3 h-3" />
                            {uploadedAssets.filter(a => a.type === 'video').length} videos
                          </p>
                        </div>
                        <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                          <Archive className="w-6 h-6 text-purple-600" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-center justify-between">
                        <div>
                          <p className="text-xs text-gray-500 uppercase">Timeline Tracks</p>
                          <p className="text-3xl font-bold text-gray-900 mt-1">{timelineTracks.length}</p>
                          <p className="text-xs text-orange-600 mt-1 flex items-center gap-1">
                            <Layers className="w-3 h-3" />
                            {appliedEffects.length} effects
                          </p>
                        </div>
                        <div className="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                          <Film className="w-6 h-6 text-orange-600" />
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Charts Row */}
                <div className="grid grid-cols-2 gap-4">
                  {/* Project Status Chart */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-sm flex items-center gap-2">
                        <BarChart3 className="w-4 h-4" />
                        Project Status Distribution
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-600">In Progress</span>
                            <span className="font-semibold">{projects.filter(p => p.status === 'in-progress').length} ({Math.round(projects.filter(p => p.status === 'in-progress').length / projects.length * 100)}%)</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-blue-600 h-2 rounded-full transition-all"
                              style={{ width: `${projects.filter(p => p.status === 'in-progress').length / projects.length * 100}%` }}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-600">Completed</span>
                            <span className="font-semibold">{projects.filter(p => p.status === 'completed').length} ({Math.round(projects.filter(p => p.status === 'completed').length / projects.length * 100)}%)</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-green-600 h-2 rounded-full transition-all"
                              style={{ width: `${projects.filter(p => p.status === 'completed').length / projects.length * 100}%` }}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-600">Planning</span>
                            <span className="font-semibold">{projects.filter(p => p.status === 'planning').length} ({Math.round(projects.filter(p => p.status === 'planning').length / projects.length * 100)}%)</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-yellow-600 h-2 rounded-full transition-all"
                              style={{ width: `${projects.filter(p => p.status === 'planning').length / projects.length * 100}%` }}
                            />
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* Asset Type Distribution */}
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-sm flex items-center gap-2">
                        <Archive className="w-4 h-4" />
                        Asset Type Distribution
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <div className="flex items-center gap-2">
                              <Video className="w-4 h-4 text-purple-600" />
                              <span className="text-gray-600">Videos</span>
                            </div>
                            <span className="font-semibold">{uploadedAssets.filter(a => a.type === 'video').length}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-purple-600 h-2 rounded-full transition-all"
                              style={{ width: `${uploadedAssets.filter(a => a.type === 'video').length / uploadedAssets.length * 100}%` }}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <div className="flex items-center gap-2">
                              <Headphones className="w-4 h-4 text-blue-600" />
                              <span className="text-gray-600">Audio</span>
                            </div>
                            <span className="font-semibold">{uploadedAssets.filter(a => a.type === 'audio').length}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-blue-600 h-2 rounded-full transition-all"
                              style={{ width: `${uploadedAssets.filter(a => a.type === 'audio').length / uploadedAssets.length * 100}%` }}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <div className="flex items-center justify-between text-sm">
                            <div className="flex items-center gap-2">
                              <Image className="w-4 h-4 text-green-600" />
                              <span className="text-gray-600">Images</span>
                            </div>
                            <span className="font-semibold">{uploadedAssets.filter(a => a.type === 'image').length}</span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                              className="bg-green-600 h-2 rounded-full transition-all"
                              style={{ width: `${uploadedAssets.filter(a => a.type === 'image').length / uploadedAssets.length * 100}%` }}
                            />
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>

                {/* Recent Activity */}
                <Card>
                  <CardHeader>
                    <div className="flex items-center justify-between">
                      <CardTitle className="text-sm flex items-center gap-2">
                        <Clock className="w-4 h-4" />
                        Recent Activity
                      </CardTitle>
                      <Button variant="ghost" size="sm">
                        View All
                      </Button>
                    </div>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-3">
                      {renderQueue.slice(0, 3).map((render, idx) => (
                        <div key={render.id} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                          <div className={cn(
                            "w-10 h-10 rounded-full flex items-center justify-center",
                            render.status === 'completed' ? "bg-green-100" :
                            render.status === 'rendering' ? "bg-blue-100" :
                            render.status === 'failed' ? "bg-red-100" : "bg-gray-100"
                          )}>
                            {render.status === 'completed' && <CheckCircle className="w-5 h-5 text-green-600" />}
                            {render.status === 'rendering' && <Camera className="w-5 h-5 text-blue-600 animate-pulse" />}
                            {render.status === 'failed' && <AlertCircle className="w-5 h-5 text-red-600" />}
                            {render.status === 'queued' && <Clock className="w-5 h-5 text-gray-600" />}
                          </div>
                          <div className="flex-1">
                            <p className="text-sm font-medium">{render.project}</p>
                            <p className="text-xs text-gray-600">{render.filename} â€¢ {render.resolution}</p>
                          </div>
                          <Badge variant={
                            render.status === 'completed' ? 'default' :
                            render.status === 'rendering' ? 'secondary' :
                            render.status === 'failed' ? 'destructive' : 'outline'
                          }>
                            {render.status}
                          </Badge>
                        </div>
                      ))}

                      {renderQueue.length === 0 && (
                        <div className="text-center py-8 text-gray-500">
                          <Clock className="w-12 h-12 mx-auto mb-2 opacity-50" />
                          <p className="text-sm">No recent activity</p>
                        </div>
                      )}
                    </div>
                  </CardContent>
                </Card>

                {/* Storage & Performance */}
                <div className="grid grid-cols-2 gap-4">
                  <Card>
                    <CardHeader>
                      <CardTitle className="text-sm flex items-center gap-2">
                        <Archive className="w-4 h-4" />
                        Storage Usage
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-4">
                        <div>
                          <div className="flex items-center justify-between text-sm mb-2">
                            <span className="text-gray-600">Used Storage</span>
                            <span className="font-semibold">
                              {uploadedAssets.reduce((sum, a) => {
                                const size = parseFloat(a.size)
                                return sum + (a.size.includes('GB') ? size * 1024 : size)
                              }, 0).toFixed(2)} MB / 10 GB
                            </span>
                          </div>
                          <div className="w-full bg-gray-200 rounded-full h-3">
                            <div
                              className="bg-purple-600 h-3 rounded-full transition-all"
                              style={{ width: `${Math.min(uploadedAssets.reduce((sum, a) => {
                                const size = parseFloat(a.size)
                                return sum + (a.size.includes('GB') ? size * 1024 : size)
                              }, 0) / 10240 * 100, 100)}%` }}
                            />
                          </div>
                        </div>
                        <div className="grid grid-cols-3 gap-2 text-xs">
                          <div className="text-center p-2 bg-purple-50 rounded">
                            <p className="font-semibold text-purple-900">
                              {uploadedAssets.filter(a => a.type === 'video').reduce((sum, a) => {
                                const size = parseFloat(a.size)
                                return sum + (a.size.includes('GB') ? size * 1024 : size)
                              }, 0).toFixed(1)} MB
                            </p>
                            <p className="text-gray-600">Videos</p>
                          </div>
                          <div className="text-center p-2 bg-blue-50 rounded">
                            <p className="font-semibold text-blue-900">
                              {uploadedAssets.filter(a => a.type === 'audio').reduce((sum, a) => {
                                const size = parseFloat(a.size)
                                return sum + (a.size.includes('GB') ? size * 1024 : size)
                              }, 0).toFixed(1)} MB
                            </p>
                            <p className="text-gray-600">Audio</p>
                          </div>
                          <div className="text-center p-2 bg-green-50 rounded">
                            <p className="font-semibold text-green-900">
                              {uploadedAssets.filter(a => a.type === 'image').reduce((sum, a) => {
                                const size = parseFloat(a.size)
                                return sum + (a.size.includes('GB') ? size * 1024 : size)
                              }, 0).toFixed(1)} MB
                            </p>
                            <p className="text-gray-600">Images</p>
                          </div>
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  <Card>
                    <CardHeader>
                      <CardTitle className="text-sm flex items-center gap-2">
                        <TrendingUp className="w-4 h-4" />
                        Performance Metrics
                      </CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-3">
                        <div className="flex items-center justify-between p-2 bg-green-50 rounded">
                          <span className="text-sm text-gray-600">Render Success Rate</span>
                          <span className="text-sm font-semibold text-green-900">
                            {renderQueue.length > 0 ? Math.round(renderQueue.filter(r => r.status === 'completed').length / renderQueue.length * 100) : 0}%
                          </span>
                        </div>
                        <div className="flex items-center justify-between p-2 bg-blue-50 rounded">
                          <span className="text-sm text-gray-600">Avg. Render Time</span>
                          <span className="text-sm font-semibold text-blue-900">3.5 min</span>
                        </div>
                        <div className="flex items-center justify-between p-2 bg-purple-50 rounded">
                          <span className="text-sm text-gray-600">Active Projects</span>
                          <span className="text-sm font-semibold text-purple-900">
                            {projects.filter(p => p.status === 'in-progress').length}
                          </span>
                        </div>
                        <div className="flex items-center justify-between p-2 bg-orange-50 rounded">
                          <span className="text-sm text-gray-600">Total Exports</span>
                          <span className="text-sm font-semibold text-orange-900">
                            {renderQueue.filter(r => r.status === 'completed').length}
                          </span>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </div>
            </AnimatedElement>
          </TabsContent>
        </Tabs>
      </div>

      {/* AI Tools Modal */}
      <Dialog open={showAiToolsModal} onOpenChange={setShowAiToolsModal}>
        <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Brain className="w-5 h-5 text-purple-600" />
              AI Video Studio Tools
            </DialogTitle>
            <DialogDescription>
              Leverage AI to enhance your video production workflow
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-6">
            {!selectedAiTool ? (
              /* Tool Selection Grid */
              <div className="grid grid-cols-2 gap-4">
                {aiTools.map((tool) => {
                  const IconComponent = tool.icon
                  return (
                    <Card
                      key={tool.id}
                      className="cursor-pointer hover:border-purple-500 hover:shadow-lg transition-all"
                      onClick={() => setSelectedAiTool(tool.id)}
                    >
                      <CardHeader>
                        <CardTitle className="flex items-center gap-2 text-base">
                          <IconComponent className="w-4 h-4 text-purple-600" />
                          {tool.name}
                        </CardTitle>
                        <CardDescription className="text-sm">
                          {tool.description}
                        </CardDescription>
                      </CardHeader>
                    </Card>
                  )
                })}
              </div>
            ) : (
              /* Tool Input and Results */
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-semibold">
                    {aiTools.find(t => t.id === selectedAiTool)?.name}
                  </h3>
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => {
                      setSelectedAiTool(null)
                      setAiToolResult(null)
                    }}
                  >
                    â† Back to Tools
                  </Button>
                </div>

                {/* Input Form */}
                <div className="space-y-3">
                  <div>
                    <Label htmlFor="videoTopic">Video Topic *</Label>
                    <Input
                      id="videoTopic"
                      placeholder="e.g., How to start a podcast"
                      value={aiToolInput.videoTopic}
                      onChange={(e) => setAiToolInput({ ...aiToolInput, videoTopic: e.target.value })}
                    />
                  </div>

                  <div>
                    <Label htmlFor="videoTitle">Video Title</Label>
                    <Input
                      id="videoTitle"
                      placeholder="e.g., Podcasting 101: Complete Beginner's Guide"
                      value={aiToolInput.videoTitle}
                      onChange={(e) => setAiToolInput({ ...aiToolInput, videoTitle: e.target.value })}
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <Label htmlFor="videoDuration">Duration (minutes)</Label>
                      <Input
                        id="videoDuration"
                        type="number"
                        placeholder="e.g., 10"
                        value={aiToolInput.videoDuration}
                        onChange={(e) => setAiToolInput({ ...aiToolInput, videoDuration: e.target.value })}
                      />
                    </div>
                    <div>
                      <Label htmlFor="targetAudience">Target Audience</Label>
                      <Input
                        id="targetAudience"
                        placeholder="e.g., aspiring podcasters"
                        value={aiToolInput.targetAudience}
                        onChange={(e) => setAiToolInput({ ...aiToolInput, targetAudience: e.target.value })}
                      />
                    </div>
                  </div>

                  <div>
                    <Label htmlFor="additionalNotes">Additional Notes</Label>
                    <Textarea
                      id="additionalNotes"
                      placeholder="Any specific requirements or context..."
                      value={aiToolInput.additionalNotes}
                      onChange={(e) => setAiToolInput({ ...aiToolInput, additionalNotes: e.target.value })}
                      rows={3}
                    />
                  </div>

                  <Button
                    onClick={() => handleAiTool(selectedAiTool)}
                    disabled={aiToolProcessing || !aiToolInput.videoTopic}
                    className="w-full bg-gradient-to-r from-purple-600 to-violet-600"
                  >
                    {aiToolProcessing ? (
                      <>
                        <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                        Processing...
                      </>
                    ) : (
                      <>
                        <Sparkles className="w-4 h-4 mr-2" />
                        Generate with AI
                      </>
                    )}
                  </Button>
                </div>

                {/* Results */}
                {aiToolResult && (
                  <Card className={aiToolResult.error ? 'border-red-300' : 'border-green-300'}>
                    <CardHeader>
                      <CardTitle className="flex items-center gap-2 text-base">
                        {aiToolResult.error ? (
                          <>
                            <AlertCircle className="w-4 h-4 text-red-500" />
                            Error
                          </>
                        ) : (
                          <>
                            <CheckCircle className="w-4 h-4 text-green-500" />
                            AI Generated Result
                            {aiToolResult.confidence && (
                              <Badge variant="secondary" className="ml-2">
                                {Math.round(aiToolResult.confidence * 100)}% confidence
                              </Badge>
                            )}
                          </>
                        )}
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-4">
                      <div className="prose prose-sm max-w-none">
                        <pre className="whitespace-pre-wrap font-sans text-sm">
                          {aiToolResult.content}
                        </pre>
                      </div>

                      {aiToolResult.suggestions && aiToolResult.suggestions.length > 0 && (
                        <div className="space-y-2">
                          <h4 className="font-semibold text-sm">Quick Suggestions:</h4>
                          <div className="space-y-1">
                            {aiToolResult.suggestions.map((suggestion: string, idx: number) => (
                              <div
                                key={idx}
                                className="p-2 bg-purple-50 rounded text-sm border border-purple-200"
                              >
                                {suggestion}
                              </div>
                            ))}
                          </div>
                        </div>
                      )}

                      <div className="flex gap-2">
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            navigator.clipboard.writeText(aiToolResult.content)
                          }}
                        >
                          <Copy className="w-4 h-4 mr-2" />
                          Copy to Clipboard
                        </Button>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => handleAiTool(selectedAiTool)}
                        >
                          <RefreshCw className="w-4 h-4 mr-2" />
                          Regenerate
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                )}
              </div>
            )}
          </div>
        </DialogContent>
      </Dialog>

      {/* Create Project Modal */}
      <Dialog open={isCreateModalOpen} onOpenChange={setIsCreateModalOpen}>
        <DialogContent className="max-w-2xl">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Video className="h-6 w-6 text-purple-600" />
              Create New Video Project
            </DialogTitle>
            <DialogDescription>
              Set up your new video project and start creating professional content with AI-powered tools
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-6 py-4">
            <div className="space-y-2">
              <Label htmlFor="projectName">Project Name *</Label>
              <Input
                id="projectName"
                placeholder="e.g., Brand Campaign 2024, Product Demo..."
                value={newProjectName}
                onChange={(e) => setNewProjectName(e.target.value)}
                className="h-12"
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="projectDescription">Description</Label>
              <Textarea
                id="projectDescription"
                placeholder="Brief description of your video project..."
                value={newProjectDescription}
                onChange={(e) => setNewProjectDescription(e.target.value)}
                className="min-h-[100px]"
              />
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label>Resolution</Label>
                <select
                  className="w-full h-10 px-3 rounded-md border border-input bg-background"
                  value={newProjectResolution}
                  onChange={(e) => setNewProjectResolution(e.target.value)}
                >
                  <option value="1080p">1080p (Full HD)</option>
                  <option value="4K">4K (Ultra HD)</option>
                  <option value="720p">720p (HD)</option>
                </select>
              </div>

              <div className="space-y-2">
                <Label>Frame Rate</Label>
                <select
                  className="w-full h-10 px-3 rounded-md border border-input bg-background"
                  value={newProjectFrameRate}
                  onChange={(e) => setNewProjectFrameRate(e.target.value)}
                >
                  <option value="30fps">30 fps</option>
                  <option value="60fps">60 fps</option>
                  <option value="24fps">24 fps (Cinematic)</option>
                </select>
              </div>
            </div>

            <div className="bg-purple-50 dark:bg-purple-950/20 p-4 rounded-lg border border-purple-200">
              <h4 className="font-semibold text-sm mb-2 flex items-center gap-2">
                <Target className="h-4 w-4 text-purple-600" />
                What you'll get:
              </h4>
              <ul className="text-sm space-y-1 text-muted-foreground">
                <li>â€¢ Professional video editing workspace</li>
                <li>â€¢ AI-powered editing tools (auto-cut, color correction)</li>
                <li>â€¢ Universal Pinpoint System for frame-by-frame feedback</li>
                <li>â€¢ Real-time collaboration with team members</li>
                <li>â€¢ 4K rendering and export options</li>
                <li>â€¢ Access to 234+ professional assets</li>
              </ul>
            </div>

            <div className="flex items-center justify-end gap-3 pt-4 border-t">
              <Button
                variant="outline"
                onClick={() => setIsCreateModalOpen(false)}
                disabled={isCreatingProject}
              >
                Cancel
              </Button>
              <Button
                onClick={handleCreateNewProject}
                disabled={isCreatingProject || !newProjectName.trim()}
                className="bg-gradient-to-r from-purple-600 to-violet-600"
              >
                {isCreatingProject ? (
                  <>
                    <RefreshCw className="w-4 h-4 mr-2 animate-spin" />
                    Creating...
                  </>
                ) : (
                  <>
                    <Plus className="w-4 h-4 mr-2" />
                    Create Project
                  </>
                )}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  )
}